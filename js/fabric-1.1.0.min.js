var fabric=fabric||{version:"1.1.0"};if(typeof exports!=="undefined")exports.fabric=fabric;if(typeof document!=="undefined"&&typeof window!=="undefined"){fabric.document=document;fabric.window=window}else{fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>");fabric.window=fabric.document.createWindow()}fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";
var Cufon=function(){function l(r){var s=this.face=r.face;this.glyphs=r.glyphs;this.w=r.w;this.baseSize=parseInt(s["units-per-em"],10);this.family=s["font-family"].toLowerCase();this.weight=s["font-weight"];this.style=s["font-style"]||"normal";this.viewBox=function(){var v=s.bbox.split(/\s+/);v={minX:parseInt(v[0],10),minY:parseInt(v[1],10),maxX:parseInt(v[2],10),maxY:parseInt(v[3],10)};v.width=v.maxX-v.minX;v.height=v.maxY-v.minY;v.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};
return v}();this.ascent=-parseInt(s.ascent,10);this.descent=-parseInt(s.descent,10);this.height=-this.ascent+this.descent}function f(){var r={},s={oblique:"italic",italic:"oblique"};this.add=function(v){(r[v.style]||(r[v.style]={}))[v.weight]=v};this.get=function(v,x){var z=r[v]||r[s[v]]||r.normal||r.italic||r.oblique;if(!z)return null;x={normal:400,bold:700}[x]||parseInt(x,10);if(z[x])return z[x];var C={1:1,99:0}[x%100],D=[],B,A;if(C===undefined)C=x>400;if(x==500)x=400;for(var y in z){y=parseInt(y,
10);if(!B||y<B)B=y;if(!A||y>A)A=y;D.push(y)}if(x<B)x=B;if(x>A)x=A;D.sort(function(E,F){return(C?E>x&&F>x?E<F:E>F:E<x&&F<x?E>F:E<F)?-1:1});return z[D[0]]}}function a(r){var s={},v={};this.get=function(x){return s[x]!=undefined?s[x]:r[x]};this.getSize=function(x,z){return v[x]||(v[x]=new k.Size(this.get(x),z))};this.extend=function(x){for(var z in x)s[z]=x[z];return this}}function e(r,s,v){if(r.addEventListener)r.addEventListener(s,v,false);else r.attachEvent&&r.attachEvent("on"+s,function(){return v.call(r,
fabric.window.event)})}function b(r){var s={};return function(v){s.hasOwnProperty(v)||(s[v]=r.apply(null,arguments));return s[v]}}function c(r){return fabric.document.getElementsByTagName(r)}function d(){for(var r={},s,v=0,x=arguments.length;v<x;++v)for(s in arguments[v])r[s]=arguments[v][s];return r}function g(r,s,v,x,z,C){var D=x.separate;if(D=="none")return p[x.engine].apply(null,arguments);var B=fabric.document.createDocumentFragment(),A=s.split(u[D]),y=D=="words";if(y&&i){/^\s/.test(s)&&A.unshift("");
/\s$/.test(s)&&A.push("")}for(var E=0,F=A.length;E<F;++E)(D=p[x.engine](r,y?k.textAlign(A[E],v,E,F):A[E],v,x,z,C,E<F-1))&&B.appendChild(D);return B}function h(r,s){var v,x,z,C;z=n.get(r);if(!z.options){s.hover&&s.hoverables[r.nodeName.toLowerCase()]&&o.attach(r);z.options=s}for(var D=r.firstChild;D;D=z){z=D.nextSibling;C=false;if(D.nodeType==1){if(!D.firstChild)continue;if(/cufon/.test(D.className))C=true;else{arguments.callee(D,s);continue}}x||(x=k.getStyle(r).extend(s));if(!v)a:{(v=x)||(v=k.getStyle(r));
for(var B=k.quotedList(v.get("fontFamily").toLowerCase()),A=void 0,y=0,E=B.length;y<E;++y){A=B[y];if(q[A]){v=q[A].get(v.get("fontStyle"),v.get("fontWeight"));break a}}v=null}if(v)if(C)p[s.engine](v,null,x,s,D,r);else{C=D.data;if(typeof G_vmlCanvasManager!="undefined")C=C.replace(/\r/g,"\n");if(C!=="")(C=g(v,C,x,s,D,r))?D.parentNode.replaceChild(C,D):D.parentNode.removeChild(D)}}}var j=function(){return j.replace.apply(null,arguments)},m=j.DOM={ready:function(){var r=false,s={loaded:1,complete:1},
v=[],x=function(){if(!r){r=true;for(var z;z=v.shift();z());}};if(fabric.document.addEventListener){fabric.document.addEventListener("DOMContentLoaded",x,false);fabric.window.addEventListener("pageshow",x,false)}!fabric.window.opera&&fabric.document.readyState&&function(){s[fabric.document.readyState]?x():setTimeout(arguments.callee,10)}();fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left");x()}catch(z){setTimeout(arguments.callee,1)}}();
e(fabric.window,"load",x);return function(z){if(arguments.length)r?z():v.push(z);else x()}}()},k=j.CSS={Size:function(r,s){this.value=parseFloat(r);this.unit=String(r).match(/[a-z%]*$/)[0]||"px";this.convert=function(v){return v/s*this.value};this.convertFrom=function(v){return v/this.value*s};this.toString=function(){return this.value+this.unit}},getStyle:function(r){return new a(r.style)},quotedList:b(function(r){for(var s=[],v=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,x;x=v.exec(r);)s.push(x[3]||
x[1]);return s}),ready:function(){var r=false,s=[],v=Object.prototype.propertyIsEnumerable?c("style"):{length:0},x=c("link");m.ready(function(){for(var z=0,C,D=0,B=x.length;C=x[D],D<B;++D)!C.disabled&&C.rel.toLowerCase()=="stylesheet"&&++z;if(fabric.document.styleSheets.length>=v.length+z)for(r=true;z=s.shift();z());else setTimeout(arguments.callee,10)});return function(z){r?z():s.push(z)}}(),supports:function(r,s){var v=fabric.document.createElement("span").style;if(v[r]===undefined)return false;
v[r]=s;return v[r]===s},textAlign:function(r,s,v,x){if(s.get("textAlign")=="right"){if(v>0)r=" "+r}else if(v<x-1)r+=" ";return r},textDecoration:function(r,s){s||(s=this.getStyle(r));for(var v={underline:null,overline:null,"line-through":null},x=r;x.parentNode&&x.parentNode.nodeType==1;){var z=true;for(var C in v)if(!v[C]){if(s.get("textDecoration").indexOf(C)!=-1)v[C]=s.get("color");z=false}if(z)break;s=this.getStyle(x=x.parentNode)}return v},textShadow:b(function(r){if(r=="none")return null;for(var s=
[],v={},x,z=0,C=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;x=C.exec(r);)if(x[0]==","){s.push(v);v={};z=0}else if(x[1])v.color=x[1];else v[["offX","offY","blur"][z++]]=x[2];s.push(v);return s}),color:b(function(r){var s={};s.color=r.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(v,x,z){s.opacity=parseFloat(z);return"rgb("+x+")"});return s}),textTransform:function(r,s){return r[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[s.get("textTransform")]||"toString"]()}},i=" ".split(/\s+/).length==
0,n=new function(){var r={},s=0;this.get=function(v){v=v.cufid||(v.cufid=++s);return r[v]||(r[v]={})}},o=new (function(){function r(x){x=x.relatedTarget;var z;if(!(z=!x))z=this.contains?this.contains(x):this.compareDocumentPosition(x)&16;z||v(this)}function s(){v(this)}function v(x){setTimeout(function(){j.replace(x,n.get(x).options,true)},10)}this.attach=function(x){if(x.onmouseenter===undefined){e(x,"mouseover",r);e(x,"mouseout",r)}else{e(x,"mouseenter",s);e(x,"mouseleave",s)}}}),t=[],p={},q={},
w={engine:null,hover:false,hoverables:{a:true},printable:true,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(r){return jQuery(r)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(r){return $$(r)}||fabric.window.$&&function(r){return $(r)}||fabric.document.querySelectorAll&&function(r){return fabric.document.querySelectorAll(r)}||c,separate:"words",textShadow:"none"},u={words:/\s+/,characters:""};j.now=function(){m.ready();return j};j.refresh=function(){for(var r=t.splice(0,
t.length),s=0,v=r.length;s<v;++s)j.replace.apply(null,r[s]);return j};j.registerEngine=function(r,s){if(!s)return j;p[r]=s;return j.set("engine",r)};j.registerFont=function(r){r=new l(r);var s=r.family;q[s]||(q[s]=new f);q[s].add(r);return j.set("fontFamily",'"'+s+'"')};j.replace=function(r,s,v){s=d(w,s);if(!s.engine)return j;if(typeof s.textShadow=="string"&&s.textShadow)s.textShadow=k.textShadow(s.textShadow);v||t.push(arguments);if(r.nodeType||typeof r=="string")r=[r];k.ready(function(){for(var x=
0,z=r.length;x<z;++x){var C=r[x];typeof C=="string"?j.replace(s.selector(C),s,true):h(C,s)}});return j};j.replaceElement=function(r,s){s=d(w,s);if(typeof s.textShadow=="string"&&s.textShadow)s.textShadow=k.textShadow(s.textShadow);return h(r,s)};j.engines=p;j.fonts=q;j.getOptions=function(){return d(w)};j.set=function(r,s){w[r]=s;return j};return j}();
Cufon.registerEngine("canvas",function(){var l=Cufon.CSS.supports("display","inline-block"),f=!l&&(fabric.document.compatMode=="BackCompat"||/frameset|transitional/i.test(fabric.document.doctype.publicId)),a=fabric.document.createElement("style");a.type="text/css";f=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(f?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+
(l?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{a.appendChild(f)}catch(e){a.setAttribute("type","text/css");a.styleSheet.cssText=f.data}fabric.document.getElementsByTagName("head")[0].appendChild(a);return function(b,c,d,g,h){function j(G){y.fillStyle=G||Cufon.textOptions.color||d.get("color");var J=G=0;if(g.textAlign==="right")y.translate(A[J],
0);else g.textAlign==="center"&&y.translate(A[J]/2,0);for(var K=0,P=x.length;K<P;++K)if(x[K]==="\n"){J++;var L=-b.ascent-b.ascent/5*g.lineHeight;if(g.textAlign==="right"){y.translate(-z,L);y.translate(A[J],0)}else if(g.textAlign==="center"){y.translate(-G-A[J-1]/2,L);y.translate(A[J]/2,0)}else y.translate(-G,L);G=0}else{var H=b.glyphs[x[K]]||b.missingGlyph;if(H){L=Number(H.w||b.w)+n;if(F){y.save();y.strokeStyle=y.fillStyle;y.lineWidth+=y.lineWidth;y.beginPath();if(F.underline){y.moveTo(0,-b.face["underline-position"]+
0.5);y.lineTo(L,-b.face["underline-position"]+0.5)}if(F.overline){y.moveTo(0,b.ascent+0.5);y.lineTo(L,b.ascent+0.5)}if(F["line-through"]){y.moveTo(0,-b.descent+0.5);y.lineTo(L,-b.descent+0.5)}y.stroke();y.restore()}if(I){y.save();y.transform(1,0,-0.25,1,0,0)}y.beginPath();if(H.d)if(H.code){var Q=H.code;H=y;for(var M=0,R=Q.length;M<R;++M){var O=Q[M];H[O.m].apply(H,O.a)}}else{Q=H;H="m"+H.d;M=y;O=R=0;var S=[],V=/([mrvxe])([^a-z]*)/g,U=void 0,T=0;a:for(;U=V.exec(H);++T){var N=U[2].split(",");switch(U[1]){case "v":S[T]=
{m:"bezierCurveTo",a:[R+~~N[0],O+~~N[1],R+~~N[2],O+~~N[3],R+=~~N[4],O+=~~N[5]]};break;case "r":S[T]={m:"lineTo",a:[R+=~~N[0],O+=~~N[1]]};break;case "m":S[T]={m:"moveTo",a:[R=~~N[0],O=~~N[1]]};break;case "x":S[T]={m:"closePath",a:[]};break;case "e":break a}M[S[T].m].apply(M,S[T].a)}Q.code=S}y.fill();if(g.strokeStyle){y.closePath();y.save();y.lineWidth=g.strokeWidth;y.strokeStyle=g.strokeStyle;y.stroke();y.restore()}I&&y.restore();y.translate(L,0);G+=L}}}var m=c===null,k=b.viewBox,i=d.getSize("fontSize",
b.baseSize),n=d.get("letterSpacing");n=n=="normal"?0:i.convertFrom(parseInt(n,10));var o=0,t=0,p=0,q=g.textShadow,w=[];Cufon.textOptions.shadowOffsets=[];Cufon.textOptions.shadows=null;if(q){Cufon.textOptions.shadows=q;for(var u=0,r=q.length;u<r;++u){var s=q[u],v=i.convertFrom(parseFloat(s.offX));s=i.convertFrom(parseFloat(s.offY));w[u]=[v,s]}}var x=Cufon.CSS.textTransform(m?h.alt:c,d).split(""),z=0;s=null;v=0;var C=1,D=[];u=0;for(r=x.length;u<r;++u)if(x[u]==="\n"){C++;if(z>v)v=z;D.push(z);z=0}else{var B=
b.glyphs[x[u]]||b.missingGlyph;if(B)z+=s=Number(B.w||b.w)+n}D.push(z);z=Math.max(v,z);var A=[];for(u=D.length;u--;)A[u]=z-D[u];if(s===null)return null;t+=k.width-s;p+=k.minX;if(m){m=h;h=h.firstChild}else{m=fabric.document.createElement("span");m.className="cufon cufon-canvas";m.alt=c;h=fabric.document.createElement("canvas");m.appendChild(h);if(g.printable){u=fabric.document.createElement("span");u.className="cufon-alt";u.appendChild(fabric.document.createTextNode(c));m.appendChild(u)}}c=m.style;
r=h.style||{};s=i.convert(k.height-o+0);u=Math.ceil(s);s=u/s;h.width=Math.ceil(i.convert(z+t-p)*s);h.height=u;o+=k.minY;r.top=Math.round(i.convert(o-b.ascent))+"px";r.left=Math.round(i.convert(p))+"px";t=Math.ceil(i.convert(z*s));r=t+"px";s=i.convert(b.height);i=(g.lineHeight-1)*i.convert(-b.ascent/5)*(C-1);Cufon.textOptions.width=t;Cufon.textOptions.height=s*C+i;Cufon.textOptions.lines=C;Cufon.textOptions.totalLineHeight=i;if(l){c.width=r;c.height=s+"px"}else{c.paddingLeft=r;c.paddingBottom=s-1+
"px"}var y=Cufon.textOptions.context||h.getContext("2d"),E=u/k.height;Cufon.textOptions.fontAscent=b.ascent*E;Cufon.textOptions.boundaries=null;k=Cufon.textOptions.shadowOffsets;for(u=w.length;u--;)k[u]=[w[u][0]*E,w[u][1]*E];y.save();y.scale(E,E);y.translate(-p-1/E*h.width/2+(Cufon.fonts[b.family].offsetLeft||0),-o-Cufon.textOptions.height/E/2+(Cufon.fonts[b.family].offsetTop||0));y.lineWidth=b.face["underline-thickness"];y.save();var F=Cufon.getTextDecoration(g),I=g.fontStyle==="italic";y.save();
(function(){y.save();var G=0,J=0,K=[{left:0}];if(g.backgroundColor){y.save();y.fillStyle=g.backgroundColor;y.translate(0,b.ascent);y.fillRect(0,0,z+10,(-b.ascent+b.descent)*C);y.restore()}if(g.textAlign==="right"){y.translate(A[J],0);K[0].left=A[J]*E}else if(g.textAlign==="center"){y.translate(A[J]/2,0);K[0].left=A[J]/2*E}for(var P=0,L=x.length;P<L;++P)if(x[P]==="\n"){J++;var H=-b.ascent-b.ascent/5*g.lineHeight,Q=K[K.length-1],M={left:0};Q.width=G*E;Q.height=(-b.ascent+b.descent)*E;if(g.textAlign===
"right"){y.translate(-z,H);y.translate(A[J],0);M.left=A[J]*E}else if(g.textAlign==="center"){y.translate(-G-A[J-1]/2,H);y.translate(A[J]/2,0);M.left=A[J]/2*E}else y.translate(-G,H);K.push(M);G=0}else if(H=b.glyphs[x[P]]||b.missingGlyph){H=Number(H.w||b.w)+n;if(g.textBackgroundColor){y.save();y.fillStyle=g.textBackgroundColor;y.translate(0,b.ascent);y.fillRect(0,0,H+10,-b.ascent+b.descent);y.restore()}y.translate(H,0);G+=H;if(P==L-1){K[K.length-1].width=G*E;K[K.length-1].height=(-b.ascent+b.descent)*
E}}y.restore();Cufon.textOptions.boundaries=K})();if(q){u=0;for(r=q.length;u<r;++u){s=q[u];y.save();y.translate.apply(y,w[u]);j(s.color);y.restore()}}j();y.restore();y.restore();y.restore();return m}}());
Cufon.registerEngine("vml",function(){function l(a,e){if(/px$/i.test(e))return parseFloat(e);var b=a.style.left,c=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=e;var d=a.style.pixelLeft;a.style.left=b;a.runtimeStyle.left=c;return d}if(fabric.document.namespaces){var f=fabric.document.createElement("canvas");if(!(f&&f.getContext&&f.getContext.apply)){fabric.document.namespaces.cvml==null&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml");f=fabric.document.createElement("cvml:shape");
f.style.behavior="url(#default#VML)";if(f.coordsize){f=null;fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>');
return function(a,e,b,c,d,g,h){var j=e===null;if(j)e=d.alt;var m=a.viewBox,k;if(!(k=b.computedFontSize)){k=Cufon.CSS.Size;var i;i=b.get("fontSize");i=l(g,/(?:em|ex|%)$/i.test(i)?"1em":i);k=b.computedFontSize=new k(i+"px",a.baseSize)}k=k;i=b.computedLSpacing;if(i==undefined){i=b.get("letterSpacing");b.computedLSpacing=i=i=="normal"?0:~~k.convertFrom(l(g,i))}if(j){g=d;d=d.firstChild}else{g=fabric.document.createElement("span");g.className="cufon cufon-vml";g.alt=e;d=fabric.document.createElement("span");
d.className="cufon-vml-canvas";g.appendChild(d);if(c.printable){var n=fabric.document.createElement("span");n.className="cufon-alt";n.appendChild(fabric.document.createTextNode(e));g.appendChild(n)}h||g.appendChild(fabric.document.createElement("cvml:shape"))}h=g.style;var o=d.style,t=k.convert(m.height);n=Math.ceil(t);t=n/t;var p=m.minX,q=m.minY;o.height=n;o.top=Math.round(k.convert(q-a.ascent));o.left=Math.round(k.convert(p));h.height=k.convert(a.height)+"px";Cufon.getTextDecoration(c);o=b.get("color");
e=Cufon.CSS.textTransform(e,b).split("");var w=b=0,u=null,r;c=c.textShadow;for(var s=0,v=0,x=e.length;s<x;++s)if(r=a.glyphs[e[s]]||a.missingGlyph)b+=u=~~(r.w||a.w)+i;if(u===null)return null;r=-p+b+(m.width-u);s=k.convert(r*t);u=Math.round(s);var z=r+","+m.height,C,D="r"+z+"nsnf";for(s=0;s<x;++s)if(r=a.glyphs[e[s]]||a.missingGlyph){if(j){m=d.childNodes[v];m.firstChild&&m.removeChild(m.firstChild)}else{m=fabric.document.createElement("cvml:shape");d.appendChild(m)}m.stroked="f";m.coordsize=z;m.coordorigin=
C=p-w+","+q;m.path=(r.d?"m"+r.d+"xe":"")+"m"+C+D;m.fillcolor=o;C=m.style;C.width=u;C.height=n;if(c){C=c[0];var B=c[1],A=Cufon.CSS.color(C.color),y,E=fabric.document.createElement("cvml:shadow");E.on="t";E.color=A.color;E.offset=C.offX+","+C.offY;if(B){y=Cufon.CSS.color(B.color);E.type="double";E.color2=y.color;E.offset2=B.offX+","+B.offY}E.opacity=A.opacity||y&&y.opacity||1;m.appendChild(E)}w+=~~(r.w||a.w)+i;++v}h.width=Math.max(Math.ceil(k.convert(b*t)),0);return g}}}}}());
Cufon.getTextDecoration=function(l){return{underline:l.textDecoration==="underline",overline:l.textDecoration==="overline","line-through":l.textDecoration==="line-through"}};if(typeof exports!="undefined")exports.Cufon=Cufon;var JSON;JSON||(JSON={});
(function(){function l(j){return j<10?"0"+j:j}function f(j){b.lastIndex=0;return b.test(j)?'"'+j.replace(b,function(m){var k=g[m];return typeof k==="string"?k:"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+j+'"'}function a(j,m){var k,i,n,o,t=c,p,q=m[j];if(q&&typeof q==="object"&&typeof q.toJSON==="function")q=q.toJSON(j);if(typeof h==="function")q=h.call(m,j,q);switch(typeof q){case "string":return f(q);case "number":return isFinite(q)?String(q):"null";case "boolean":case "null":return String(q);
case "object":if(!q)return"null";c+=d;p=[];if(Object.prototype.toString.apply(q)==="[object Array]"){o=q.length;for(k=0;k<o;k+=1)p[k]=a(k,q)||"null";n=p.length===0?"[]":c?"[\n"+c+p.join(",\n"+c)+"\n"+t+"]":"["+p.join(",")+"]";c=t;return n}if(h&&typeof h==="object"){o=h.length;for(k=0;k<o;k+=1)if(typeof h[k]==="string"){i=h[k];if(n=a(i,q))p.push(f(i)+(c?": ":":")+n)}}else for(i in q)if(Object.prototype.hasOwnProperty.call(q,i))if(n=a(i,q))p.push(f(i)+(c?": ":":")+n);n=p.length===0?"{}":c?"{\n"+c+p.join(",\n"+
c)+"\n"+t+"}":"{"+p.join(",")+"}";c=t;return n}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+l(this.getUTCMonth()+1)+"-"+l(this.getUTCDate())+"T"+l(this.getUTCHours())+":"+l(this.getUTCMinutes())+":"+l(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c,d,g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof JSON.stringify!=="function")JSON.stringify=function(j,m,k){var i;d=c="";if(typeof k==="number")for(i=0;i<k;i+=1)d+=" ";else if(typeof k==="string")d=k;if((h=m)&&typeof m!=="function"&&(typeof m!=="object"||typeof m.length!=="number"))throw Error("JSON.stringify");return a("",
{"":j})};if(typeof JSON.parse!=="function")JSON.parse=function(j,m){function k(n,o){var t,p,q=n[o];if(q&&typeof q==="object")for(t in q)if(Object.prototype.hasOwnProperty.call(q,t)){p=k(q,t);if(p!==undefined)q[t]=p;else delete q[t]}return m.call(n,o,q)}var i;j=String(j);e.lastIndex=0;if(e.test(j))j=j.replace(e,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(j.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){i=eval("("+j+")");return typeof m==="function"?k({"":i},""):i}throw new SyntaxError("JSON.parse");}})();if(typeof document=="undefined"&&typeof navigator=="undefined")var document=fabric.document,navigator=fabric.window.navigator;if(typeof Event==="undefined")var Event={};if(typeof eventjs==="undefined")var eventjs=Event;
Event=function(l){l.modifyEventListener=false;l.modifySelectors=false;l.add=function(k,i,n,o){return a(k,i,n,o,"add")};l.remove=function(k,i,n,o){return a(k,i,n,o,"remove")};l.stop=function(k){k.stopPropagation&&k.stopPropagation();k.cancelBubble=true;k.bubble=0};l.prevent=function(k){k.preventDefault&&k.preventDefault();k.returnValue=false};l.cancel=function(k){l.stop(k);l.prevent(k)};l.supports=function(k,i){if(typeof k==="string"){i=k;k=window}i="on"+i;if(i in k)return true;k.setAttribute||(k=
document.createElement("div"));if(k.setAttribute&&k.removeAttribute){k.setAttribute(i,"");var n=typeof k[i]==="function";if(typeof k[i]!=="undefined")k[i]=null;k.removeAttribute(i);return n}};var f=function(k){if(!k||typeof k!=="object")return k;var i=new k.constructor;for(var n in k)i[n]=!k[n]||typeof k[n]!=="object"?k[n]:f(k[n]);return i},a=function(k,i,n,o,t,p){o=o||{};if(typeof k==="string"&&i==="ready")var q=(new Date).getTime(),w=o.timeout,u=window.setInterval(function(){(new Date).getTime()-
q>w&&window.clearInterval(u);if(document.querySelector(k)){window.clearInterval(u);n()}},o.interval||1E3/60);else{if(typeof k==="string"){k=document.querySelectorAll(k);if(k.length===0)return b("Missing target on listener!");if(k.length===1)k=k[0]}var r={};if(k.length>0){for(var s=0,v=k.length;s<v;s++)if(p=a(k[s],i,n,f(o),t))r[s]=p;return e(r)}if(i.indexOf&&i.indexOf(" ")!==-1)i=i.split(" ");if(i.indexOf&&i.indexOf(",")!==-1)i=i.split(",");if(typeof i!=="string"){if(typeof i.length==="number"){s=
0;for(v=i.length;s<v;s++)if(p=a(k,i[s],n,f(o),t))r[i[s]]=p}else for(s in i)if(p=typeof i[s]==="function"?a(k,s,i[s],f(o),t):a(k,s,i[s].listener,f(i[s]),t))r[s]=p;return e(r)}if(typeof n!=="function")return b("Listener is not a function!");r=o.useCapture||false;s=c(i)+h(k)+"."+h(n)+"."+(r?1:0);if(l.Gesture&&l.Gesture._gestureHandlers[i])if(t==="remove"){if(!d[s])return;d[s].remove();delete d[s]}else{if(t==="add"){if(d[s])return d[s];if(o.useCall&&!l.modifyEventListener){var x=n;n=function(z,C){for(var D in C)z[D]=
C[D];return x.call(k,z)}}o.gesture=i;o.target=k;o.listener=n;o.fromOverwrite=p;d[s]=l.proxy[i](o)}}else{i=c(i);if(t==="remove"){if(!d[s])return;k[m](i,n,r);delete d[s]}else if(t==="add"){if(d[s])return d[s];k[j](i,n,r);d[s]={type:i,target:k,listener:n,remove:function(){l.remove(k,i,n,o)}}}}return d[s]}},e=function(k){return{remove:function(){for(var i in k)k[i].remove()},add:function(){for(var i in k)k[i].add()}}},b=function(k){typeof console!=="undefined"&&typeof console.error!=="undefined"&&console.error(k)},
c=function(){var k={};return function(i){if(!l.pointerType)if(window.navigator.msPointerEnabled){l.pointerType="mspointer";k={mousedown:"MSPointerDown",mousemove:"MSPointerMove",mouseup:"MSPointerUp"}}else if(l.supports("touchstart")){l.pointerType="touch";k={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"}}else l.pointerType="mouse";if(k[i])i=k[i];return document.addEventListener?i:"on"+i}}(),d={},g=0,h=function(k){if(k===window)return"#window";if(k===document)return"#document";if(!k)return b("Missing target on listener!");
if(!k.uniqueID)k.uniqueID="id"+g++;return k.uniqueID},j=document.addEventListener?"addEventListener":"attachEvent",m=document.removeEventListener?"removeEventListener":"detachEvent";l.createPointerEvent=function(k,i,n){var o=i.gesture,t=i.target,p=k.changedTouches||l.proxy.getCoords(k);if(p.length){var q=p[0];i.pointers=n?[]:p;i.pageX=q.pageX;i.pageY=q.pageY;i.x=i.pageX;i.y=i.pageY}n=document.createEvent("Event");n.initEvent(o,true,true);n.originalEvent=k;for(var w in i)if(w!=="target")n[w]=i[w];
t.dispatchEvent(n)};l.modifyEventListener&&window.HTMLElement&&function(){var k=function(i){var n=function(o){var t=o+"EventListener",p=i[t];i[t]=function(q,w,u){if(l.Gesture&&l.Gesture._gestureHandlers[q]){var r=u;if(typeof u==="object")r.useCall=true;else r={useCall:true,useCapture:u};a(this,q,w,r,o,true);p.call(this,q,w,u)}else p.call(this,c(q),w,u)}};n("add");n("remove")};if(navigator.userAgent.match(/Firefox/)){k(HTMLDivElement.prototype);k(HTMLCanvasElement.prototype)}else k(HTMLElement.prototype);
k(document);k(window)}();l.modifySelectors&&function(){var k=NodeList.prototype;k.removeEventListener=function(i,n,o){for(var t=0,p=this.length;t<p;t++)this[t].removeEventListener(i,n,o)};k.addEventListener=function(i,n,o){for(var t=0,p=this.length;t<p;t++)this[t].addEventListener(i,n,o)}}();return l}(Event);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.pointerSetup=function(f,a){f.doc=f.target.ownerDocument||f.target;f.minFingers=f.minFingers||f.fingers||1;f.maxFingers=f.maxFingers||f.fingers||Infinity;f.position=f.position||"relative";delete f.fingers;a=a||{};a.gesture=f.gesture;a.target=f.target;a.pointerType=Event.pointerType;if(Event.modifyEventListener&&f.fromOverwrite)f.listener=Event.createPointerEvent;var e=0,b=a.gesture.indexOf("pointer")===0&&Event.modifyEventListener?"pointer":"mouse";a.listener=f.listener;a.proxy=
function(c){a.defaultListener=f.listener;f.listener=c;c(f.event,a)};a.remove=function(){f.onPointerDown&&Event.remove(f.target,b+"down",f.onPointerDown);f.onPointerMove&&Event.remove(f.doc,b+"move",f.onPointerMove);f.onPointerUp&&Event.remove(f.doc,b+"up",f.onPointerUp)};a.resume=function(c){if(f.onPointerMove&&(!c||c.move))Event.add(f.doc,b+"move",f.onPointerMove);if(f.onPointerUp&&(!c||c.move))Event.add(f.doc,b+"up",f.onPointerUp);f.fingers=e};a.pause=function(c){e=f.fingers;if(f.onPointerMove&&
(!c||c.move))Event.remove(f.doc,b+"move",f.onPointerMove);if(f.onPointerUp&&(!c||c.up))Event.remove(f.doc,b+"up",f.onPointerUp);f.fingers=0};return a};l.pointerStart=function(f,a,e){var b=function(n,o){var t=e.bbox,p=d[o]={};switch(e.position){case "absolute":p.offsetX=0;p.offsetY=0;break;case "difference":p.offsetX=n.pageX;p.offsetY=n.pageY;break;case "move":p.offsetX=n.pageX-t.x1;p.offsetY=n.pageY-t.y1;break;default:p.offsetX=t.x1;p.offsetY=t.y1;break}if(e.position==="relative"){var q=(n.pageX+
t.scrollLeft-p.offsetX)*t.scaleX;t=(n.pageY+t.scrollTop-p.offsetY)*t.scaleY}else{q=n.pageX-p.offsetX;t=n.pageY-p.offsetY}p.rotation=0;p.scale=1;p.startTime=p.moveTime=(new Date).getTime();p.move={x:q,y:t};p.start={x:q,y:t};e.fingers++};e.event=f;if(a.defaultListener){e.listener=a.defaultListener;delete a.defaultListener}var c=!e.fingers,d=e.tracker;f=f.changedTouches||l.getCoords(f);for(var g=f.length,h=0;h<g;h++){var j=f[h],m=j.identifier||Infinity;if(e.fingers){if(e.fingers>=e.maxFingers){b=[];
for(m in e.tracker)b.push(m);a.identifier=b.join(",");return c}var k=0;for(var i in d){if(d[i].up){delete d[i];b(j,m);e.cancel=true;break}k++}if(d[m])continue}else{d=e.tracker={};a.bbox=e.bbox=l.getBoundingBox(e.target);e.fingers=0;e.cancel=false}b(j,m)}b=[];for(m in e.tracker)b.push(m);a.identifier=b.join(",");return c};l.pointerEnd=function(f,a,e,b){var c=f.touches||[],d=c.length;f={};for(var g=0;g<d;g++){var h=c[g].identifier;f[h||Infinity]=true}for(h in e.tracker){c=e.tracker[h];if(!(f[h]||c.up)){if(b)b({pageX:c.pageX,
pageY:c.pageY,changedTouches:[{pageX:c.pageX,pageY:c.pageY,identifier:h==="Infinity"?Infinity:h}]},"up");c.up=true;e.fingers--}}if(e.fingers!==0)return false;b=[];e.gestureFingers=0;for(h in e.tracker){e.gestureFingers++;b.push(h)}a.identifier=b.join(",");return true};l.getCoords=function(f){l.getCoords=typeof f.pageX!=="undefined"?function(a){return Array({type:"mouse",x:a.pageX,y:a.pageY,pageX:a.pageX,pageY:a.pageY,identifier:Infinity})}:function(a){a=a||window.event;return Array({type:"mouse",
x:a.clientX+document.documentElement.scrollLeft,y:a.clientY+document.documentElement.scrollTop,pageX:a.clientX+document.documentElement.scrollLeft,pageY:a.clientY+document.documentElement.scrollTop,identifier:Infinity})};return l.getCoords(f)};l.getCoord=function(f){if("ontouchstart"in window){var a=0,e=0;l.getCoord=function(b){b=b.changedTouches;return b.length?{x:a=b[0].pageX,y:e=b[0].pageY}:{x:a,y:e}}}else l.getCoord=typeof f.pageX!=="undefined"&&typeof f.pageY!=="undefined"?function(b){return{x:b.pageX,
y:b.pageY}}:function(b){b=b||window.event;return{x:b.clientX+document.documentElement.scrollLeft,y:b.clientY+document.documentElement.scrollTop}};return l.getCoord(f)};l.getBoundingBox=function(f){if(f===window||f===document)f=document.body;var a={x1:0,y1:0,x2:0,y2:0,scrollLeft:0,scrollTop:0};if(f===document.body){a.height=window.innerHeight;a.width=window.innerWidth}else{a.height=f.offsetHeight;a.width=f.offsetWidth}a.scaleX=f.width/a.width||1;a.scaleY=f.height/a.height||1;for(var e=f;e!==null;){a.x1+=
e.offsetLeft;a.y1+=e.offsetTop;e=e.offsetParent}for(e=f.parentNode;e!==null;){if(e===document.body)break;if(e.scrollTop===undefined)break;a.scrollLeft+=e.scrollLeft;a.scrollTop+=e.scrollTop;e=e.parentNode}a.x2=a.x1+a.width;a.y2=a.y1+a.height;return a};(function(){var f=navigator.userAgent.toLowerCase(),a=f.indexOf("macintosh")!==-1,e=a&&f.indexOf("khtml")!==-1?{91:true,93:true}:a&&f.indexOf("firefox")!==-1?{224:true}:{17:true};l.isMetaKey=function(b){return!!e[b.keyCode]};l.metaTracker=function(b){if(e[b.keyCode])l.metaKey=
b.type==="keydown"}})();return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.click=function(f){f.maxFingers=f.maxFingers||f.fingers||1;var a;f.onPointerDown=function(b){if(l.pointerStart(b,e,f)){Event.add(f.doc,"mousemove",f.onPointerMove).listener(b);Event.add(f.doc,"mouseup",f.onPointerUp)}};f.onPointerMove=function(b){a=b};f.onPointerUp=function(b){if(l.pointerEnd(b,e,f)){Event.remove(f.doc,"mousemove",f.onPointerMove);Event.remove(f.doc,"mouseup",f.onPointerUp);if(!(a.cancelBubble&&++a.bubble>1)){var c=(a.changedTouches||l.getCoords(a))[0];b=
f.bbox;var d=l.getBoundingBox(f.target);if(f.position==="relative"){var g=(c.pageX+b.scrollLeft-b.x1)*b.scaleX;c=(c.pageY+b.scrollTop-b.y1)*b.scaleY}else{g=c.pageX-b.x1;c=c.pageY-b.y1}g>0&&g<b.width&&c>0&&c<b.height&&b.scrollTop===d.scrollTop&&f.listener(a,e)}}};var e=l.pointerSetup(f);e.state="click";Event.add(f.target,"mousedown",f.onPointerDown);return e};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.click=l.click;
return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.dbltap=l.dblclick=function(f){f.maxFingers=f.maxFingers||f.fingers||1;var a,e,b,c,d;f.onPointerDown=function(h){var j=h.changedTouches||l.getCoords(h);if(a&&!e){d=j[0];e=(new Date).getTime()-a}else{c=j[0];a=(new Date).getTime();e=0;clearTimeout(b);b=setTimeout(function(){a=0},700)}if(l.pointerStart(h,g,f)){Event.add(f.doc,"mousemove",f.onPointerMove).listener(h);Event.add(f.doc,"mouseup",f.onPointerUp)}};f.onPointerMove=function(h){if(a&&!e)d=(h.changedTouches||l.getCoords(h))[0];
h=f.bbox;if(f.position==="relative")var j=(d.pageX+h.scrollLeft-h.x1)*h.scaleX,m=(d.pageY+h.scrollTop-h.y1)*h.scaleY;else{j=d.pageX-h.x1;m=d.pageY-h.y1}if(!(j>0&&j<h.width&&m>0&&m<h.height&&Math.abs(d.pageX-c.pageX)<=25&&Math.abs(d.pageY-c.pageY)<=25)){Event.remove(f.doc,"mousemove",f.onPointerMove);clearTimeout(b);a=e=0}};f.onPointerUp=function(h){if(l.pointerEnd(h,g,f)){Event.remove(f.doc,"mousemove",f.onPointerMove);Event.remove(f.doc,"mouseup",f.onPointerUp)}if(a&&e){if(e<=700&&!(h.cancelBubble&&
++h.bubble>1)){g.state=f.gesture;f.listener(h,g)}clearTimeout(b);a=e=0}};var g=l.pointerSetup(f);g.state="dblclick";Event.add(f.target,"mousedown",f.onPointerDown);return g};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.dbltap=l.dbltap;Event.Gesture._gestureHandlers.dblclick=l.dblclick;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.dragElement=function(f,a){l.drag({event:a,target:f,position:"move",listener:function(e,b){f.style.left=b.x+"px";f.style.top=b.y+"px";Event.prevent(e)}})};l.drag=function(f){f.gesture="drag";f.onPointerDown=function(e){if(l.pointerStart(e,a,f))if(!f.monitor){Event.add(f.doc,"mousemove",f.onPointerMove);Event.add(f.doc,"mouseup",f.onPointerUp)}f.onPointerMove(e,"down")};f.onPointerMove=function(e,b){if(!f.tracker)return f.onPointerDown(e);for(var c=f.bbox,d=e.changedTouches||
l.getCoords(e),g=d.length,h=0;h<g;h++){var j=d[h],m=j.identifier||Infinity,k=f.tracker[m];if(k){k.pageX=j.pageX;k.pageY=j.pageY;a.state=b||"move";a.identifier=m;a.start=k.start;a.fingers=f.fingers;if(f.position==="relative"){a.x=(k.pageX+c.scrollLeft-k.offsetX)*c.scaleX;a.y=(k.pageY+c.scrollTop-k.offsetY)*c.scaleY}else{a.x=k.pageX-k.offsetX;a.y=k.pageY-k.offsetY}f.listener(e,a)}}};f.onPointerUp=function(e){if(l.pointerEnd(e,a,f,f.onPointerMove))if(!f.monitor){Event.remove(f.doc,"mousemove",f.onPointerMove);
Event.remove(f.doc,"mouseup",f.onPointerUp)}};var a=l.pointerSetup(f);if(f.event)f.onPointerDown(f.event);else{Event.add(f.target,"mousedown",f.onPointerDown);if(f.monitor){Event.add(f.doc,"mousemove",f.onPointerMove);Event.add(f.doc,"mouseup",f.onPointerUp)}}return a};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.drag=l.drag;return l}(Event.proxy);if(typeof Event==="undefined")Event={};
if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){var f=Math.PI/180;l.gesture=function(a){a.minFingers=a.minFingers||a.fingers||2;a.onPointerDown=function(b){var c=a.fingers;if(l.pointerStart(b,e,a)){Event.add(a.doc,"mousemove",a.onPointerMove);Event.add(a.doc,"mouseup",a.onPointerUp)}if(a.fingers===a.minFingers&&c!==a.fingers){e.fingers=a.minFingers;e.scale=1;e.rotation=0;e.state="start";c="";for(var d in a.tracker)c+=d;e.identifier=parseInt(c);a.listener(b,e)}};a.onPointerMove=function(b){for(var c=a.bbox,d=a.tracker,g=
b.changedTouches||l.getCoords(b),h=g.length,j=0;j<h;j++){var m=g[j],k=m.identifier||Infinity,i=d[k];if(i)if(a.position==="relative"){i.move.x=(m.pageX+c.scrollLeft-c.x1)*c.scaleX;i.move.y=(m.pageY+c.scrollTop-c.y1)*c.scaleY}else{i.move.x=m.pageX-c.x1;i.move.y=m.pageY-c.y1}}if(!(a.fingers<a.minFingers)){g=[];var n=i=j=c=0;h=0;for(k in d){m=d[k];if(!m.up){i+=m.move.x;n+=m.move.y;h++}}i/=h;n/=h;for(k in d){m=d[k];if(!m.up){h=m.start;if(!h.distance){var o=h.x-i,t=h.y-n;h.distance=Math.sqrt(o*o+t*t);h.angle=
Math.atan2(o,t)/f}o=m.move.x-i;t=m.move.y-n;c+=Math.sqrt(o*o+t*t)/h.distance;h=(h.angle-Math.atan2(o,t)/f+360)%360-180;m.DEG2=m.DEG1;m.DEG1=h>0?h:-h;if(typeof m.DEG2!=="undefined"){if(h>0)m.rotation+=m.DEG1-m.DEG2;else m.rotation-=m.DEG1-m.DEG2;j+=m.rotation}g.push(m.move)}}e.touches=g;e.fingers=a.fingers;e.scale=c/a.fingers;e.rotation=j/a.fingers;e.state="change";a.listener(b,e)}};a.onPointerUp=function(b){var c=a.fingers;if(l.pointerEnd(b,e,a)){Event.remove(a.doc,"mousemove",a.onPointerMove);Event.remove(a.doc,
"mouseup",a.onPointerUp)}if(c===a.minFingers&&a.fingers<a.minFingers){e.fingers=a.fingers;e.state="end";a.listener(b,e)}};var e=l.pointerSetup(a);Event.add(a.target,"mousedown",a.onPointerDown);return e};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.gesture=l.gesture;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.pointerdown=l.pointermove=l.pointerup=function(f){if(!f.target.isPointerEmitter){var a=true;f.onPointerDown=function(b){a=false;e.gesture="pointerdown";f.listener(b,e)};f.onPointerMove=function(b){e.gesture="pointermove";f.listener(b,e,a)};f.onPointerUp=function(b){a=true;e.gesture="pointerup";f.listener(b,e,true)};var e=l.pointerSetup(f);Event.add(f.target,"mousedown",f.onPointerDown);Event.add(f.target,"mousemove",f.onPointerMove);Event.add(f.doc,"mouseup",f.onPointerUp);
f.target.isPointerEmitter=true;return e}};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.pointerdown=l.pointerdown;Event.Gesture._gestureHandlers.pointermove=l.pointermove;Event.Gesture._gestureHandlers.pointerup=l.pointerup;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.shake=function(f){var a={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:f.target,listener:f.listener,remove:function(){window.removeEventListener("devicemotion",d,false)}},e=(new Date).getTime(),b={x:0,y:0,z:0},c={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},d=function(g){var h=g.accelerationIncludingGravity;b.x=0.8*b.x+(1-0.8)*h.x;b.y=0.8*b.y+(1-0.8)*h.y;b.z=0.8*b.z+(1-0.8)*h.z;a.accelerationIncludingGravity=b;a.acceleration.x=
h.x-b.x;a.acceleration.y=h.y-b.y;a.acceleration.z=h.z-b.z;if(f.gesture==="devicemotion")f.listener(g,a);else{h=(new Date).getTime();for(var j=0;j<3;j++){var m="xyz"[j],k=a.acceleration[m];m=c[m];var i=Math.abs(k);if(!(h-e<1E3))if(i>4){k=h*k/i;i=Math.abs(k+m.value);if(m.value&&i<200){m.value=k;m.count++;if(m.count===3){f.listener(g,a);e=h;m.value=0;m.count=0}}else{m.value=k;m.count=1}}}}};if(window.addEventListener){window.addEventListener("devicemotion",d,false);return a}};Event.Gesture=Event.Gesture||
{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.shake=l.shake;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){var f=Math.PI/180;l.swipe=function(a){a.snap=a.snap||90;a.threshold=a.threshold||1;a.onPointerDown=function(b){if(l.pointerStart(b,e,a)){Event.add(a.doc,"mousemove",a.onPointerMove).listener(b);Event.add(a.doc,"mouseup",a.onPointerUp)}};a.onPointerMove=function(b){b=b.changedTouches||l.getCoords(b);for(var c=b.length,d=0;d<c;d++){var g=b[d],h=a.tracker[g.identifier||Infinity];if(h){h.move.x=g.pageX;h.move.y=g.pageY;h.moveTime=(new Date).getTime()}}};a.onPointerUp=function(b){if(l.pointerEnd(b,
e,a)){Event.remove(a.doc,"mousemove",a.onPointerMove);Event.remove(a.doc,"mouseup",a.onPointerUp);var c,d,g,h,j={x:0,y:0},m=0,k=0,i=0;for(var n in a.tracker){var o=a.tracker[n];h=o.move.x-o.start.x;var t=o.move.y-o.start.y;m+=o.move.x;k+=o.move.y;j.x+=o.start.x;j.y+=o.start.y;i++;d=Math.sqrt(h*h+t*t);o=o.moveTime-o.startTime;h=Math.atan2(h,t)/f+180;d=o?d/o:0;if(typeof g==="undefined"){g=h;c=d}else if(Math.abs(h-g)<=20){g=(g+h)/2;c=(c+d)/2}else return}if(c>a.threshold){j.x/=i;j.y/=i;e.start=j;e.x=
m/i;e.y=k/i;e.angle=-(((g/a.snap+0.5>>0)*a.snap||360)-360);e.velocity=c;e.fingers=a.gestureFingers;e.state="swipe";a.listener(b,e)}}};var e=l.pointerSetup(a);Event.add(a.target,"mousedown",a.onPointerDown);return e};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.swipe=l.swipe;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.tap=l.longpress=function(f){f.delay=f.delay||500;f.timeout=f.timeout||250;var a,e;f.onPointerDown=function(c){if(l.pointerStart(c,b,f)){a=(new Date).getTime();Event.add(f.doc,"mousemove",f.onPointerMove).listener(c);Event.add(f.doc,"mouseup",f.onPointerUp);if(f.gesture==="longpress")e=setTimeout(function(){if(!(c.cancelBubble&&++c.bubble>1)){var d=0;for(var g in f.tracker){if(f.tracker[g].end===true)return;if(f.cancel)return;d++}b.state="start";b.fingers=d;f.listener(c,b)}},
f.delay)}};f.onPointerMove=function(c){var d=f.bbox;c=c.changedTouches||l.getCoords(c);for(var g=c.length,h=0;h<g;h++){var j=c[h],m=f.tracker[j.identifier||Infinity];if(m){if(f.position==="relative"){var k=(j.pageX+d.scrollLeft-d.x1)*d.scaleX;j=(j.pageY+d.scrollTop-d.y1)*d.scaleY}else{k=j.pageX-d.x1;j=j.pageY-d.y1}if(!(k>0&&k<d.width&&j>0&&j<d.height&&Math.abs(k-m.start.x)<=25&&Math.abs(j-m.start.y)<=25)){Event.remove(f.doc,"mousemove",f.onPointerMove);f.cancel=true;return}}}};f.onPointerUp=function(c){if(l.pointerEnd(c,
b,f)){clearTimeout(e);Event.remove(f.doc,"mousemove",f.onPointerMove);Event.remove(f.doc,"mouseup",f.onPointerUp);if(!(c.cancelBubble&&++c.bubble>1))if(f.gesture==="longpress"){if(b.state==="start"){b.state="end";f.listener(c,b)}}else if(!f.cancel)if(!((new Date).getTime()-a>f.timeout)){b.state="tap";b.fingers=f.gestureFingers;f.listener(c,b)}}};var b=l.pointerSetup(f);Event.add(f.target,"mousedown",f.onPointerDown);return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||
{};Event.Gesture._gestureHandlers.tap=l.tap;Event.Gesture._gestureHandlers.longpress=l.longpress;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.wheel=function(f){var a,e=f.timeout||150,b=0,c={gesture:"wheel",state:"start",wheelDelta:0,target:f.target,listener:f.listener,remove:function(){f.target[h](j,d,false)}},d=function(m){m=m||window.event;c.state=b++?"change":"start";c.wheelDelta=m.detail?m.detail*-20:m.wheelDelta;f.listener(m,c);clearTimeout(a);a=setTimeout(function(){b=0;c.state="end";c.wheelDelta=0;f.listener(m,c)},e)},g=document.addEventListener?"addEventListener":"attachEvent",h=document.removeEventListener?
"removeEventListener":"detachEvent",j=Event.supports("mousewheel")?"mousewheel":"DOMMouseScroll";f.target[g](j,d,false);return c};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.wheel=l.wheel;return l}(Event.proxy);fabric.log=function(){};fabric.warn=function(){};
if(typeof console!=="undefined"){if(typeof console.log!=="undefined"&&console.log.apply)fabric.log=function(){return console.log.apply(console,arguments)};if(typeof console.warn!=="undefined"&&console.warn.apply)fabric.warn=function(){return console.warn.apply(console,arguments)}}
fabric.Observable={observe:function(l,f){if(!this.__eventListeners)this.__eventListeners={};if(arguments.length===1)for(var a in l)this.on(a,l[a]);else{this.__eventListeners[l]||(this.__eventListeners[l]=[]);this.__eventListeners[l].push(f)}},stopObserving:function(l,f){if(!this.__eventListeners)this.__eventListeners={};if(this.__eventListeners[l])if(f)fabric.util.removeFromArray(this.__eventListeners[l],f);else this.__eventListeners[l].length=0},fire:function(l,f){if(!this.__eventListeners)this.__eventListeners=
{};var a=this.__eventListeners[l];if(a)for(var e=0,b=a.length;e<b;e++)a[e](f||{})}};fabric.Observable.on=fabric.Observable.observe;fabric.Observable.off=fabric.Observable.stopObserving;fabric.Observable.trigger=fabric.Observable.fire;
(function(){var l=Math.sqrt,f=Math.atan2;fabric.util={};var a=Math.PI/180,e=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(c){fabric.window.setTimeout(c,1E3/60)},b=function(){return e.apply(fabric.window,arguments)};fabric.util.removeFromArray=function(c,d){var g=c.indexOf(d);g!==-1&&c.splice(g,1);return c};fabric.util.degreesToRadians=function(c){return c*
a};fabric.util.radiansToDegrees=function(c){return c/a};fabric.util.rotatePoint=function(c,d,g){var h=Math.sin(g);g=Math.cos(g);c.subtractEquals(d);return(new fabric.Point(c.x*g-c.y*h,c.x*h+c.y*g)).addEquals(d)};fabric.util.toFixed=function(c,d){return parseFloat(Number(c).toFixed(d))};fabric.util.getRandomInt=function(c,d){return Math.floor(Math.random()*(d-c+1))+c};fabric.util.falseFunction=function(){return false};fabric.util.animate=function(c){c||(c={});var d=+new Date,g=c.duration||500,h=d+
g,j,m=c.onChange||function(){},k=c.abort||function(){return false},i=c.easing||function(p,q,w,u){return-w*Math.cos(p/u*(Math.PI/2))+w+q},n="startValue"in c?c.startValue:0,o="endValue"in c?c.endValue:100,t=c.byValue||o-n;c.onStart&&c.onStart();(function p(){j=+new Date;m(i(j>h?g:j-d,n,t,g));if(j>h||k())c.onComplete&&c.onComplete();else b(p)})()};fabric.util.requestAnimFrame=b;fabric.util.loadImage=function(c,d,g){if(c){var h=new Image;h.onload=function(){d&&d.call(g,h);h=h.onload=null};h.src=c}else d&&
d.call(g,c)};fabric.util.enlivenObjects=function(c,d){var g=[],h=0,j=c.length;c.forEach(function(m,k){if(m.type){var i=fabric[fabric.util.string.camelize(fabric.util.string.capitalize(m.type))];if(i.async)i.fromObject(m,function(n,o){o||(g[k]=n);++h===j&&d&&d(g)});else{g[k]=i.fromObject(m);++h===j&&d&&d(g)}}})};fabric.util.groupSVGElements=function(c,d,g){var h;if(c.length>1)if(c.some(function(j){return j.type==="text"})){h=new fabric.Group([],d);c.reverse().forEach(function(j){if(j.cx)j.left=j.cx;
if(j.cy)j.top=j.cy;h.addWithUpdate(j)})}else h=new fabric.PathGroup(c,d);else h=c[0];typeof g!=="undefined"&&h.setSourcePath(g);return h};fabric.util.populateWithProperties=function(c,d,g){if(g&&Object.prototype.toString.call(g)==="[object Array]")for(var h=0,j=g.length;h<j;h++)d[g[h]]=c[g[h]]};fabric.util.drawDashedLine=function(c,d,g,h,j,m){h=h-d;var k=j-g;j=l(h*h+k*k);h=f(k,h);k=m.length;var i=0,n=true;c.save();c.translate(d,g);c.moveTo(0,0);c.rotate(h);for(d=0;j>d;){d+=m[i++%k];if(d>j)d=j;c[n?
"lineTo":"moveTo"](d,0);n=!n}c.restore()};fabric.util.createCanvasElement=function(c){c||(c=fabric.document.createElement("canvas"));!c.getContext&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(c);return c};fabric.util.createAccessors=function(c){c=c.prototype;for(var d=c.stateProperties.length;d--;){var g=c.stateProperties[d],h=g.charAt(0).toUpperCase()+g.slice(1),j="set"+h;h="get"+h;c[h]||(c[h]=new Function('return this.get("'+g+'")'));c[j]||(c[j]=new Function("value",
'return this.set("'+g+'", value)'))}};fabric.util.clipContext=function(c,d){d.save();d.beginPath();c.clipTo(d);d.clip()}})();
(function(){var l=Array.prototype.slice;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(f){if(this===void 0||this===null)throw new TypeError;var a=Object(this),e=a.length>>>0;if(e===0)return-1;var b=0;if(arguments.length>0){b=Number(arguments[1]);if(b!==b)b=0;else if(b!==0&&b!==Number.POSITIVE_INFINITY&&b!==Number.NEGATIVE_INFINITY)b=(b>0||-1)*Math.floor(Math.abs(b))}if(b>=e)return-1;for(b=b>=0?b:Math.max(e-Math.abs(b),0);b<e;b++)if(b in a&&a[b]===f)return b;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=
function(f,a){for(var e=0,b=this.length>>>0;e<b;e++)e in this&&f.call(a,this[e],e,this)};if(!Array.prototype.map)Array.prototype.map=function(f,a){for(var e=[],b=0,c=this.length>>>0;b<c;b++)if(b in this)e[b]=f.call(a,this[b],b,this);return e};if(!Array.prototype.every)Array.prototype.every=function(f,a){for(var e=0,b=this.length>>>0;e<b;e++)if(e in this&&!f.call(a,this[e],e,this))return false;return true};if(!Array.prototype.some)Array.prototype.some=function(f,a){for(var e=0,b=this.length>>>0;e<
b;e++)if(e in this&&f.call(a,this[e],e,this))return true;return false};if(!Array.prototype.filter)Array.prototype.filter=function(f,a){for(var e=[],b,c=0,d=this.length>>>0;c<d;c++)if(c in this){b=this[c];f.call(a,b,c,this)&&e.push(b)}return e};if(!Array.prototype.reduce)Array.prototype.reduce=function(f){var a=this.length>>>0,e=0,b;if(arguments.length>1)b=arguments[1];else{do{if(e in this){b=this[e++];break}if(++e>=a)throw new TypeError;}while(1)}for(;e<a;e++)if(e in this)b=f.call(null,b,this[e],
e,this);return b};fabric.util.array={invoke:function(f,a){for(var e=l.call(arguments,2),b=[],c=0,d=f.length;c<d;c++)b[c]=e.length?f[c][a].apply(f[c],e):f[c][a].call(f[c]);return b},min:function(f,a){if(!(!f||f.length===0)){var e=f.length-1,b=a?f[e][a]:f[e];if(a)for(;e--;){if(f[e][a]<b)b=f[e][a]}else for(;e--;)if(f[e]<b)b=f[e];return b}},max:function(f,a){if(!(!f||f.length===0)){var e=f.length-1,b=a?f[e][a]:f[e];if(a)for(;e--;){if(f[e][a]>=b)b=f[e][a]}else for(;e--;)if(f[e]>=b)b=f[e];return b}}}})();
(function(){function l(f,a){for(var e in a)f[e]=a[e];return f}fabric.util.object={extend:l,clone:function(f){return l({},f)}}})();
(function(){if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")};fabric.util.string={camelize:function(l){return l.replace(/-+(.)?/g,function(f,a){return a?a.toUpperCase():""})},capitalize:function(l){return l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()},escapeXml:function(l){return l.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var l=Array.prototype.slice,f=Function.prototype.apply,a=function(){};if(!Function.prototype.bind)Function.prototype.bind=function(e){var b=this,c=l.call(arguments,1),d;d=c.length?function(){return f.call(b,this instanceof a?this:e,c.concat(l.call(arguments)))}:function(){return f.call(b,this instanceof a?this:e,arguments)};a.prototype=this.prototype;d.prototype=new a;return d}})();
(function(){function l(){}function f(d){var g=this.constructor.superclass.prototype[d];return arguments.length>1?g.apply(this,a.call(arguments,1)):g.call(this)}var a=Array.prototype.slice,e=function(){},b=function(){for(var d in{toString:1})if(d==="toString")return false;return true}(),c=function(d,g,h){for(var j in g){d.prototype[j]=j in d.prototype&&typeof d.prototype[j]==="function"&&(g[j]+"").indexOf("callSuper")>-1?function(m){return function(){var k=this.constructor.superclass;this.constructor.superclass=
h;var i=g[m].apply(this,arguments);this.constructor.superclass=k;if(m!=="initialize")return i}}(j):g[j];if(b){if(g.toString!==Object.prototype.toString)d.prototype.toString=g.toString;if(g.valueOf!==Object.prototype.valueOf)d.prototype.valueOf=g.valueOf}}};fabric.util.createClass=function(){function d(){this.initialize.apply(this,arguments)}var g=null,h=a.call(arguments,0);if(typeof h[0]==="function")g=h.shift();d.superclass=g;d.subclasses=[];if(g){l.prototype=g.prototype;d.prototype=new l;g.subclasses.push(d)}for(var j=
0,m=h.length;j<m;j++)c(d,h[j],g);if(!d.prototype.initialize)d.prototype.initialize=e;d.prototype.constructor=d;d.prototype.callSuper=f;return d}})();
(function(){function l(i){var n=Array.prototype.slice.call(arguments,1),o,t,p=n.length;for(t=0;t<p;t++){o=typeof i[n[t]];if(!/^(?:function|object|unknown)$/.test(o))return false}return true}function f(i,n){return function(o){n.call(b(i),o||fabric.window.event)}}function a(i,n){return function(o){if(j[i]&&j[i][n])for(var t=j[i][n],p=0,q=t.length;p<q;p++)t[p].call(this,o||fabric.window.event)}}var e=function(){var i=0;return function(n){return n.__uniqueID||(n.__uniqueID="uniqueID__"+i++)}}(),b,c;(function(){var i=
{};b=function(n){return i[n]};c=function(n,o){i[n]=o}})();var d=l(fabric.document.documentElement,"addEventListener","removeEventListener")&&l(fabric.window,"addEventListener","removeEventListener"),g=l(fabric.document.documentElement,"attachEvent","detachEvent")&&l(fabric.window,"attachEvent","detachEvent"),h={},j={};if(d){d=function(i,n,o){i.addEventListener(n,o,false)};g=function(i,n,o){i.removeEventListener(n,o,false)}}else if(g){d=function(i,n,o){var t=e(i);c(t,i);h[t]||(h[t]={});h[t][n]||(h[t][n]=
[]);o={handler:o,wrappedHandler:f(t,o)};h[t][n].push(o);i.attachEvent("on"+n,o.wrappedHandler)};g=function(i,n,o){var t=e(i),p;if(h[t]&&h[t][n])for(var q=0,w=h[t][n].length;q<w;q++)if((p=h[t][n][q])&&p.handler===o){i.detachEvent("on"+n,p.wrappedHandler);h[t][n][q]=null}}}else{d=function(i,n,o){var t=e(i);j[t]||(j[t]={});if(!j[t][n]){j[t][n]=[];var p=i["on"+n];p&&j[t][n].push(p);i["on"+n]=a(t,n)}j[t][n].push(o)};g=function(i,n,o){i=e(i);if(j[i]&&j[i][n]){n=j[i][n];i=0;for(var t=n.length;i<t;i++)n[i]===
o&&n.splice(i,1)}}}fabric.util.addListener=d;fabric.util.removeListener=g;var m=function(i){return typeof i.clientX!=="unknown"?i.clientX:0},k=function(i){return typeof i.clientY!=="unknown"?i.clientY:0};if(fabric.isTouchSupported){m=function(i){if(i.type!=="touchend")return i.touches&&i.touches[0]?i.touches[0].pageX-(i.touches[0].pageX-i.touches[0].clientX)||i.clientX:i.clientX;return i.changedTouches&&i.changedTouches[0]?i.changedTouches[0].pageX-(i.changedTouches[0].pageX-i.changedTouches[0].clientX)||
i.clientX:i.clientX};k=function(i){if(i.type!=="touchend")return i.touches&&i.touches[0]?i.touches[0].pageY-(i.touches[0].pageY-i.touches[0].clientY)||i.clientY:i.clientY;return i.changedTouches&&i.changedTouches[0]?i.changedTouches[0].pageY-(i.changedTouches[0].pageY-i.changedTouches[0].clientY)||i.clientY:i.clientY}}fabric.util.getPointer=function(i,n){i||(i=fabric.window.event);for(var o=i.target||(typeof i.srcElement!=="unknown"?i.srcElement:null),t=fabric.document.body||{scrollLeft:0,scrollTop:0},
p=fabric.document.documentElement,q=o,w=0,u=0,r;o&&o.parentNode&&!r;){o=o.parentNode;if(o!==fabric.document&&fabric.util.getElementPosition(o)==="fixed")r=o;if(o!==fabric.document&&q!==n&&fabric.util.getElementPosition(o)==="absolute")u=w=0;else if(o===fabric.document&&q!==n){w=t.scrollLeft||p.scrollLeft||0;u=t.scrollTop||p.scrollTop||0}else{w+=o.scrollLeft||0;u+=o.scrollTop||0}}return{x:m(i)+w,y:k(i)+u}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var l=fabric.document.createElement("div"),f=typeof l.style.filter==="string",a=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,e=function(b){return b};if(typeof l.style.opacity==="string")e=function(b,c){b.style.opacity=c;return b};else if(f)e=function(b,c){var d=b.style;if(b.currentStyle&&!b.currentStyle.hasLayout)d.zoom=1;if(a.test(d.filter)){c=c>=0.9999?"":"alpha(opacity="+c*100+")";d.filter=d.filter.replace(a,c)}else d.filter+=" alpha(opacity="+c*100+")";return b};fabric.util.setStyle=function(b,
c){var d=b.style;if(!d)return b;if(typeof c==="string"){b.style.cssText+=";"+c;return c.indexOf("opacity")>-1?e(b,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):b}for(var g in c)if(g==="opacity")e(b,c[g]);else d[g==="float"||g==="cssFloat"?typeof d.styleFloat==="undefined"?"cssFloat":"styleFloat":g]=c[g];return b}})();
(function(){function l(c,d){var g=fabric.document.createElement(c);for(var h in d)if(h==="class")g.className=d[h];else if(h==="for")g.htmlFor=d[h];else g.setAttribute(h,d[h]);return g}var f=Array.prototype.slice,a=function(c){return f.call(c,0)},e;try{e=a(fabric.document.childNodes)instanceof Array}catch(b){}e||(a=function(c){for(var d=Array(c.length),g=c.length;g--;)d[g]=c[g];return d});e=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(c){return fabric.document.defaultView.getComputedStyle(c,
null).position}:function(c){var d=c.style.position;if(!d&&c.currentStyle)d=c.currentStyle.position;return d};(function(){var c=fabric.document.documentElement.style,d="userSelect"in c?"userSelect":"MozUserSelect"in c?"MozUserSelect":"WebkitUserSelect"in c?"WebkitUserSelect":"KhtmlUserSelect"in c?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(g){if(typeof g.onselectstart!=="undefined")g.onselectstart=fabric.util.falseFunction;if(d)g.style[d]="none";else if(typeof g.unselectable===
"string")g.unselectable="on";return g};fabric.util.makeElementSelectable=function(g){if(typeof g.onselectstart!=="undefined")g.onselectstart=null;if(d)g.style[d]="";else if(typeof g.unselectable==="string")g.unselectable="";return g}})();(function(){fabric.util.getScript=function(c,d){var g=fabric.document.getElementsByTagName("head")[0],h=fabric.document.createElement("script"),j=true;h.type="text/javascript";h.setAttribute("runat","server");h.onload=h.onreadystatechange=function(m){if(j)if(!(typeof this.readyState===
"string"&&this.readyState!=="loaded"&&this.readyState!=="complete")){j=false;d(m||fabric.window.event);h=h.onload=h.onreadystatechange=null}};h.src=c;g.appendChild(h)}})();fabric.util.getById=function(c){return typeof c==="string"?fabric.document.getElementById(c):c};fabric.util.toArray=a;fabric.util.makeElement=l;fabric.util.addClass=function(c,d){if((" "+c.className+" ").indexOf(" "+d+" ")===-1)c.className+=(c.className?" ":"")+d};fabric.util.wrapElement=function(c,d,g){if(typeof d==="string")d=
l(d,g);c.parentNode&&c.parentNode.replaceChild(d,c);d.appendChild(c);return d};fabric.util.getElementOffset=function(c){var d=0,g=0;do{d+=c.offsetTop||0;g+=c.offsetLeft||0;c=c.offsetParent}while(c);return{left:g,top:d}};fabric.util.getElementPosition=e})();
(function(){function l(){}var f=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=a.length;e--;)try{if(a[e]())return a[e]}catch(b){}}();fabric.util.request=function(a,e){e||(e={});var b=e.method?e.method.toUpperCase():"GET",c=e.onComplete||function(){},d=f(),g;d.onreadystatechange=function(){if(d.readyState===4){c(d);
d.onreadystatechange=l}};if(b==="GET"){g=null;if(typeof e.parameters==="string")a=a+(/\?/.test(a)?"&":"?")+e.parameters}d.open(b,a,true);if(b==="POST"||b==="PUT")d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.send(g);return d}})();
(function(){function l(a,e,b,c){return b-f(c-a,0,b,c)+e}function f(a,e,b,c){return(a/=c)<1/2.75?b*7.5625*a*a+e:a<2/2.75?b*(7.5625*(a-=1.5/2.75)*a+0.75)+e:a<2.5/2.75?b*(7.5625*(a-=2.25/2.75)*a+0.9375)+e:b*(7.5625*(a-=2.625/2.75)*a+0.984375)+e}fabric.util.ease={easeInQuad:function(a,e,b,c){return b*(a/=c)*a+e},easeOutQuad:function(a,e,b,c){return-b*(a/=c)*(a-2)+e},easeInOutQuad:function(a,e,b,c){a/=c/2;if(a<1)return b/2*a*a+e;return-b/2*(--a*(a-2)-1)+e},easeInCubic:function(a,e,b,c){return b*(a/=c)*
a*a+e},easeOutCubic:function(a,e,b,c){return b*((a=a/c-1)*a*a+1)+e},easeInOutCubic:function(a,e,b,c){a/=c/2;if(a<1)return b/2*a*a*a+e;return b/2*((a-=2)*a*a+2)+e},easeInQuart:function(a,e,b,c){return b*(a/=c)*a*a*a+e},easeOutQuart:function(a,e,b,c){return-b*((a=a/c-1)*a*a*a-1)+e},easeInOutQuart:function(a,e,b,c){a/=c/2;if(a<1)return b/2*a*a*a*a+e;return-b/2*((a-=2)*a*a*a-2)+e},easeInQuint:function(a,e,b,c){return b*(a/=c)*a*a*a*a+e},easeOutQuint:function(a,e,b,c){return b*((a=a/c-1)*a*a*a*a+1)+e},
easeInOutQuint:function(a,e,b,c){a/=c/2;if(a<1)return b/2*a*a*a*a*a+e;return b/2*((a-=2)*a*a*a*a+2)+e},easeInSine:function(a,e,b,c){return-b*Math.cos(a/c*(Math.PI/2))+b+e},easeOutSine:function(a,e,b,c){return b*Math.sin(a/c*(Math.PI/2))+e},easeInOutSine:function(a,e,b,c){return-b/2*(Math.cos(Math.PI*a/c)-1)+e},easeInExpo:function(a,e,b,c){return a===0?e:b*Math.pow(2,10*(a/c-1))+e},easeOutExpo:function(a,e,b,c){return a===c?e+b:b*(-Math.pow(2,-10*a/c)+1)+e},easeInOutExpo:function(a,e,b,c){if(a===0)return e;
if(a===c)return e+b;a/=c/2;if(a<1)return b/2*Math.pow(2,10*(a-1))+e;return b/2*(-Math.pow(2,-10*--a)+2)+e},easeInCirc:function(a,e,b,c){return-b*(Math.sqrt(1-(a/=c)*a)-1)+e},easeOutCirc:function(a,e,b,c){return b*Math.sqrt(1-(a=a/c-1)*a)+e},easeInOutCirc:function(a,e,b,c){a/=c/2;if(a<1)return-b/2*(Math.sqrt(1-a*a)-1)+e;return b/2*(Math.sqrt(1-(a-=2)*a)+1)+e},easeInElastic:function(a,e,b,c){var d=1.70158,g=0,h=b;if(a===0)return e;a/=c;if(a===1)return e+b;g||(g=c*0.3);if(h<Math.abs(b)){h=b;d=g/4}else d=
g/(2*Math.PI)*Math.asin(b/h);return-(h*Math.pow(2,10*(a-=1))*Math.sin((a*c-d)*2*Math.PI/g))+e},easeOutElastic:function(a,e,b,c){var d=1.70158,g=0,h=b;if(a===0)return e;a/=c;if(a===1)return e+b;g||(g=c*0.3);if(h<Math.abs(b)){h=b;d=g/4}else d=g/(2*Math.PI)*Math.asin(b/h);return h*Math.pow(2,-10*a)*Math.sin((a*c-d)*2*Math.PI/g)+b+e},easeInOutElastic:function(a,e,b,c){var d=1.70158,g=0,h=b;if(a===0)return e;a/=c/2;if(a===2)return e+b;g||(g=c*0.3*1.5);if(h<Math.abs(b)){h=b;d=g/4}else d=g/(2*Math.PI)*Math.asin(b/
h);if(a<1)return-0.5*h*Math.pow(2,10*(a-=1))*Math.sin((a*c-d)*2*Math.PI/g)+e;return h*Math.pow(2,-10*(a-=1))*Math.sin((a*c-d)*2*Math.PI/g)*0.5+b+e},easeInBack:function(a,e,b,c,d){if(d===undefined)d=1.70158;return b*(a/=c)*a*((d+1)*a-d)+e},easeOutBack:function(a,e,b,c,d){if(d===undefined)d=1.70158;return b*((a=a/c-1)*a*((d+1)*a+d)+1)+e},easeInOutBack:function(a,e,b,c,d){if(d===undefined)d=1.70158;a/=c/2;if(a<1)return b/2*a*a*(((d*=1.525)+1)*a-d)+e;return b/2*((a-=2)*a*(((d*=1.525)+1)*a+d)+2)+e},easeInBounce:l,
easeOutBounce:f,easeInOutBounce:function(a,e,b,c){if(a<c/2)return l(a*2,0,b,c)*0.5+e;return f(a*2-c,0,b,c)*0.5+b*0.5+e}}})();
(function(l){function f(i){if(i in m)return m[i];return i}function a(i){for(var n=i.length;n--;){var o=i[n].get("fill");if(/^url\(/.test(o)){o=o.slice(5,o.length-1);d.gradientDefs[o]&&i[n].set("fill",d.Gradient.fromElement(d.gradientDefs[o],i[n]))}}}function e(i){i=i.getElementsByTagName("style");for(var n={},o,t=0,p=i.length;t<p;t++){o=i[0].textContent;o=o.replace(/\/\*[\s\S]*?\*\//g,"");o=o.match(/[^{]*\{[\s\S]*?\}/g);o=o.map(function(q){return q.trim()});o.forEach(function(q){var w=q.match(/([\s\S]*?)\s*\{([^}]*)\}/);
q=w[1];w=w[2].trim().replace(/;$/,"").split(/\s*;\s*/);n[q]||(n[q]={});for(var u=0,r=w.length;u<r;u++){var s=w[u].split(/\s*:\s*/);n[q][s[0]]=s[1]}})}return n}function b(i){var n=i.nodeName,o=i.getAttribute("class");i=i.getAttribute("id");var t={};for(var p in d.cssRules)if(o&&RegExp("^\\."+o).test(p)||i&&RegExp("^#"+i).test(p)||RegExp("^"+n).test(p))for(var q in d.cssRules[p])t[q]=d.cssRules[p][q];return t}function c(i){var n=i.objects;i=i.options;n=n.map(function(o){return d[h(o.type)].fromObject(o)});
return{objects:n,options:i}}var d=l.fabric||(l.fabric={}),g=d.util.object.extend,h=d.util.string.capitalize,j=d.util.object.clone,m={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix","text-decoration":"textDecoration","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle","font-family":"fontFamily"};d.parseTransformAttribute=function(){function i(w,u){var r=u[0];w[0]=Math.cos(r);
w[1]=Math.sin(r);w[2]=-Math.sin(r);w[3]=Math.cos(r)}function n(w,u){var r=u.length===2?u[1]:u[0];w[0]=u[0];w[3]=r}function o(w,u){w[4]=u[0];if(u.length===2)w[5]=u[1]}var t=[1,0,0,1,0,0],p=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
q=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))");
return function(w){var u=t.concat();if(!w||w&&!p.test(w))return u;w.replace(q,function(r){var s=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(r).filter(function(v){return v!==
""&&v!=null});r=s[1];s=s.slice(2).map(parseFloat);switch(r){case "translate":o(u,s);break;case "rotate":i(u,s);break;case "scale":n(u,s);break;case "skewX":u[2]=s[0];break;case "skewY":u[1]=s[0];break;case "matrix":u=s;break}});return u}}();d.parseSVGDocument=function(){var i=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,n=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(o,t,p){if(o){var q=new Date,w=d.util.toArray(o.getElementsByTagName("*"));if(w.length===0){w=o.selectNodes("//*[name(.)!='svg']");for(var u=[],r=0,s=w.length;r<s;r++)u[r]=w[r];w=u}w=w.filter(function(C){var D;if(D=i.test(C.tagName)){a:{C=C;for(D=/^(?:pattern|defs)$/;C&&(C=C.parentNode);)if(D.test(C.nodeName)){C=true;break a}C=false}D=!C}return D});if(!(!w||w&&!w.length)){u=o.getAttribute("viewBox");r=o.getAttribute("width");s=o.getAttribute("height");var v=null,x=null;if(u&&(u=u.match(n))){parseInt(u[1],
10);parseInt(u[2],10);v=parseInt(u[3],10);x=parseInt(u[4],10)}v=r?parseFloat(r):v;x=s?parseFloat(s):x;var z={width:v,height:x};d.gradientDefs=d.getGradientDefs(o);d.cssRules=e(o);d.parseElements(w,function(C){d.documentParsingTime=new Date-q;t&&t(C,z)},j(z),p)}}}}();var k={has:function(i,n){n(false)},get:function(){},set:function(){}};g(d,{parseAttributes:function(i,n){if(i){var o,t,p={};if(i.parentNode&&/^g$/i.test(i.parentNode.nodeName))p=d.parseAttributes(i.parentNode,n);var q=n.reduce(function(w,
u){o=i.getAttribute(u);t=parseFloat(o);if(o){if((u==="fill"||u==="stroke")&&o==="none")o="";if(u==="fill-rule")o=o==="evenodd"?"destination-over":o;if(u==="transform")o=d.parseTransformAttribute(o);u=f(u);w[u]=isNaN(t)?o:t}return w},{});q=g(q,g(b(i),d.parseStyleAttribute(i)));return g(p,q)}},parseElements:function(i,n,o,t){function p(){if(--w===0){q=q.filter(function(C){return C!=null});a(q);n(q)}}for(var q=Array(i.length),w=i.length,u=0,r,s=i.length;u<s;u++){r=i[u];var v=d[h(r.tagName)];if(v&&v.fromElement)try{if(v.async)v.fromElement(r,
function(C,D){return function(B){t&&t(D,B);q.splice(C,0,B);p()}}(u),o);else{var x=v.fromElement(r,o);t&&t(r,x);q.splice(u,0,x);p()}}catch(z){d.log(z)}else p()}},parseStyleAttribute:function(i){var n={};i=i.getAttribute("style");if(!i)return n;if(typeof i==="string")i=i.replace(/;$/,"").split(";").forEach(function(p){p=p.split(":");var q=p[1].trim(),w=parseFloat(q);n[f(p[0].trim().toLowerCase())]=isNaN(w)?q:w});else for(var o in i)if(typeof i[o]!=="undefined"){var t=parseFloat(i[o]);n[f(o.toLowerCase())]=
isNaN(t)?i[o]:t}return n},parsePointsAttribute:function(i){if(!i)return null;i=i.trim();var n=i.indexOf(",")>-1;i=i.split(/\s+/);var o=[],t;if(n){n=0;for(t=i.length;n<t;n++){var p=i[n].split(",");o.push({x:parseFloat(p[0]),y:parseFloat(p[1])})}}else{n=0;for(t=i.length;n<t;n+=2)o.push({x:parseFloat(i[n]),y:parseFloat(i[n+1])})}return o},getCSSRules:e,loadSVGFromURL:function(i,n,o){function t(p){var q=p.responseXML;if(!q.documentElement&&d.window.ActiveXObject&&p.responseText){q=new ActiveXObject("Microsoft.XMLDOM");
q.async="false";q.loadXML(p.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}q.documentElement&&d.parseSVGDocument(q.documentElement,function(w,u){k.set(i,{objects:d.util.array.invoke(w,"toObject"),options:u});n(w,u)},o)}i=i.replace(/^\n\s*/,"").trim();k.has(i,function(p){if(p)k.get(i,function(q){q=c(q);n(q.objects,q.options)});else new d.util.request(i,{method:"get",onComplete:t})})},loadSVGFromString:function(i,n,o){i=i.trim();var t;if(typeof DOMParser!=="undefined"){var p=new DOMParser;
if(p&&p.parseFromString)t=p.parseFromString(i,"text/xml")}else if(d.window.ActiveXObject){t=new ActiveXObject("Microsoft.XMLDOM");t.async="false";t.loadXML(i.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}d.parseSVGDocument(t.documentElement,function(q,w){n(q,w)},o)},createSVGFontFacesMarkup:function(i){for(var n="",o=0,t=i.length;o<t;o++)i[o].type!=="text"||!i[o].path||(n+=["@font-face {font-family: ",i[o].fontFamily,"; src: url('",i[o].path,"')}"].join(""));if(n)n=['<style type="text/css"><![CDATA[',
n,"]]\></style>"].join("");return n},createSVGRefElementsMarkup:function(i){var n="";if(i.backgroundColor&&i.backgroundColor.source)n=['<pattern x="0" y="0" id="backgroundColorPattern" width="',i.backgroundColor.source.width,'" height="',i.backgroundColor.source.height,'" patternUnits="userSpaceOnUse"><image x="0" y="0" width="',i.backgroundColor.source.width,'" height="',i.backgroundColor.source.height,'" xlink:href="',i.backgroundColor.source.src,'"></image></pattern>'].join("");return n}})})(typeof exports!==
"undefined"?exports:this);
(function(){function l(e){var b=e.getAttribute("style"),c=e.getAttribute("offset"),d,g;c=parseFloat(c)/(/%$/.test(c)?100:1);if(b){b=b.split(/\s*;\s*/);b[b.length-1]===""&&b.pop();for(var h=b.length;h--;){var j=b[h].split(/\s*:\s*/),m=j[0].trim();j=j[1].trim();if(m==="stop-color")d=j;else if(m==="stop-opacity")g=j}}d||(d=e.getAttribute("stop-color"));g||(g=e.getAttribute("stop-opacity"));d=(new fabric.Color(d)).toRgb();return{offset:c,color:d,opacity:g}}function f(e,b){for(var c in b){if(typeof b[c]==="string"&&
/^\d+%$/.test(b[c])){var d=parseFloat(b[c],10);if(c==="x1"||c==="x2"||c==="r2")b[c]=fabric.util.toFixed(e.width*d/100,2);else if(c==="y1"||c==="y2")b[c]=fabric.util.toFixed(e.height*d/100,2)}if(c==="x1"||c==="x2")b[c]-=fabric.util.toFixed(e.width/2,2);else if(c==="y1"||c==="y2")b[c]-=fabric.util.toFixed(e.height/2,2)}}function a(e,b){for(var c in b){if(c==="x1"||c==="x2")b[c]+=fabric.util.toFixed(e.width/2,2);else if(c==="y1"||c==="y2")b[c]+=fabric.util.toFixed(e.height/2,2);if(c==="x1"||c==="x2"||
c==="r2")b[c]=fabric.util.toFixed(b[c]/e.width*100,2)+"%";else if(c==="y1"||c==="y2")b[c]=fabric.util.toFixed(b[c]/e.height*100,2)+"%"}}fabric.Gradient=fabric.util.createClass({initialize:function(e){e||(e={});var b={};this.id=fabric.Object.__uid++;this.type=e.type||"linear";b={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0};if(this.type==="radial"){b.r1=e.coords.r1||0;b.r2=e.coords.r2||0}this.coords=b;this.gradientUnits=e.gradientUnits||"objectBoundingBox";this.colorStops=
fabric.util.object.clone(e.colorStops)},addColorStop:function(e){for(var b in e){var c=new fabric.Color(e[b]);this.colorStops.push({offset:b,color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toLive:function(e){var b;if(this.type){if(this.type==="linear")b=e.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2||e.canvas.width,this.coords.y2);else if(this.type===
"radial")b=e.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2);for(e=0;e<this.colorStops.length;e++){var c=this.colorStops[e].color,d=this.colorStops[e].opacity,g=this.colorStops[e].offset;if(d)c=(new fabric.Color(c)).setAlpha(d).toRgba();b.addColorStop(parseFloat(g),c)}return b}},toSVG:function(e,b){var c=fabric.util.object.clone(this.coords),d;this.colorStops.sort(function(g,h){return g.offset-h.offset});if(b&&this.gradientUnits==="userSpaceOnUse"){c.x1+=
e.width/2;c.y1+=e.height/2;c.x2+=e.width/2;c.y2+=e.height/2}else this.gradientUnits==="objectBoundingBox"&&a(e,c);if(this.type==="linear")d=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'">'];else if(this.type==="radial")d=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',c.x2,'" cy="',c.y2,'" r="',c.r2,'" fx="',c.x1,'" fy="',c.y1,'">'];for(c=0;c<this.colorStops.length;c++)d.push("<stop ",
'offset="',this.colorStops[c].offset*100+"%",'" style="stop-color:',this.colorStops[c].color,this.colorStops[c].opacity?";stop-opacity: "+this.colorStops[c].opacity:";",'"/>');d.push(this.type==="linear"?"</linearGradient>":"</radialGradient>");return d.join("")}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(e,b){var c=e.getElementsByTagName("stop"),d=e.nodeName==="linearGradient"?"linear":"radial",g=e.getAttribute("gradientUnits")||"objectBoundingBox",h=[],j={};if(d==="linear")j=
{x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0};else if(d==="radial")j={x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"};for(var m=c.length;m--;)h.push(l(c[m]));f(b,j);return new fabric.Gradient({type:d,coords:j,gradientUnits:g,colorStops:h})},forObject:function(e,b){b||(b={});f(e,
b);return new fabric.Gradient(b)}});fabric.getGradientDefs=function(e){var b=e.getElementsByTagName("linearGradient");e=e.getElementsByTagName("radialGradient");var c,d,g={};for(d=b.length;d--;){c=b[d];g[c.getAttribute("id")]=c}for(d=e.length;d--;){c=e[d];g[c.getAttribute("id")]=c}return g}})();
fabric.Pattern=fabric.util.createClass({repeat:"repeat",initialize:function(l){l||(l={});if(l.source)this.source=typeof l.source==="string"?new Function(l.source):l.source;if(l.repeat)this.repeat=l.repeat},toObject:function(){var l;if(typeof this.source==="function")l=String(this.source).match(/function\s+\w*\s*\(.*\)\s+\{([\s\S]*)\}/)[1];else if(typeof this.source.src==="string")l=this.source.src;return{source:l,repeat:this.repeat}},toLive:function(l){var f=typeof this.source==="function"?this.source():
this.source;return l.createPattern(f,this.repeat)}});fabric.Shadow=fabric.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,initialize:function(l){for(var f in l)this[f]=l[f]},toObject:function(){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(){}});
(function(l){function f(a,e){arguments.length>0&&this.init(a,e)}l=l.fabric||(l.fabric={});if(l.Point)l.warn("fabric.Point is already defined");else{l.Point=f;f.prototype={constructor:f,init:function(a,e){this.x=a;this.y=e},add:function(a){return new f(this.x+a.x,this.y+a.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(a){return new f(this.x+a,this.y+a)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(a){return new f(this.x-a.x,this.y-
a.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},scalarSubtract:function(a){return new f(this.x-a,this.y-a)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(a){return new f(this.x*a,this.y*a)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(a){return new f(this.x/a,this.y/a)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&
this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,e){return new f(this.x+(a.x-this.x)*e,this.y+(a.y-this.y)*e)},distanceFrom:function(a){var e=this.x-a.x;a=this.y-a.y;return Math.sqrt(e*e+a*a)},midPointFrom:function(a){return new f(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},min:function(a){return new f(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new f(Math.max(this.x,
a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},setXY:function(a,e){this.x=a;this.y=e},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var e=this.x,b=this.y;this.x=a.x;this.y=a.y;a.x=e;a.y=b}}}})(typeof exports!=="undefined"?exports:this);
(function(l){function f(e){arguments.length>0&&this.init(e)}var a=l.fabric||(l.fabric={});if(a.Intersection)a.warn("fabric.Intersection is already defined");else{a.Intersection=f;a.Intersection.prototype={init:function(e){this.status=e;this.points=[]},appendPoint:function(e){this.points.push(e)},appendPoints:function(e){this.points=this.points.concat(e)}};a.Intersection.intersectLineLine=function(e,b,c,d){var g,h=(d.x-c.x)*(e.y-c.y)-(d.y-c.y)*(e.x-c.x);g=(b.x-e.x)*(e.y-c.y)-(b.y-e.y)*(e.x-c.x);c=
(d.y-c.y)*(b.x-e.x)-(d.x-c.x)*(b.y-e.y);if(c!==0){h=h/c;g=g/c;if(0<=h&&h<=1&&0<=g&&g<=1){g=new f("Intersection");g.points.push(new a.Point(e.x+h*(b.x-e.x),e.y+h*(b.y-e.y)))}else g=new f("No Intersection")}else g=h===0||g===0?new f("Coincident"):new f("Parallel");return g};a.Intersection.intersectLinePolygon=function(e,b,c){for(var d=new f("No Intersection"),g=c.length,h=0;h<g;h++){var j=f.intersectLineLine(e,b,c[h],c[(h+1)%g]);d.appendPoints(j.points)}if(d.points.length>0)d.status="Intersection";
return d};a.Intersection.intersectPolygonPolygon=function(e,b){for(var c=new f("No Intersection"),d=e.length,g=0;g<d;g++){var h=f.intersectLinePolygon(e[g],e[(g+1)%d],b);c.appendPoints(h.points)}if(c.points.length>0)c.status="Intersection";return c};a.Intersection.intersectPolygonRectangle=function(e,b,c){var d=b.min(c),g=b.max(c);c=new a.Point(g.x,d.y);var h=new a.Point(d.x,g.y);b=f.intersectLinePolygon(d,c,e);c=f.intersectLinePolygon(c,g,e);g=f.intersectLinePolygon(g,h,e);e=f.intersectLinePolygon(h,
d,e);d=new f("No Intersection");d.appendPoints(b.points);d.appendPoints(c.points);d.appendPoints(g.points);d.appendPoints(e.points);if(d.points.length>0)d.status="Intersection";return d}}})(typeof exports!=="undefined"?exports:this);
(function(l){function f(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}l=l.fabric||(l.fabric={});if(l.Color)l.warn("fabric.Color is already defined.");else{l.Color=f;l.Color.prototype={_tryParsingColor:function(a){var e;if(a in f.colorNameMap)a=f.colorNameMap[a];(e=f.sourceFromHex(a))||(e=f.sourceFromRgb(a));e&&this.setSource(e)},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},
toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHex:function(){var a=this.getSource(),e=a[0].toString(16);e=e.length===1?"0"+e:e;var b=a[1].toString(16);b=b.length===1?"0"+b:b;a=a[2].toString(16);a=a.length===1?"0"+a:a;return e.toUpperCase()+b.toUpperCase()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var e=this.getSource();e[3]=a;this.setSource(e);return this},toGrayscale:function(){var a=this.getSource(),e=parseInt((a[0]*
0.3+a[1]*0.59+a[2]*0.11).toFixed(0),10);this.setSource([e,e,e,a[3]]);return this},toBlackWhite:function(a){var e=this.getSource(),b=(e[0]*0.3+e[1]*0.59+e[2]*0.11).toFixed(0);e=e[3];a=a||127;b=Number(b)<Number(a)?0:255;this.setSource([b,b,b,e]);return this},overlayWith:function(a){a instanceof f||(a=new f(a));var e=[],b=this.getAlpha(),c=this.getSource();a=a.getSource();for(var d=0;d<3;d++)e.push(Math.round(c[d]*0.5+a[d]*0.5));e[3]=b;this.setSource(e);return this}};l.Color.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;
l.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;l.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};l.Color.fromRgb=function(a){return f.fromSource(f.sourceFromRgb(a))};l.Color.sourceFromRgb=function(a){if(a=a.match(f.reRGBa))return[parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],
10),a[4]?parseFloat(a[4]):1]};l.Color.fromRgba=f.fromRgb;l.Color.fromHex=function(a){return f.fromSource(f.sourceFromHex(a))};l.Color.sourceFromHex=function(a){if(a.match(f.reHex)){var e=a.slice(a.indexOf("#")+1),b=e.length===3;a=b?e.charAt(0)+e.charAt(0):e.substring(0,2);var c=b?e.charAt(1)+e.charAt(1):e.substring(2,4);e=b?e.charAt(2)+e.charAt(2):e.substring(4,6);return[parseInt(a,16),parseInt(c,16),parseInt(e,16),1]}};l.Color.fromSource=function(a){var e=new f;e.setSource(a);return e}}})(typeof exports!==
"undefined"?exports:this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var l=fabric.util.object.extend,f=fabric.util.getElementOffset,a=fabric.util.removeFromArray,e=fabric.util.removeListener,b=Error("Could not initialize `canvas` element");fabric.StaticCanvas=function(c,d){d||(d={});this._initStatic(c,d);fabric.StaticCanvas.activeInstance=this};l(fabric.StaticCanvas.prototype,fabric.Observable);l(fabric.StaticCanvas.prototype,{backgroundColor:"",backgroundImage:"",backgroundImageOpacity:1,
backgroundImageStretch:true,overlayImage:"",overlayImageLeft:0,overlayImageTop:0,includeDefaultValues:true,stateful:true,renderOnAddition:true,clipTo:null,controlsAboveOverlay:false,onBeforeScaleRotate:function(){},_initStatic:function(c,d){this._objects=[];this._createLowerCanvas(c);this._initOptions(d);d.overlayImage&&this.setOverlayImage(d.overlayImage,this.renderAll.bind(this));d.backgroundImage&&this.setBackgroundImage(d.backgroundImage,this.renderAll.bind(this));d.backgroundColor&&this.setBackgroundColor(d.backgroundColor,
this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=f(this.lowerCanvasEl);return this},setOverlayImage:function(c,d,g){fabric.util.loadImage(c,function(h){this.overlayImage=h;if(g&&"overlayImageLeft"in g)this.overlayImageLeft=g.overlayImageLeft;if(g&&"overlayImageTop"in g)this.overlayImageTop=g.overlayImageTop;d&&d()},this);return this},setBackgroundImage:function(c,d,g){fabric.util.loadImage(c,function(h){this.backgroundImage=h;if(g&&"backgroundImageOpacity"in g)this.backgroundImageOpacity=
g.backgroundImageOpacity;if(g&&"backgroundImageStretch"in g)this.backgroundImageStretch=g.backgroundImageStretch;d&&d()},this);return this},setBackgroundColor:function(c,d){if(c.source){var g=this;fabric.util.loadImage(c.source,function(h){g.backgroundColor=new fabric.Pattern({source:h,repeat:c.repeat});d&&d()})}else{this.backgroundColor=c;d&&d()}return this},_createCanvasElement:function(){var c=fabric.document.createElement("canvas");if(!c.style)c.style={};if(!c)throw b;this._initCanvasElement(c);
return c},_initCanvasElement:function(c){fabric.util.createCanvasElement(c);if(typeof c.getContext==="undefined")throw b;},_initOptions:function(c){for(var d in c)this[d]=c[d];this.width=parseInt(this.lowerCanvasEl.width,10)||0;this.height=parseInt(this.lowerCanvasEl.height,10)||0;if(this.lowerCanvasEl.style){this.lowerCanvasEl.style.width=this.width+"px";this.lowerCanvasEl.style.height=this.height+"px"}},_createLowerCanvas:function(c){this.lowerCanvasEl=fabric.util.getById(c)||this._createCanvasElement();
this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(c){return this._setDimension("width",c)},setHeight:function(c){return this._setDimension("height",c)},setDimensions:function(c){for(var d in c)this._setDimension(d,c[d]);return this},
_setDimension:function(c,d){this.lowerCanvasEl[c]=d;this.lowerCanvasEl.style[c]=d+"px";if(this.upperCanvasEl){this.upperCanvasEl[c]=d;this.upperCanvasEl.style[c]=d+"px"}if(this.cacheCanvasEl)this.cacheCanvasEl[c]=d;if(this.wrapperEl)this.wrapperEl.style[c]=d+"px";this[c]=d;this.calcOffset();this.renderAll();return this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(c,d){if(d)if(this.controlsAboveOverlay){var g=
d.hasBorders,h=d.hasControls;d.hasBorders=d.hasControls=false;d.render(c);d.hasBorders=g;d.hasControls=h}else d.render(c)},add:function(){this._objects.push.apply(this._objects,arguments);for(var c=arguments.length;c--;)this._initObject(arguments[c]);this.renderOnAddition&&this.renderAll();return this},_initObject:function(c){this.stateful&&c.setupState();c.setCoords();c.canvas=this;this.fire("object:added",{target:c});c.fire("added")},insertAt:function(c,d,g){if(g)this._objects[d]=c;else this._objects.splice(d,
0,c);this._initObject(c);this.renderOnAddition&&this.renderAll();return this},getObjects:function(){return this._objects},clearContext:function(c){c.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(c){var d=
this[c===true&&this.interactive?"contextTop":"contextContainer"];this.contextTop&&this.selection&&this.clearContext(this.contextTop);c||this.clearContext(d);this.fire("before:render");this.clipTo&&fabric.util.clipCanvas(this,d);if(this.backgroundColor){d.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(d):this.backgroundColor;d.fillRect(0,0,this.width,this.height)}typeof this.backgroundImage==="object"&&this._drawBackroundImage(d);var g=this.getActiveGroup();c=0;for(var h=this._objects.length;c<
h;++c)if(!g||g&&this._objects[c]&&!g.contains(this._objects[c]))this._draw(d,this._objects[c]);if(g){var j=[];this.forEachObject(function(m){g.contains(m)&&j.push(m)});g._set("objects",j);this._draw(d,g)}this.clipTo&&d.restore();this.overlayImage&&d.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop);this.controlsAboveOverlay&&this.drawControls(d);this.fire("after:render");return this},_drawBackroundImage:function(c){c.save();c.globalAlpha=this.backgroundImageOpacity;this.backgroundImageStretch?
c.drawImage(this.backgroundImage,0,0,this.width,this.height):c.drawImage(this.backgroundImage,0,0);c.restore()},renderTop:function(){var c=this.contextTop||this.contextContainer;this.clearContext(c);this.selection&&this._groupSelector&&this._drawSelection();var d=this.getActiveGroup();d&&d.render(c);this.overlayImage&&c.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop);this.fire("after:render");return this},drawControls:function(c){var d=this.getActiveGroup();if(d){c.save();
fabric.Group.prototype.transform.call(d,c);d.drawBorders(c).drawControls(c);c.restore()}else{d=0;for(var g=this._objects.length;d<g;++d)if(this._objects[d]&&this._objects[d].active){c.save();fabric.Object.prototype.transform.call(this._objects[d],c);this._objects[d].drawBorders(c).drawControls(c);c.restore();this.lastRenderedObjectWithControlsAboveOverlay=this._objects[d]}}},toDataURL:function(c){c||(c={});var d=c.format||"png",g=c.quality||1;c=c.multiplier||1;return c!==1?this.__toDataURLWithMultiplier(d,
g,c):this.__toDataURL(d,g)},__toDataURL:function(c,d){this.renderAll(true);var g=this.upperCanvasEl||this.lowerCanvasEl;g=fabric.StaticCanvas.supports("toDataURLWithQuality")?g.toDataURL("image/"+c,d):g.toDataURL("image/"+c);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return g},__toDataURLWithMultiplier:function(c,d,g){var h=this.getWidth(),j=this.getHeight(),m=h*g,k=j*g,i=this.getActiveObject(),n=this.getActiveGroup(),o=this.contextTop||this.contextContainer;this.setWidth(m).setHeight(k);
o.scale(g,g);if(n)this._tempRemoveBordersControlsFromGroup(n);else i&&this.deactivateAll&&this.deactivateAll();this.width=h;this.height=j;this.renderAll(true);c=this.toDataURL(c,d);o.scale(1/g,1/g);this.setWidth(h).setHeight(j);if(n)this._restoreBordersControlsOnGroup(n);else i&&this.setActiveObject&&this.setActiveObject(i);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return c},toDataURLWithMultiplier:function(c,d,g){return this.toDataURL({format:c,multiplier:d,quality:g})},
_tempRemoveBordersControlsFromGroup:function(c){c.origHasControls=c.hasControls;c.origBorderColor=c.borderColor;c.hasControls=true;c.borderColor="rgba(0,0,0,0)";c.forEachObject(function(d){d.origBorderColor=d.borderColor;d.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(c){c.hideControls=c.origHideControls;c.borderColor=c.origBorderColor;c.forEachObject(function(d){d.borderColor=d.origBorderColor;delete d.origBorderColor})},getCenter:function(){return{top:this.getHeight()/2,
left:this.getWidth()/2}},centerObjectH:function(c){c.set("left",this.getCenter().left);this.renderAll();return this},centerObjectV:function(c){c.set("top",this.getCenter().top);this.renderAll();return this},centerObject:function(c){return this.centerObjectH(c).centerObjectV(c)},toDatalessJSON:function(c){return this.toDatalessObject(c)},toObject:function(c){return this._toObjectMethod("toObject",c)},toDatalessObject:function(c){return this._toObjectMethod("toDatalessObject",c)},_toObjectMethod:function(c,
d){var g={objects:this._objects.map(function(h){var j;if(!this.includeDefaultValues){j=h.includeDefaultValues;h.includeDefaultValues=false}var m=h[c](d);if(!this.includeDefaultValues)h.includeDefaultValues=j;return m},this),background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};if(this.backgroundImage){g.backgroundImage=this.backgroundImage.src;g.backgroundImageOpacity=this.backgroundImageOpacity;g.backgroundImageStretch=this.backgroundImageStretch}if(this.overlayImage){g.overlayImage=
this.overlayImage.src;g.overlayImageLeft=this.overlayImageLeft;g.overlayImageTop=this.overlayImageTop}fabric.util.populateWithProperties(this,g,d);return g},toSVG:function(c){c||(c={});var d=[];c.suppressPreamble||d.push('<?xml version="1.0" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">');d.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',this.width,
'" ','height="',this.height,'" ',this.backgroundColor&&!this.backgroundColor.source?'style="background-color: '+this.backgroundColor+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>");if(this.backgroundColor&&this.backgroundColor.source)d.push('<rect x="0" y="0" ','width="',this.backgroundColor.repeat==="repeat-y"||this.backgroundColor.repeat==="no-repeat"?
this.backgroundColor.source.width:this.width,'" height="',this.backgroundColor.repeat==="repeat-x"||this.backgroundColor.repeat==="no-repeat"?this.backgroundColor.source.height:this.height,'" fill="url(#backgroundColorPattern)"',"></rect>");if(this.backgroundImage)d.push('<image x="0" y="0" ','width="',this.backgroundImageStretch?this.width:this.backgroundImage.width,'" height="',this.backgroundImageStretch?this.height:this.backgroundImage.height,'" preserveAspectRatio="',this.backgroundImageStretch?
"none":"defer",'" xlink:href="',this.backgroundImage.src,'" style="opacity:',this.backgroundImageOpacity,'"></image>');this.overlayImage&&d.push('<image x="',this.overlayImageLeft,'" y="',this.overlayImageTop,'" width="',this.overlayImage.width,'" height="',this.overlayImage.height,'" xlink:href="',this.overlayImage.src,'"></image>');c=0;for(var g=this.getObjects(),h=g.length;c<h;c++)d.push(g[c].toSVG());d.push("</svg>");return d.join("")},isEmpty:function(){return this._objects.length===0},remove:function(c){if(this.getActiveObject()===
c){this.fire("before:selection:cleared",{target:c});this.discardActiveObject();this.fire("selection:cleared")}var d=this._objects,g=d.indexOf(c);if(g!==-1){d.splice(g,1);this.fire("object:removed",{target:c})}this.renderAll();return c},sendToBack:function(c){a(this._objects,c);this._objects.unshift(c);return this.renderAll()},bringToFront:function(c){a(this._objects,c);this._objects.push(c);return this.renderAll()},sendBackwards:function(c){var d=this._objects.indexOf(c),g=d;if(d!==0){for(d=d-1;d>=
0;--d)if(c.intersectsWithObject(this._objects[d])||c.isContainedWithinObject(this._objects[d])||this._objects[d].isContainedWithinObject(c)){g=d;break}a(this._objects,c);this._objects.splice(g,0,c)}return this.renderAll()},bringForward:function(c){var d=this.getObjects(),g=d.indexOf(c),h=g;if(g!==d.length-1){g=g+1;for(var j=this._objects.length;g<j;++g)if(c.intersectsWithObject(d[g])||c.isContainedWithinObject(this._objects[g])||this._objects[g].isContainedWithinObject(c)){h=g;break}a(d,c);d.splice(h,
0,c)}this.renderAll()},item:function(c){return this.getObjects()[c]},complexity:function(){return this.getObjects().reduce(function(c,d){c+=d.complexity?d.complexity():0;return c},0)},forEachObject:function(c,d){for(var g=this.getObjects(),h=g.length;h--;)c.call(d,g[h],h,g);return this},dispose:function(){this.clear();if(this.interactive){e(this.upperCanvasEl,"mousedown",this._onMouseDown);e(this.upperCanvasEl,"mousemove",this._onMouseMove);e(fabric.window,"resize",this._onResize)}return this},_resizeImageToFit:function(c){var d=
c.width||c.offsetWidth,g=this.getWidth()/d;if(d)c.width=d*g}});fabric.StaticCanvas.prototype.toString=function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};l(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(c){var d=c.getContext("2d");c=d.getImageData(0,0,c.width,c.height);var g=c.data,h=c.width,j=c.height,m,k,i,n;for(i=0;i<h;i++)for(n=0;n<j;n++){m=i*4*j+n*4;k=(g[m]+g[m+1]+g[m+2])/3;g[m]=k;g[m+1]=k;g[m+
2]=k}d.putImageData(c,0,0)},supports:function(c){var d=fabric.util.createCanvasElement();if(!d||!d.getContext)return null;var g=d.getContext("2d");if(!g)return null;switch(c){case "getImageData":return typeof g.getImageData!=="undefined";case "toDataURL":return typeof d.toDataURL!=="undefined";case "toDataURLWithQuality":try{d.toDataURL("image/jpeg",0);return true}catch(h){}return false;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}})();
(function(l){var f=l.fabric||(l.fabric={}),a=f.util.array.min,e=f.util.array.max;if(f.FreeDrawing)f.warn("fabric.FreeDrawing is already defined");else f.FreeDrawing=f.util.createClass({initialize:function(b){this.canvas=b;this._points=[]},_addPoint:function(b){this._points.push(b)},_reset:function(){this._points.length=0;var b=this.canvas.contextTop;b.strokeStyle=this.canvas.freeDrawingColor;b.lineWidth=this.canvas.freeDrawingLineWidth;b.lineCap=b.lineJoin="round"},_prepareForDrawing:function(b){this.canvas._isCurrentlyDrawing=
true;this.canvas.discardActiveObject().renderAll();b=new f.Point(b.x,b.y);this._reset();this._addPoint(b);this.canvas.contextTop.moveTo(b.x,b.y)},_captureDrawingPath:function(b){this._addPoint(new f.Point(b.x,b.y))},_render:function(){var b=this.canvas.contextTop;b.beginPath();var c=this._points[0],d=this._points[1];b.moveTo(c.x,c.y);for(var g=1,h=this._points.length;g<h;g++){d=c.midPointFrom(d);b.quadraticCurveTo(c.x,c.y,d.x,d.y);c=this._points[g];d=this._points[g+1]}b.lineTo(c.x,c.y);b.stroke()},
_getSVGPathData:function(){this.box=this.getPathBoundingBox(this._points);return this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(b){for(var c=[],d=[],g=b[0],h=b[1],j=g,m=1,k=b.length;m<k;m++){var i=g.midPointFrom(h);c.push(j.x);c.push(i.x);d.push(j.y);d.push(i.y);g=b[m];h=b[m+1];j=i}c.push(g.x);d.push(g.y);return{minx:a(c),miny:a(d),maxx:e(c),maxy:e(d)}},convertPointsToSVGPath:function(b,c,d,g){d=[];var h=new f.Point(b[0].x-
c,b[0].y-g),j=new f.Point(b[1].x-c,b[1].y-g);d.push("M ",b[0].x-c," ",b[0].y-g," ");for(var m=1,k=b.length;m<k;m++){var i=h.midPointFrom(j);d.push("Q ",h.x," ",h.y," ",i.x," ",i.y," ");h=new f.Point(b[m].x-c,b[m].y-g);if(m+1<b.length)j=new f.Point(b[m+1].x-c,b[m+1].y-g)}d.push("L ",h.x," ",h.y," ");return d},createPath:function(b){b=new f.Path(b);b.fill=null;b.stroke=this.canvas.freeDrawingColor;b.strokeWidth=this.canvas.freeDrawingLineWidth;return b},_finalizeAndAddPath:function(){this.canvas._isCurrentlyDrawing=
false;this.canvas.contextTop.closePath();var b=this._getSVGPathData().join("");if(b==="M 0 0 Q 0 0 0 0 L 0 0")this.canvas.renderAll();else{var c=this.box.minx+(this.box.maxx-this.box.minx)/2,d=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(c,d,3,0,Math.PI*2,false);b=this.createPath(b);b.set({left:c,top:d});this.canvas.add(b);b.setCoords();this.canvas.contextTop&&this.canvas.clearContext(this.canvas.contextTop);this.canvas.renderAll();this.canvas.fire("path:created",{path:b})}}})})(typeof exports!==
"undefined"?exports:this);
(function(){function l(){}var f=fabric.util.object.extend,a=fabric.util.getPointer,e=fabric.util.degreesToRadians,b=fabric.util.radiansToDegrees,c=Math.atan2,d=Math.abs,g=Math.min,h=Math.max;fabric.Canvas=function(k,i){i||(i={});this._initStatic(k,i);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this};l.prototype=fabric.StaticCanvas.prototype;fabric.Canvas.prototype=new l;var j={uniScaleTransform:false,centerTransform:false,interactive:true,selection:true,selectionColor:"rgba(100, 100, 255, 0.3)",
selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,freeDrawingColor:"rgb(0, 0, 0)",freeDrawingLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this.freeDrawing=fabric.FreeDrawing&&new fabric.FreeDrawing(this);this._initWrapperElement();
this._createUpperCanvas();this._initEvents();this.calcOffset()},_resetCurrentTransform:function(k){var i=this._currentTransform;i.target.set("scaleX",i.original.scaleX);i.target.set("scaleY",i.original.scaleY);i.target.set("left",i.original.left);i.target.set("top",i.original.top);if(k.altKey||this.centerTransform){if(i.originX!=="center")i.mouseXSign=i.originX==="right"?-1:1;if(i.originY!=="center")i.mouseYSign=i.originY==="bottom"?-1:1;i.originX="center";i.originY="center"}else{i.originX=i.original.originX;
i.originY=i.original.originY}},containsPoint:function(k,i){var n=this.getPointer(k),o=this._normalizePointer(i,n);n=o.x;o=o.y;var t=i._getImageLines(i.oCoords);if((n=i._findCrossPoints(n,o,t))&&n%2===1||i._findTargetCorner(k,this._offset))return true;return false},_normalizePointer:function(k,i){var n=this.getActiveGroup(),o=i.x,t=i.y;if(n&&k.type!=="group"&&n.contains(k)){o-=n.left;t-=n.top}return{x:o,y:t}},_isTargetTransparent:function(k,i,n){var o=this.contextCache,t=k.hasBorders,p=k.transparentCorners;
k.hasBorders=k.transparentCorners=false;this._draw(o,k);k.hasBorders=t;k.transparentCorners=p;if(this.targetFindTolerance>0){if(i>this.targetFindTolerance)i-=this.targetFindTolerance;else i=0;if(n>this.targetFindTolerance)n-=this.targetFindTolerance;else n=0}k=true;i=o.getImageData(i,n,this.targetFindTolerance*2||1,this.targetFindTolerance*2||1);for(n=3;n<i.data.length;n+=4){k=i.data[n]<=0;if(k===false)break}this.clearContext(o);return k},_shouldClearSelection:function(k){var i=this.findTarget(k),
n=this.getActiveGroup();return!i||i&&n&&!n.contains(i)&&n!==i&&!k.shiftKey},_setupCurrentTransform:function(k,i){var n="drag",o,t=a(k,i.canvas.upperCanvasEl);if(o=i._findTargetCorner(k,this._offset))n=o==="ml"||o==="mr"?"scaleX":o==="mt"||o==="mb"?"scaleY":o==="mtr"?"rotate":"scale";var p="center",q="center";if(o==="ml"||o==="tl"||o==="bl")p="right";else if(o==="mr"||o==="tr"||o==="br")p="left";if(o==="tl"||o==="mt"||o==="tr")q="bottom";else if(o==="bl"||o==="mb"||o==="br")q="top";if(o==="mtr")q=
p="center";this._currentTransform={target:i,action:n,scaleX:i.scaleX,scaleY:i.scaleY,offsetX:t.x-i.left,offsetY:t.y-i.top,originX:p,originY:q,ex:t.x,ey:t.y,left:i.left,top:i.top,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,originX:p,originY:q};this._resetCurrentTransform(k)},_shouldHandleGroupLogic:function(k,i){var n=this.getActiveObject();return k.shiftKey&&(this.getActiveGroup()||n&&n!==
i)&&this.selection},_handleGroupLogic:function(k,i){if(i===this.getActiveGroup()){i=this.findTarget(k,true);if(!i||i.isType("group"))return}var n=this.getActiveGroup();if(n){if(n.contains(i)){n.removeWithUpdate(i);this._resetObjectTransform(n);i.setActive(false);n.size()===1&&this.discardActiveGroup()}else{n.addWithUpdate(i);this._resetObjectTransform(n)}this.fire("selection:created",{target:n,e:k});n.setActive(true)}else{if(this._activeObject)if(i!==this._activeObject){this.setActiveGroup(new fabric.Group([this._activeObject,
i]));n=this.getActiveGroup()}i.setActive(true)}n&&n.saveCoords()},_translateObject:function(k,i){var n=this._currentTransform.target;n.get("lockMovementX")||n.set("left",k-this._currentTransform.offsetX);n.get("lockMovementY")||n.set("top",i-this._currentTransform.offsetY)},_scaleObject:function(k,i,n){var o=this._currentTransform,t=this._offset,p=o.target,q=p.get("lockScalingX"),w=p.get("lockScalingY");if(!(q&&w)){var u=p.translateToOriginPoint(p.getCenterPoint(),o.originX,o.originY);i=p.toLocalPoint(new fabric.Point(k-
t.left,i-t.top),o.originX,o.originY);if(o.originX==="right")i.x*=-1;else if(o.originX==="center"){i.x*=o.mouseXSign*2;if(i.x<0)o.mouseXSign=-o.mouseXSign}if(o.originY==="bottom")i.y*=-1;else if(o.originY==="center"){i.y*=o.mouseYSign*2;if(i.y<0)o.mouseYSign=-o.mouseYSign}k=p.scaleX;t=p.scaleY;if(n==="equally"&&!q&&!w){n=i.y+i.x;q=p.height*o.original.scaleY+p.width*o.original.scaleX+p.padding*2-p.strokeWidth*2+1;k=o.original.scaleX*n/q;t=o.original.scaleY*n/q;p.set("scaleX",k);p.set("scaleY",t)}else if(n)if(n===
"x"&&!p.get("lockUniScaling")){k=i.x/(p.width+p.padding);q||p.set("scaleX",k)}else{if(n==="y"&&!p.get("lockUniScaling")){t=i.y/(p.height+p.padding);w||p.set("scaleY",t)}}else{k=i.x/(p.width+p.padding);t=i.y/(p.height+p.padding);q||p.set("scaleX",k);w||p.set("scaleY",t)}if(k<0)if(o.originX==="left")o.originX="right";else if(o.originX==="right")o.originX="left";if(t<0)if(o.originY==="top")o.originY="bottom";else if(o.originY==="bottom")o.originY="top";p.setPositionByOrigin(u,o.originX,o.originY)}},
_rotateObject:function(k,i){var n=this._currentTransform,o=this._offset;if(!n.target.get("lockRotation")){var t=c(n.ey-n.top-o.top,n.ex-n.left-o.left);o=c(i-n.top-o.top,k-n.left-o.left);n.target.angle=b(o-t+n.theta)}},_setCursor:function(k){this.upperCanvasEl.style.cursor=k},_resetObjectTransform:function(k){k.scaleX=1;k.scaleY=1;k.setAngle(0)},_drawSelection:function(){var k=this.contextTop,i=this._groupSelector,n=i.left,o=i.top,t=d(n),p=d(o);k.fillStyle=this.selectionColor;k.fillRect(i.ex-(n>0?
0:-n),i.ey-(o>0?0:-o),t,p);k.lineWidth=this.selectionLineWidth;k.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){n=i.ex+0.5-(n>0?0:t);i=i.ey+0.5-(o>0?0:p);k.beginPath();fabric.util.drawDashedLine(k,n,i,n+t,i,this.selectionDashArray);fabric.util.drawDashedLine(k,n,i+p-1,n+t,i+p-1,this.selectionDashArray);fabric.util.drawDashedLine(k,n,i,n,i+p,this.selectionDashArray);fabric.util.drawDashedLine(k,n+t-1,i,n+t-1,i+p,this.selectionDashArray);k.closePath();k.stroke()}else k.strokeRect(i.ex+
0.5-(n>0?0:t),i.ey+0.5-(o>0?0:p),t,p)},_findSelectedObjects:function(k){var i=[],n=this._groupSelector.ex,o=this._groupSelector.ey,t=n+this._groupSelector.left,p=o+this._groupSelector.top,q=new fabric.Point(g(n,t),g(o,p));o=new fabric.Point(h(n,t),h(o,p));t=0;for(p=this._objects.length;t<p;++t)if(n=this._objects[t])if(n.intersectsWithRect(q,o)||n.isContainedWithinRect(q,o))if(this.selection&&n.selectable){n.setActive(true);i.push(n)}if(i.length===1)this.setActiveObject(i[0],k);else if(i.length>1){i=
new fabric.Group(i);this.setActiveGroup(i);i.saveCoords();this.fire("selection:created",{target:i})}this.renderAll()},findTarget:function(k,i){var n,o=this.getPointer(k);if(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.containsPoint(k,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(k,this._offset))return n=this.lastRenderedObjectWithControlsAboveOverlay;var t=this.getActiveGroup();if(t&&!i&&this.containsPoint(k,
t))return n=t;t=[];for(o=this._objects.length;o--;)if(this._objects[o]&&this.containsPoint(k,this._objects[o]))if(this.perPixelTargetFind||this._objects[o].perPixelTargetFind)t[t.length]=this._objects[o];else{this.relatedTarget=n=this._objects[o];break}for(var p=0,q=t.length;p<q;p++){o=this.getPointer(k);if(!this._isTargetTransparent(t[p],o.x,o.y)){this.relatedTarget=n=t[p];break}}if(n&&n.selectable)return n},getPointer:function(k){k=a(k,this.upperCanvasEl);return{x:k.x-this._offset.left,y:k.y-this._offset.top}},
_createUpperCanvas:function(){this.upperCanvasEl=this._createCanvasElement();this.upperCanvasEl.className="upper-canvas";this.wrapperEl.appendChild(this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},
_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(k){var i=this.getWidth()||k.width,n=this.getHeight()||k.height;fabric.util.setStyle(k,{position:"absolute",width:i+"px",height:n+"px",left:0,top:0});k.width=i;k.height=n;fabric.util.makeElementUnselectable(k)},
getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(k,i){this._activeObject&&this._activeObject.setActive(false);this._activeObject=k;k.setActive(true);this.renderAll();this.fire("object:selected",{target:k,e:i});k.fire("selected",{e:i});return this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){this._activeObject&&this._activeObject.setActive(false);this._activeObject=null;
return this},setActiveGroup:function(k){if(this._activeGroup=k){k.canvas=this;k.setActive(true)}return this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var k=this.getActiveGroup();k&&k.destroy();return this.setActiveGroup(null)},deactivateAll:function(){for(var k=this.getObjects(),i=0,n=k.length;i<n;i++)k[i].setActive(false);this.discardActiveGroup();this.discardActiveObject();return this},deactivateAllWithDispatch:function(){var k=this.getActiveGroup()||this.getActiveObject();
k&&this.fire("before:selection:cleared",{target:k});this.deactivateAll();k&&this.fire("selection:cleared");return this}};fabric.Canvas.prototype.toString=fabric.StaticCanvas.prototype.toString;f(fabric.Canvas.prototype,j);for(var m in fabric.StaticCanvas)if(m!=="prototype")fabric.Canvas[m]=fabric.StaticCanvas[m];if(fabric.isTouchSupported)fabric.Canvas.prototype._setCursorFromEvent=function(){};fabric.Element=fabric.Canvas})();
(function(){var l={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"},f=fabric.util.addListener,a=fabric.util.removeListener,e=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEvents:function(){var b=this;this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);f(fabric.window,"resize",
this._onResize);if(fabric.isTouchSupported){f(this.upperCanvasEl,"touchstart",this._onMouseDown);f(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"add"in Event&&Event.add(this.upperCanvasEl,"gesture",function(c,d){b.__onTransformGesture(c,d)})}else{f(this.upperCanvasEl,"mousedown",this._onMouseDown);f(this.upperCanvasEl,"mousemove",this._onMouseMove)}},_onMouseDown:function(b){this.__onMouseDown(b);!fabric.isTouchSupported&&f(fabric.document,"mouseup",this._onMouseUp);
fabric.isTouchSupported&&f(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&f(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&f(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&a(this.upperCanvasEl,"mousemove",this._onMouseMove);fabric.isTouchSupported&&a(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(b){this.__onMouseUp(b);!fabric.isTouchSupported&&a(fabric.document,"mouseup",this._onMouseUp);fabric.isTouchSupported&&
a(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&a(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&a(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&f(this.upperCanvasEl,"mousemove",this._onMouseMove);fabric.isTouchSupported&&f(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseMove:function(b){b.preventDefault&&b.preventDefault();this.__onMouseMove(b)},_onResize:function(){this.calcOffset()},__onMouseUp:function(b){var c;
if(this.isDrawingMode&&this._isCurrentlyDrawing){this.freeDrawing._finalizeAndAddPath();this.fire("mouse:up",{e:b})}else{if(this._currentTransform){c=this._currentTransform.target;if(c._scaling)c._scaling=false;for(var d=this._objects.length;d--;)this._objects[d].setCoords();c.isMoving=false;if(this.stateful&&c.hasStateChanged()){this.fire("object:modified",{target:c});c.fire("modified")}if(this._previousOriginX){this._currentTransform.target.adjustPosition(this._previousOriginX);this._previousOriginX=
null}}this._currentTransform=null;this._groupSelector&&this._findSelectedObjects(b);if(d=this.getActiveGroup()){d.setObjectsCoords();d.set("isMoving",false);this._setCursor(this.defaultCursor)}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(b,c);this._setCursor("");var g=this;setTimeout(function(){g._setCursorFromEvent(b,c)},50);this.fire("mouse:up",{target:c,e:b});c&&c.fire("mouseup",{e:b})}},__onMouseDown:function(b){var c;if(("which"in b?b.which===1:b.button===1)||fabric.isTouchSupported)if(this.isDrawingMode){c=
this.getPointer(b);this.freeDrawing._prepareForDrawing(c);this.freeDrawing._captureDrawingPath(c);this.fire("mouse:down",{e:b})}else if(!this._currentTransform){var d=this.findTarget(b),g;c=this.getPointer(b);if(this._shouldClearSelection(b)){this._groupSelector={ex:c.x,ey:c.y,top:0,left:0};this.deactivateAllWithDispatch()}else{this.stateful&&d.saveState();if(g=d._findTargetCorner(b,this._offset))this.onBeforeScaleRotate(d);if(this._shouldHandleGroupLogic(b,d)){this._handleGroupLogic(b,d);d=this.getActiveGroup()}else{d!==
this.getActiveGroup()&&this.deactivateAll();this.setActiveObject(d,b)}this._setupCurrentTransform(b,d)}this.renderAll();this.fire("mouse:down",{target:d,e:b});d&&d.fire("mousedown",{e:b});if(g==="mtr"){this._previousOriginX=this._currentTransform.target.originX;this._currentTransform.target.adjustPosition("center");this._currentTransform.left=this._currentTransform.target.left;this._currentTransform.top=this._currentTransform.target.top}}},__onMouseMove:function(b){var c,d;if(this.isDrawingMode){if(this._isCurrentlyDrawing){d=
this.getPointer(b);this.freeDrawing._captureDrawingPath(d);this.clearContext(this.contextTop);this.freeDrawing._render(this.contextTop)}this.upperCanvasEl.style.cursor=this.freeDrawingCursor;this.fire("mouse:move",{e:b})}else{var g=this._groupSelector;if(g!==null){d=e(b,this.upperCanvasEl);g.left=d.x-this._offset.left-g.ex;g.top=d.y-this._offset.top-g.ey;this.renderTop()}else if(this._currentTransform){d=e(b,this.upperCanvasEl);g=d.x;d=d.y;this._currentTransform.target.isMoving=true;var h=this._currentTransform,
j=false;if((h.action==="scale"||h.action==="scaleX"||h.action==="scaleY")&&(b.altKey&&(h.originX!=="center"||h.originY!=="center")||!b.altKey&&h.originX==="center"&&h.originY==="center")){this._resetCurrentTransform(b);j=true}if(this._currentTransform.action==="rotate"){this._rotateObject(g,d);this.fire("object:rotating",{target:this._currentTransform.target,e:b});this._currentTransform.target.fire("rotating")}else if(this._currentTransform.action==="scale"){if(b.shiftKey||this.uniScaleTransform){this._currentTransform.currentAction=
"scale";this._scaleObject(g,d)}else{!j&&h.currentAction==="scale"&&this._resetCurrentTransform(b);this._currentTransform.currentAction="scaleEqually";this._scaleObject(g,d,"equally")}this.fire("object:scaling",{target:this._currentTransform.target,e:b})}else if(this._currentTransform.action==="scaleX"){this._scaleObject(g,d,"x");this.fire("object:scaling",{target:this._currentTransform.target,e:b});this._currentTransform.target.fire("scaling",{e:b})}else if(this._currentTransform.action==="scaleY"){this._scaleObject(g,
d,"y");this.fire("object:scaling",{target:this._currentTransform.target,e:b});this._currentTransform.target.fire("scaling",{e:b})}else{this._translateObject(g,d);this.fire("object:moving",{target:this._currentTransform.target,e:b});this._setCursor(this.moveCursor);this._currentTransform.target.fire("moving",{e:b})}this.renderAll()}else{g=this.upperCanvasEl.style;if(c=this.findTarget(b))this._setCursorFromEvent(b,c);else{for(d=this._objects.length;d--;)this._objects[d]&&!this._objects[d].active&&this._objects[d].setActive(false);
g.cursor=this.defaultCursor}}this.fire("mouse:move",{target:c,e:b});c&&c.fire("mousemove",{e:b})}},_setCursorFromEvent:function(b,c){var d=this.upperCanvasEl.style;if(c){var g=this.getActiveGroup();if(g=c._findTargetCorner&&(!g||!g.contains(c))&&c._findTargetCorner(b,this._offset))if(g in l)d.cursor=l[g];else if(g==="mtr"&&c.hasRotatingPoint)d.cursor=this.rotationCursor;else{d.cursor=this.defaultCursor;return false}else d.cursor=this.hoverCursor}else{d.cursor=this.defaultCursor;return false}return true}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(l,f){f=f||{};var a=function(){},e=f.onComplete||a,b=f.onChange||a,c=this;fabric.util.animate({startValue:l.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(d){l.set("left",d);c.renderAll();b()},onComplete:function(){l.setCoords();e()}});return this},fxCenterObjectV:function(l,f){f=f||{};var a=function(){},e=f.onComplete||a,b=f.onChange||a,c=this;fabric.util.animate({startValue:l.get("top"),
endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(d){l.set("top",d);c.renderAll();b()},onComplete:function(){l.setCoords();e()}});return this},fxRemove:function(l,f){f=f||{};var a=function(){},e=f.onComplete||a,b=f.onChange||a,c=this;fabric.util.animate({startValue:l.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){l.setActive(false)},onChange:function(d){l.set("opacity",d);c.renderAll();b()},onComplete:function(){c.remove(l);e()}});return this}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(l,f){if(l){var a=typeof l==="string"?JSON.parse(l):l;if(!(!a||a&&!a.objects)){this.clear();var e=this;this._enlivenDatalessObjects(a.objects,function(){e._setBgOverlayImages(a,f)})}}},_enlivenDatalessObjects:function(l,f){function a(h,j){b.insertAt(h,j,true);h.setCoords();++c===d&&f&&f()}function e(h,j){var m=h.paths?"paths":"path",k=h[m];delete h[m];if(typeof k!=="string")if(h.type==="image"||h.type==="group")fabric[fabric.util.string.capitalize(h.type)].fromObject(h,
function(o){a(o,j)});else{var i=fabric[fabric.util.string.camelize(fabric.util.string.capitalize(h.type))];if(i&&i.fromObject){if(k)h[m]=k;a(i.fromObject(h),j)}}else if(h.type==="image")fabric.util.loadImage(k,function(o){o=new fabric.Image(o);o.setSourcePath(k);fabric.util.object.extend(o,h);o.setAngle(h.angle);a(o,j)});else if(h.type==="text")if(h.useNative)a(fabric.Text.fromObject(h),j);else{h.path=k;var n=fabric.Text.fromObject(h);fabric.util.getScript(k,function(){Object.prototype.toString.call(fabric.window.opera)===
"[object Opera]"?setTimeout(function(){a(n,j)},500):a(n,j)})}else fabric.loadSVGFromURL(k,function(o){o=fabric.util.groupSVGElements(o,h,k);if(!(o instanceof fabric.PathGroup)){fabric.util.object.extend(o,h);typeof h.angle!=="undefined"&&o.setAngle(h.angle)}a(o,j)})}var b=this,c=0,d=l.length;d===0&&f&&f();try{l.forEach(e,this)}catch(g){fabric.log(g)}},loadFromJSON:function(l,f){if(l){var a=typeof l==="string"?JSON.parse(l):l,e=this;this._enlivenObjects(a.objects,function(){e._setBgOverlayImages(a,
f)});return this}},_setBgOverlayImages:function(l,f){var a=this,e,b,c;if(l.backgroundImage)this.setBackgroundImage(l.backgroundImage,function(){a.backgroundImageOpacity=l.backgroundImageOpacity;a.backgroundImageStretch=l.backgroundImageStretch;a.renderAll();b=true;f&&c&&e&&f()});else b=true;if(l.overlayImage)this.setOverlayImage(l.overlayImage,function(){a.overlayImageLeft=l.overlayImageLeft||0;a.overlayImageTop=l.overlayImageTop||0;a.renderAll();c=true;f&&b&&e&&f()});else c=true;if(l.background)this.setBackgroundColor(l.background,
function(){a.renderAll();e=true;f&&c&&b&&f()});else e=true;!l.backgroundImage&&!l.overlayImage&&!l.background&&f&&f()},_enlivenObjects:function(l,f){var a=this;fabric.util.enlivenObjects(l,function(e){e.forEach(function(b,c){a.insertAt(b,c,true)});f&&f()})},_toDataURL:function(l,f){this.clone(function(a){f(a.toDataURL(l))})},_toDataURLWithMultiplier:function(l,f,a){this.clone(function(e){a(e.toDataURLWithMultiplier(l,f))})},clone:function(l){var f=JSON.stringify(this);this.cloneWithoutData(function(a){a.loadFromJSON(f,
function(){l&&l(a)})})},cloneWithoutData:function(l){var f=fabric.document.createElement("canvas");f.width=this.getWidth();f.height=this.getHeight();var a=new fabric.Canvas(f);a.clipTo=this.clipTo;if(this.backgroundImage){a.setBackgroundImage(this.backgroundImage.src,function(){a.renderAll();l&&l(a)});a.backgroundImageOpacity=this.backgroundImageOpacity;a.backgroundImageStretch=this.backgroundImageStretch}else l&&l(a)}});
(function(){var l=fabric.util.degreesToRadians,f=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(a,e){if(!(this.isDrawingMode||a.touches.length!==2||"gesture"!==e.gesture)){var b=this.findTarget(a);if("undefined"!==typeof b){this.onBeforeScaleRotate(b);this._rotateObjectByAngle(e.rotation);this._scaleObjectBy(e.scale)}this.fire("touch:gesture",{target:b,e:a,self:e})}},_scaleObjectBy:function(a,e){var b=this._currentTransform,c=b.target,
d=c.get("lockScalingX"),g=c.get("lockScalingY");if(!(d&&g)){c._scaling=true;if(e)if(e==="x"&&!c.get("lockUniScaling"))d||c.set("scaleX",b.scaleX*a);else{if(e==="y"&&!c.get("lockUniScaling"))g||c.set("scaleY",b.scaleY*a)}else{d||c.set("scaleX",b.scaleX*a);g||c.set("scaleY",b.scaleY*a)}}},_rotateObjectByAngle:function(a){var e=this._currentTransform;if(!e.target.get("lockRotation"))e.target.angle=f(l(a)+e.theta)}})})();
(function(l){var f=l.fabric||(l.fabric={}),a=f.util.object.extend,e=f.util.toFixed,b=f.util.string.capitalize,c=f.util.degreesToRadians;if(!f.Object){var d=l.Image;try{var g=typeof require!=="undefined"&&require("canvas").Image;if(g)d=g}catch(h){f.log(h)}f.Object=f.util.createClass({type:"object",originX:"center",originY:"center",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,cornerSize:12,transparentCorners:true,padding:0,borderColor:"rgba(102,153,255,0.75)",
cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,strokeDashArray:null,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,stateProperties:"top left width height scaleX scaleY flipX flipY angle opacity cornerSize fill overlayFill originX originY stroke strokeWidth strokeDashArray fillRule borderScaleFactor transformMatrix selectable shadow visible".split(" "),
initialize:function(j){j&&this.setOptions(j)},_initGradient:function(j){j.fill&&j.fill.colorStops&&!(j.fill instanceof f.Gradient)&&this.set("fill",new f.Gradient(j.fill))},_initPattern:function(j){j.fill&&j.fill.source&&!(j.fill instanceof f.Pattern)&&this.set("fill",new f.Pattern(j.fill));j.stroke&&j.stroke.source&&!(j.stroke instanceof f.Pattern)&&this.set("stroke",new f.Pattern(j.stroke))},_initShadow:function(j){j.shadow&&!(j.shadow instanceof f.Shadow)&&this.setShadow(j.shadow)},setOptions:function(j){for(var m in j)this.set(m,
j[m]);this._initGradient(j);this._initPattern(j);this._initShadow(j)},transform:function(j){j.globalAlpha=this.opacity;var m=this.getCenterPoint();j.translate(m.x,m.y);j.rotate(c(this.angle));j.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(j){var m=f.Object.NUM_FRACTION_DIGITS;m={type:this.type,originX:this.originX,originY:this.originY,left:e(this.left,m),top:e(this.top,m),width:e(this.width,m),height:e(this.height,m),fill:this.fill&&this.fill.toObject?this.fill.toObject():
this.fill,overlayFill:this.overlayFill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:this.strokeWidth,strokeDashArray:this.strokeDashArray,scaleX:e(this.scaleX,m),scaleY:e(this.scaleY,m),angle:e(this.getAngle(),m),flipX:this.flipX,flipY:this.flipY,opacity:e(this.opacity,m),selectable:this.selectable,hasControls:this.hasControls,hasBorders:this.hasBorders,hasRotatingPoint:this.hasRotatingPoint,transparentCorners:this.transparentCorners,perPixelTargetFind:this.perPixelTargetFind,
shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible};this.includeDefaultValues||(m=this._removeDefaultValues(m));f.util.populateWithProperties(this,m,j);return m},toDatalessObject:function(j){return this.toObject(j)},getSvgStyles:function(){return["stroke: ",this.stroke?this.stroke:"none","; stroke-width: ",this.strokeWidth?this.strokeWidth:"0","; stroke-dasharray: ",this.strokeDashArray?this.strokeDashArray.join(" "):"; ","fill: ",this.fill?this.fill&&
this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none","; opacity: ",this.opacity?this.opacity:"1",";",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){var j=this.getAngle(),m=this.getCenterPoint(),k=f.Object.NUM_FRACTION_DIGITS;m="translate("+e(m.x,k)+" "+e(m.y,k)+")";j=j!==0?" rotate("+e(j,k)+")":"";k=this.scaleX===1&&this.scaleY===1?"":" scale("+e(this.scaleX,k)+" "+e(this.scaleY,k)+")";return[m,j,k,this.flipX?"matrix(-1 0 0 1 0 0) ":"",this.flipY?"matrix(1 0 0 -1 0 0)":
""].join("")},_removeDefaultValues:function(j){var m=f.Object.prototype.options;m&&this.stateProperties.forEach(function(k){j[k]===m[k]&&delete j[k]});return j},isActive:function(){return!!this.active},setActive:function(j){this.active=!!j;return this},toString:function(){return"#<fabric."+b(this.type)+">"},get:function(j){return this[j]},set:function(j,m){if(typeof j==="object")for(var k in j)this._set(k,j[k]);else typeof m==="function"?this._set(j,m(this.get(j))):this._set(j,m);return this},_set:function(j,
m){if(j==="scaleX"||j==="scaleY")m=this._constrainScale(m);if(j==="scaleX"&&m<0){this.flipX=!this.flipX;m*=-1}else if(j==="scaleY"&&m<0){this.flipY=!this.flipY;m*=-1}else if(j==="width"||j==="height")this.minScaleLimit=e(Math.min(0.1,1/Math.max(this.width,this.height)),2);this[j]=m;return this},toggle:function(j){var m=this.get(j);typeof m==="boolean"&&this.set(j,!m);return this},setSourcePath:function(j){this.sourcePath=j;return this},render:function(j,m){if(!(this.width===0||this.height===0||!this.visible)){j.save();
var k=this.transformMatrix;k&&!this.group&&j.setTransform(k[0],k[1],k[2],k[3],k[4],k[5]);m||this.transform(j);if(this.stroke||this.strokeDashArray){j.lineWidth=this.strokeWidth;j.strokeStyle=this.stroke&&this.stroke.toLive?this.stroke.toLive(j):this.stroke}if(this.overlayFill)j.fillStyle=this.overlayFill;else if(this.fill)j.fillStyle=this.fill.toLive?this.fill.toLive(j):this.fill;if(k&&this.group){j.translate(-this.group.width/2,-this.group.height/2);j.transform(k[0],k[1],k[2],k[3],k[4],k[5])}this._setShadow(j);
this.clipTo&&f.util.clipContext(this,j);this._render(j,m);this.clipTo&&j.restore();this._removeShadow(j);if(this.active&&!m){this.drawBorders(j);this.drawControls(j)}j.restore()}},_setShadow:function(j){if(this.shadow){j.shadowColor=this.shadow.color;j.shadowBlur=this.shadow.blur;j.shadowOffsetX=this.shadow.offsetX;j.shadowOffsetY=this.shadow.offsetY}},_removeShadow:function(j){j.shadowColor="";j.shadowBlur=j.shadowOffsetX=j.shadowOffsetY=0},clone:function(j,m){if(this.constructor.fromObject)return this.constructor.fromObject(this.toObject(m),
j);return new f.Object(this.toObject(m))},cloneAsImage:function(j){if(f.Image){var m=new d;m.onload=function(){j&&j(new f.Image(m),k);m=m.onload=null};var k={angle:this.getAngle(),flipX:this.getFlipX(),flipY:this.getFlipY()};this.set({angle:0,flipX:false,flipY:false});this.toDataURL(function(i){m.src=i})}return this},toDataURL:function(j){function m(n){n.left=k.width/2;n.top=k.height/2;n.setActive(false);i.add(n);n=i.toDataURL();i.dispose();i=null;j&&j(n)}var k=f.util.createCanvasElement();k.width=
this.getBoundingRectWidth();k.height=this.getBoundingRectHeight();f.util.wrapElement(k,"div");var i=new f.Canvas(k);i.backgroundColor="transparent";i.renderAll();this.constructor.async?this.clone(m):m(this.clone())},hasStateChanged:function(){return this.stateProperties.some(function(j){return this[j]!==this.originalState[j]},this)},saveState:function(j){this.stateProperties.forEach(function(m){this.originalState[m]=this.get(m)},this);j&&j.stateProperties&&j.stateProperties.forEach(function(m){this.originalState[m]=
this.get(m)},this);return this},setupState:function(){this.originalState={};this.saveState()},isType:function(j){return this.type===j},toGrayscale:function(){var j=this.get("fill");j&&this.set("overlayFill",(new f.Color(j)).toGrayscale().toRgb());return this},complexity:function(){return 0},toJSON:function(j){return this.toObject(j)},setGradient:function(j,m){m||(m={});var k={colorStops:[]};k.type=m.type||(m.r1||m.r2?"radial":"linear");k.coords={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2};if(m.r1||m.r2){k.coords.r1=
m.r1;k.coords.r2=m.r2}for(var i in m.colorStops){var n=new f.Color(m.colorStops[i]);k.colorStops.push({offset:i,color:n.toRgb(),opacity:n.getAlpha()})}this.set(j,f.Gradient.forObject(this,k))},setPatternFill:function(j){this.set("fill",new f.Pattern(j))},setShadow:function(j){this.set("shadow",new f.Shadow(j))},animate:function(){if(arguments[0]&&typeof arguments[0]==="object")for(var j in arguments[0])this._animate(j,arguments[0][j],arguments[1]);else this._animate.apply(this,arguments);return this},
_animate:function(j,m,k){var i=this,n;m=m.toString();k=k?f.util.object.clone(k):{};if(~j.indexOf("."))n=j.split(".");var o=n?this.get(n[0])[n[1]]:this.get(j);if(!("from"in k))k.from=o;m=~m.indexOf("=")?o+parseFloat(m.replace("=","")):parseFloat(m);f.util.animate({startValue:k.from,endValue:m,byValue:k.by,easing:k.easing,duration:k.duration,onChange:function(t){if(n)i[n[0]][n[1]]=t;else i.set(j,t);k.onChange&&k.onChange()},onComplete:function(){i.setCoords();k.onComplete&&k.onComplete()}})},centerH:function(){this.canvas.centerObjectH(this);
return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){return this.centerH().centerV()},remove:function(){return this.canvas.remove(this)},sendToBack:function(){this.canvas.sendToBack(this);return this},bringToFront:function(){this.canvas.bringToFront(this);return this},sendBackwards:function(){this.canvas.sendBackwards(this);return this},bringForward:function(){this.canvas.bringForward(this);return this}});f.util.createAccessors(f.Object);f.Object.prototype.rotate=
f.Object.prototype.setAngle;a(f.Object.prototype,f.Observable);f.Object.NUM_FRACTION_DIGITS=2;f.Object.__uid=0}})(typeof exports!=="undefined"?exports:this);
(function(){var l=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(f,a,e){var b=f.x,c=f.y;if(a==="left")b=f.x+this.getWidth()/2;else if(a==="right")b=f.x-this.getWidth()/2;if(e==="top")c=f.y+this.getHeight()/2;else if(e==="bottom")c=f.y-this.getHeight()/2;return fabric.util.rotatePoint(new fabric.Point(b,c),f,l(this.angle))},translateToOriginPoint:function(f,a,e){var b=f.x,c=f.y;if(a==="left")b=f.x-this.getWidth()/2;else if(a==="right")b=
f.x+this.getWidth()/2;if(e==="top")c=f.y-this.getHeight()/2;else if(e==="bottom")c=f.y+this.getHeight()/2;return fabric.util.rotatePoint(new fabric.Point(b,c),f,l(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new fabric.Point(this.left,this.top),this.originX,this.originY)},toLocalPoint:function(f,a,e){var b=this.getCenterPoint();if(a!==undefined&&e!==undefined){a=a==="left"?b.x-this.getWidth()/2:a==="right"?b.x+this.getWidth()/2:b.x;e=e==="top"?b.y-this.getHeight()/2:
e==="bottom"?b.y+this.getHeight()/2:b.y}else{a=this.left;e=this.top}return fabric.util.rotatePoint(new fabric.Point(f.x,f.y),b,-l(this.angle)).subtractEquals(new fabric.Point(a,e))},setPositionByOrigin:function(f,a,e){f=this.translateToOriginPoint(this.translateToCenterPoint(f,a,e),this.originX,this.originY);this.set("left",f.x);this.set("top",f.y)},adjustPosition:function(f){var a=l(this.angle),e=this.getWidth()/2,b=Math.cos(a)*e;e=Math.sin(a)*e;var c=this.getWidth(),d=Math.cos(a)*c;a=Math.sin(a)*
c;if(this.originX==="center"&&f==="left"||this.originX==="right"&&f==="center"){this.left-=b;this.top-=e}else if(this.originX==="left"&&f==="center"||this.originX==="center"&&f==="right"){this.left+=b;this.top+=e}else if(this.originX==="left"&&f==="right"){this.left+=d;this.top+=a}else if(this.originX==="right"&&f==="left"){this.left-=d;this.top-=a}this.setCoords();this.originX=f}})})();
(function(){var l=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{intersectsWithRect:function(f,a){var e=this.oCoords,b=new fabric.Point(e.tl.x,e.tl.y),c=new fabric.Point(e.tr.x,e.tr.y),d=new fabric.Point(e.bl.x,e.bl.y);e=new fabric.Point(e.br.x,e.br.y);return fabric.Intersection.intersectPolygonRectangle([b,c,e,d],f,a).status==="Intersection"},intersectsWithObject:function(f){function a(b){return{tl:new fabric.Point(b.tl.x,b.tl.y),tr:new fabric.Point(b.tr.x,b.tr.y),
bl:new fabric.Point(b.bl.x,b.bl.y),br:new fabric.Point(b.br.x,b.br.y)}}var e=a(this.oCoords);f=a(f.oCoords);return fabric.Intersection.intersectPolygonPolygon([e.tl,e.tr,e.br,e.bl],[f.tl,f.tr,f.br,f.bl]).status==="Intersection"},isContainedWithinObject:function(f){return this.isContainedWithinRect(f.oCoords.tl,f.oCoords.br)},isContainedWithinRect:function(f,a){var e=this.oCoords,b=new fabric.Point(e.tl.x,e.tl.y),c=new fabric.Point(e.tr.x,e.tr.y);e=new fabric.Point(e.bl.x,e.bl.y);return b.x>f.x&&c.x<
a.x&&b.y>f.y&&e.y<a.y},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var f=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],a=fabric.util.array.min(f);f=fabric.util.array.max(f);f=Math.abs(a-f);var e=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],b=fabric.util.array.min(e);e=fabric.util.array.max(e);
return{left:a,top:b,width:f,height:Math.abs(b-e)}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(f){if(Math.abs(f)<this.minScaleLimit)return f<0?-this.minScaleLimit:this.minScaleLimit;return f},scale:function(f){f=this._constrainScale(f);if(f<0){this.flipX=!this.flipX;this.flipY=!this.flipY;f*=-1}this.scaleY=this.scaleX=f;this.setCoords();return this},scaleToWidth:function(f){var a=this.getBoundingRectWidth()/this.getWidth();
return this.scale(f/this.width/a)},scaleToHeight:function(f){var a=this.getBoundingRectHeight()/this.getHeight();return this.scale(f/this.height/a)},setCoords:function(){var f=this.strokeWidth>1?this.strokeWidth:0,a=this.padding,e=l(this.angle);this.currentWidth=(this.width+f)*this.scaleX+a*2;this.currentHeight=(this.height+f)*this.scaleY+a*2;if(this.currentWidth<0)this.currentWidth=Math.abs(this.currentWidth);f=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));var b=Math.atan(this.currentHeight/
this.currentWidth);a=Math.cos(b+e)*f;b=Math.sin(b+e)*f;f=Math.sin(e);e=Math.cos(e);var c=this.getCenterPoint();a={x:c.x-a,y:c.y-b};b={x:a.x+this.currentWidth*e,y:a.y+this.currentWidth*f};c={x:a.x-this.currentHeight*f,y:a.y+this.currentHeight*e};this.oCoords={tl:a,tr:b,br:{x:b.x-this.currentHeight*f,y:b.y+this.currentHeight*e},bl:c,ml:{x:a.x-this.currentHeight/2*f,y:a.y+this.currentHeight/2*e},mt:{x:a.x+this.currentWidth/2*e,y:a.y+this.currentWidth/2*f},mr:{x:b.x-this.currentHeight/2*f,y:b.y+this.currentHeight/
2*e},mb:{x:c.x+this.currentWidth/2*e,y:c.y+this.currentWidth/2*f},mtr:{x:a.x+this.currentWidth/2*e,y:a.y+this.currentWidth/2*f}};this._setCornerCoords();return this}})})();
(function(){var l=fabric.util.getPointer,f=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(a,e){if(!this.hasControls||!this.active)return false;var b=l(a,this.canvas.upperCanvasEl),c=b.x-e.left;b=b.y-e.top;var d;for(var g in this.oCoords)if(!(g==="mtr"&&!this.hasRotatingPoint))if(!(this.get("lockUniScaling")&&(g==="mt"||g==="mr"||g==="mb"||g==="ml"))){d=this._getImageLines(this.oCoords[g].corner,g);d=this._findCrossPoints(c,b,d);if(d%2===
1&&d!==0)return this.__corner=g}return false},_findCrossPoints:function(a,e,b){var c,d,g,h=0;for(var j in b){g=b[j];if(!(g.o.y<e&&g.d.y<e))if(!(g.o.y>=e&&g.d.y>=e)){if(g.o.x===g.d.x&&g.o.x>=a)c=g.o.x;else{c=(g.d.y-g.o.y)/(g.d.x-g.o.x);d=e-0*a;g=g.o.y-c*g.o.x;c=-(d-g)/(0-c)}if(c>=a)h+=1;if(h===2)break}}return h},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_setCornerCoords:function(){var a=this.oCoords,e=f(this.angle),
b=f(45-this.angle),c=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,d=c*Math.cos(b);b=c*Math.sin(b);c=Math.sin(e);e=Math.cos(e);a.tl.corner={tl:{x:a.tl.x-b,y:a.tl.y-d},tr:{x:a.tl.x+d,y:a.tl.y-b},bl:{x:a.tl.x-d,y:a.tl.y+b},br:{x:a.tl.x+b,y:a.tl.y+d}};a.tr.corner={tl:{x:a.tr.x-b,y:a.tr.y-d},tr:{x:a.tr.x+d,y:a.tr.y-b},br:{x:a.tr.x+b,y:a.tr.y+d},bl:{x:a.tr.x-d,y:a.tr.y+b}};a.bl.corner={tl:{x:a.bl.x-b,y:a.bl.y-d},bl:{x:a.bl.x-d,y:a.bl.y+b},br:{x:a.bl.x+b,y:a.bl.y+d},tr:{x:a.bl.x+d,y:a.bl.y-b}};a.br.corner=
{tr:{x:a.br.x+d,y:a.br.y-b},bl:{x:a.br.x-d,y:a.br.y+b},br:{x:a.br.x+b,y:a.br.y+d},tl:{x:a.br.x-b,y:a.br.y-d}};a.ml.corner={tl:{x:a.ml.x-b,y:a.ml.y-d},tr:{x:a.ml.x+d,y:a.ml.y-b},bl:{x:a.ml.x-d,y:a.ml.y+b},br:{x:a.ml.x+b,y:a.ml.y+d}};a.mt.corner={tl:{x:a.mt.x-b,y:a.mt.y-d},tr:{x:a.mt.x+d,y:a.mt.y-b},bl:{x:a.mt.x-d,y:a.mt.y+b},br:{x:a.mt.x+b,y:a.mt.y+d}};a.mr.corner={tl:{x:a.mr.x-b,y:a.mr.y-d},tr:{x:a.mr.x+d,y:a.mr.y-b},bl:{x:a.mr.x-d,y:a.mr.y+b},br:{x:a.mr.x+b,y:a.mr.y+d}};a.mb.corner={tl:{x:a.mb.x-
b,y:a.mb.y-d},tr:{x:a.mb.x+d,y:a.mb.y-b},bl:{x:a.mb.x-d,y:a.mb.y+b},br:{x:a.mb.x+b,y:a.mb.y+d}};a.mtr.corner={tl:{x:a.mtr.x-b+c*this.rotatingPointOffset,y:a.mtr.y-d-e*this.rotatingPointOffset},tr:{x:a.mtr.x+d+c*this.rotatingPointOffset,y:a.mtr.y-b-e*this.rotatingPointOffset},bl:{x:a.mtr.x-d+c*this.rotatingPointOffset,y:a.mtr.y+b-e*this.rotatingPointOffset},br:{x:a.mtr.x+b+c*this.rotatingPointOffset,y:a.mtr.y+d-e*this.rotatingPointOffset}}},drawBorders:function(a){if(this.hasBorders){var e=this.padding,
b=e*2,c=this.strokeWidth>1?this.strokeWidth:0;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var d=1/this._constrainScale(this.scaleX),g=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(d,g);d=this.getWidth();g=this.getHeight();a.strokeRect(~~(-(d/2)-e-c/2*this.scaleX)+0.5,~~(-(g/2)-e-c/2*this.scaleY)+0.5,~~(d+b+c*this.scaleX),~~(g+b+c*this.scaleY));if(this.hasRotatingPoint&&!this.get("lockRotation")&&this.hasControls){e=
(this.flipY?g+c*this.scaleY+e*2:-g-c*this.scaleY-e*2)/2;a.beginPath();a.moveTo(0,e);a.lineTo(0,e+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset));a.closePath();a.stroke()}a.restore();return this}},drawControls:function(a){if(this.hasControls){var e=this.cornerSize,b=e/2,c=this.strokeWidth/2,d=-(this.width/2),g=-(this.height/2),h=e/this.scaleX,j=e/this.scaleY,m=this.padding/this.scaleX,k=this.padding/this.scaleY,i=b/this.scaleY,n=b/this.scaleX,o=(b-e)/this.scaleX,t=(b-e)/this.scaleY,
p=this.height,q=this.width,w=this.transparentCorners?"strokeRect":"fillRect",u=typeof G_vmlCanvasManager!=="undefined";a.save();a.lineWidth=1/Math.max(this.scaleX,this.scaleY);a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;e=d-n-c-m;b=g-i-c-k;u||a.clearRect(e,b,h,j);a[w](e,b,h,j);e=d+q-n+c+m;b=g-i-c-k;u||a.clearRect(e,b,h,j);a[w](e,b,h,j);e=d-n-c-m;b=g+p+t+c+k;u||a.clearRect(e,b,h,j);a[w](e,b,h,j);e=d+q+o+c+m;b=g+p+t+c+k;u||a.clearRect(e,b,h,
j);a[w](e,b,h,j);if(!this.get("lockUniScaling")){e=d+q/2-n;b=g-i-c-k;u||a.clearRect(e,b,h,j);a[w](e,b,h,j);e=d+q/2-n;b=g+p+t+c+k;u||a.clearRect(e,b,h,j);a[w](e,b,h,j);e=d+q+o+c+m;b=g+p/2-i;u||a.clearRect(e,b,h,j);a[w](e,b,h,j);e=d-n-c-m;b=g+p/2-i;u||a.clearRect(e,b,h,j);a[w](e,b,h,j)}if(this.hasRotatingPoint){e=d+q/2-n;b=this.flipY?g+p+this.rotatingPointOffset/this.scaleY-j/2+c+k:g-this.rotatingPointOffset/this.scaleY-j/2-c-k;u||a.clearRect(e,b,h,j);a[w](e,b,h,j)}a.restore();return this}}})})();
(function(l){var f=l.fabric||(l.fabric={}),a=f.util.object.extend,e={x1:1,x2:1,y1:1,y2:1};if(f.Line)f.warn("fabric.Line is already defined");else{f.Line=f.util.createClass(f.Object,{type:"line",initialize:function(b,c){c=c||{};b||(b=[0,0,0,0]);this.callSuper("initialize",c);this.set("x1",b[0]);this.set("y1",b[1]);this.set("x2",b[2]);this.set("y2",b[3]);this._setWidthHeight(c)},_setWidthHeight:function(b){b||(b={});this.set("width",this.x2-this.x1||1);this.set("height",this.y2-this.y1||1);this.set("left",
"left"in b?b.left:this.x1+this.width/2);this.set("top","top"in b?b.top:this.y1+this.height/2)},_set:function(b,c){this[b]=c;b in e&&this._setWidthHeight();return this},_render:function(b){b.beginPath();this.group&&b.translate(-this.group.width/2+this.left,-this.group.height/2+this.top);b.moveTo(this.width===1?0:-this.width/2,this.height===1?0:-this.height/2);b.lineTo(this.width===1?0:this.width/2,this.height===1?0:this.height/2);b.lineWidth=this.strokeWidth;var c=b.strokeStyle;b.strokeStyle=b.fillStyle;
b.stroke();b.strokeStyle=c},complexity:function(){return 1},toObject:function(b){return a(this.callSuper("toObject",b),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(){var b=[];this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,true));b.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>');return b.join("")}});f.Line.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");
f.Line.fromElement=function(b,c){var d=f.parseAttributes(b,f.Line.ATTRIBUTE_NAMES);return new f.Line([d.x1||0,d.y1||0,d.x2||0,d.y2||0],a(d,c))};f.Line.fromObject=function(b){return new f.Line([b.x1,b.y1,b.x2,b.y2],b)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var f=l.fabric||(l.fabric={}),a=Math.PI*2,e=f.util.object.extend;if(f.Circle)f.warn("fabric.Circle is already defined.");else{f.Circle=f.util.createClass(f.Object,{type:"circle",initialize:function(b){b=b||{};this.set("radius",b.radius||0);this.callSuper("initialize",b);b=this.get("radius")*2;this.set("width",b).set("height",b)},toObject:function(b){return e(this.callSuper("toObject",b),{radius:this.get("radius")})},toSVG:function(){var b=[];this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,
false));this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,false));b.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return b.join("")},_render:function(b,c){b.beginPath();b.globalAlpha=this.group?b.globalAlpha*this.opacity:this.opacity;b.arc(c?this.left:0,c?this.top:0,this.radius,0,a,false);b.closePath();this.fill&&b.fill();this._removeShadow(b);this.stroke&&b.stroke()},getRadiusX:function(){return this.get("radius")*
this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(b){this.radius=b;this.set("width",b*2).set("height",b*2)},complexity:function(){return 1}});f.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity opacity stroke stroke-width transform".split(" ");f.Circle.fromElement=function(b,c){c||(c={});var d=f.parseAttributes(b,f.Circle.ATTRIBUTE_NAMES);if(!("radius"in d&&d.radius>0))throw Error("value of `r` attribute is required and can not be negative");
if("left"in d)d.left-=c.width/2||0;if("top"in d)d.top-=c.height/2||0;d=new f.Circle(e(d,c));d.cx=parseFloat(b.getAttribute("cx"))||0;d.cy=parseFloat(b.getAttribute("cy"))||0;return d};f.Circle.fromObject=function(b){return new f.Circle(b)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var f=l.fabric||(l.fabric={});if(f.Triangle)f.warn("fabric.Triangle is already defined");else{f.Triangle=f.util.createClass(f.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var e=this.width/2,b=this.height/2;a.beginPath();a.moveTo(-e,b);a.lineTo(0,-b);a.lineTo(e,b);a.closePath();this.fill&&a.fill();this.stroke&&a.stroke()},complexity:function(){return 1},toSVG:function(){var a=
[],e=this.width/2,b=this.height/2;e=[-e+" "+b,"0 "+-b,e+" "+b].join(",");this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,true));this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,true));a.push("<polygon ",'points="',e,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a.join("")}});f.Triangle.fromObject=function(a){return new f.Triangle(a)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var f=l.fabric||(l.fabric={}),a=Math.PI*2,e=f.util.object.extend;if(f.Ellipse)f.warn("fabric.Ellipse is already defined.");else{f.Ellipse=f.util.createClass(f.Object,{type:"ellipse",rx:0,ry:0,initialize:function(b){b=b||{};this.callSuper("initialize",b);this.set("rx",b.rx||0);this.set("ry",b.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(b){return e(this.callSuper("toObject",b),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(){var b=
[];this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,false));this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,false));b.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return b.join("")},render:function(b,c){if(!(this.rx===0||this.ry===0))return this.callSuper("render",b,c)},_render:function(b,c){b.beginPath();b.save();b.globalAlpha=this.group?b.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&
this.group&&b.translate(this.cx,this.cy);b.transform(1,0,0,this.ry/this.rx,0,0);b.arc(c?this.left:0,c?this.top:0,this.rx,0,a,false);this.stroke&&b.stroke();this._removeShadow(b);this.fill&&b.fill();b.restore()},complexity:function(){return 1}});f.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity opacity stroke stroke-width transform".split(" ");f.Ellipse.fromElement=function(b,c){c||(c={});var d=f.parseAttributes(b,f.Ellipse.ATTRIBUTE_NAMES),g=d.left,h=d.top;if("left"in d)d.left-=c.width/2||
0;if("top"in d)d.top-=c.height/2||0;d=new f.Ellipse(e(d,c));d.cx=g||0;d.cy=h||0;return d};f.Ellipse.fromObject=function(b){return new f.Ellipse(b)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var f=l.fabric||(l.fabric={}),a=f.util.object.extend;if(f.Rect)console.warn("fabric.Rect is already defined");else{f.Rect=f.util.createClass(f.Object,{type:"rect",rx:0,ry:0,initialize:function(e){e=e||{};this._initStateProperties();this.callSuper("initialize",e);this._initRxRy();this.y=this.x=0},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(["rx","ry"])},_initRxRy:function(){if(this.rx&&!this.ry)this.ry=this.rx;else if(this.ry&&!this.rx)this.rx=this.ry},
_render:function(e){var b=this.rx||0,c=this.ry||0,d=-this.width/2,g=-this.height/2,h=this.width,j=this.height;e.beginPath();e.globalAlpha=this.group?e.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&this.group&&e.translate(this.width/2+this.x,this.height/2+this.y);!this.transformMatrix&&this.group&&e.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y);e.moveTo(d+b,g);e.lineTo(d+h-b,g);e.quadraticCurveTo(d+h,g,d+h,g+c,d+h,g+c);e.lineTo(d+h,g+j-c);
e.quadraticCurveTo(d+h,g+j,d+h-b,g+j,d+h-b,g+j);e.lineTo(d+b,g+j);e.quadraticCurveTo(d,g+j,d,g+j-c,d,g+j-c);e.lineTo(d,g+c);e.quadraticCurveTo(d,g,d+b,g,d+b,g);e.closePath();this.fill&&e.fill();this._removeShadow(e);if(this.strokeDashArray)this._renderDashedStroke(e);else this.stroke&&e.stroke()},_renderDashedStroke:function(e){function b(k,i){for(var n=0,o=0,t=(i?h.height:h.width)+j*2;n<t;){var p=h.strokeDashArray[c++];n+=p;if(n>t)o=n-t;if(k)d+=p*k-(o*k||0);else g+=p*i-(o*i||0);e[1&c?"moveTo":"lineTo"](d,
g);if(c>=m)c=0}}1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray);var c=0,d=-this.width/2,g=-this.height/2,h=this,j=this.padding,m=this.strokeDashArray.length;e.save();e.beginPath();b(1,0);b(0,1);b(-1,0);b(0,-1);e.stroke();e.closePath();e.restore()},_normalizeLeftTopProperties:function(e){e.left&&this.set("left",e.left+this.getWidth()/2);this.set("x",e.left||0);e.top&&this.set("top",e.top+this.getHeight()/2);this.set("y",e.top||0);return this},
complexity:function(){return 1},toObject:function(e){return a(this.callSuper("toObject",e),{rx:this.get("rx")||0,ry:this.get("ry")||0})},toSVG:function(){var e=[];this.fill&&this.fill.toLive&&e.push(this.fill.toSVG(this,false));this.stroke&&this.stroke.toLive&&e.push(this.stroke.toSVG(this,false));e.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',
this.getSvgTransform(),'"/>');return e.join("")}});f.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity opacity stroke stroke-width transform".split(" ");f.Rect.fromElement=function(e,b){if(!e)return null;var c=f.parseAttributes(e,f.Rect.ATTRIBUTE_NAMES);c=c;c.left=c.left||0;c.top=c.top||0;c=c;var d=new f.Rect(a(b?f.util.object.clone(b):{},c));d._normalizeLeftTopProperties(c);return d};f.Rect.fromObject=function(e){return new f.Rect(e)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var f=l.fabric||(l.fabric={}),a=f.util.toFixed;if(f.Polyline)f.warn("fabric.Polyline is already defined");else{f.Polyline=f.util.createClass(f.Object,{type:"polyline",initialize:function(e,b,c){b=b||{};this.set("points",e);this.callSuper("initialize",b);this._calcDimensions(c)},_calcDimensions:function(e){return f.Polygon.prototype._calcDimensions.call(this,e)},toObject:function(e){return f.Polygon.prototype.toObject.call(this,e)},toSVG:function(){for(var e=[],b=[],c=0,d=this.points.length;c<
d;c++)e.push(a(this.points[c].x,2),",",a(this.points[c].y,2)," ");this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,false));this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,false));b.push("<polyline ",'points="',e.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return b.join("")},_render:function(e){var b;e.beginPath();e.moveTo(this.points[0].x,this.points[0].y);for(var c=0,d=this.points.length;c<d;c++){b=this.points[c];e.lineTo(b.x,b.y)}this.fill&&
e.fill();this._removeShadow(e);this.stroke&&e.stroke()},complexity:function(){return this.get("points").length}});f.Polyline.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" ");f.Polyline.fromElement=function(e,b){if(!e)return null;b||(b={});for(var c=f.parsePointsAttribute(e.getAttribute("points")),d=f.parseAttributes(e,f.Polyline.ATTRIBUTE_NAMES),g=0,h=c.length;g<h;g++){c[g].x-=b.width/2||0;c[g].y-=b.height/2||0}return new f.Polyline(c,f.util.object.extend(d,b),
true)};f.Polyline.fromObject=function(e){return new f.Polyline(e.points,e,true)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var f=l.fabric||(l.fabric={}),a=f.util.object.extend,e=f.util.array.min,b=f.util.array.max,c=f.util.toFixed;if(f.Polygon)f.warn("fabric.Polygon is already defined");else{f.Polygon=f.util.createClass(f.Object,{type:"polygon",initialize:function(d,g,h){g=g||{};this.points=d;this.callSuper("initialize",g);this._calcDimensions(h)},_calcDimensions:function(d){var g=this.points,h=e(g,"x"),j=e(g,"y"),m=b(g,"x");g=b(g,"y");this.width=m-h||1;this.height=g-j||1;this.minX=h;this.minY=j;if(!d){var k=
this.width/2,i=this.height/2;this.points.forEach(function(n){n.x-=k;n.y-=i},this)}},toObject:function(d){return a(this.callSuper("toObject",d),{points:this.points.concat()})},toSVG:function(){for(var d=[],g=[],h=0,j=this.points.length;h<j;h++)d.push(c(this.points[h].x,2),",",c(this.points[h].y,2)," ");this.fill&&this.fill.toLive&&g.push(this.fill.toSVG(this,false));this.stroke&&this.stroke.toLive&&g.push(this.stroke.toSVG(this,false));g.push("<polygon ",'points="',d.join(""),'" style="',this.getSvgStyles(),
'" transform="',this.getSvgTransform(),'"/>');return g.join("")},_render:function(d){var g;d.beginPath();d.moveTo(this.points[0].x,this.points[0].y);for(var h=0,j=this.points.length;h<j;h++){g=this.points[h];d.lineTo(g.x,g.y)}this.fill&&d.fill();this._removeShadow(d);if(this.stroke){d.closePath();d.stroke()}},complexity:function(){return this.points.length}});f.Polygon.ATTRIBUTE_NAMES="fill fill-opacity opacity stroke stroke-width transform".split(" ");f.Polygon.fromElement=function(d,g){if(!d)return null;
g||(g={});for(var h=f.parsePointsAttribute(d.getAttribute("points")),j=f.parseAttributes(d,f.Polygon.ATTRIBUTE_NAMES),m=0,k=h.length;m<k;m++){h[m].x-=g.width/2||0;h[m].y-=g.height/2||0}return new f.Polygon(h,a(j,g),true)};f.Polygon.fromObject=function(d){return new f.Polygon(d.points,d,true)}}})(typeof exports!=="undefined"?exports:this);
(function(l){function f(p,q,w,u){q=a(u[5],u[6],u[0],u[1],u[3],u[4],u[2],q,w);for(w=0;w<q.length;w++){u=e.apply(this,q[w]);p.bezierCurveTo.apply(p,u)}}function a(p,q,w,u,r,s,v,x,z){m=j.call(arguments);if(g[m])return g[m];var C=v*(Math.PI/180),D=Math.sin(C);C=Math.cos(C);w=Math.abs(w);u=Math.abs(u);var B=C*(x-p)*0.5+D*(z-q)*0.5,A=C*(z-q)*0.5-D*(x-p)*0.5;B=B*B/(w*w)+A*A/(u*u);if(B>1){B=Math.sqrt(B);w*=B;u*=B}var y=C/w,E=D/w,F=-D/u,I=C/u;B=y*x+E*z;A=F*x+I*z;y=y*p+E*q;E=F*p+I*q;F=1/((y-B)*(y-B)+(E-A)*
(E-A))-0.25;if(F<0)F=0;I=Math.sqrt(F);if(s===r)I=-I;F=0.5*(B+y)-I*(E-A);I=0.5*(A+E)+I*(y-B);B=Math.atan2(A-I,B-F);A=Math.atan2(E-I,y-F)-B;if(A<0&&s===1)A+=2*Math.PI;else if(A>0&&s===0)A-=2*Math.PI;y=Math.ceil(Math.abs(A/(Math.PI*0.5+0.0010)));E=[];for(var G=0;G<y;G++)E[G]=[F,I,B+G*A/y,B+(G+1)*A/y,w,u,D,C];return g[m]=E}function e(p,q,w,u,r,s,v,x){m=j.call(arguments);if(h[m])return h[m];var z=x*r,C=-v*s,D=v*r,B=x*s,A=0.5*(u-w),y=8/3*Math.sin(A*0.5)*Math.sin(A*0.5)/Math.sin(A);A=p+Math.cos(w)-y*Math.sin(w);
var E=q+Math.sin(w)+y*Math.cos(w),F=p+Math.cos(u),I=q+Math.sin(u),G=F+y*Math.sin(u);y=I-y*Math.cos(u);return h[m]=[z*A+C*E,D*A+B*E,z*G+C*y,D*G+B*y,z*F+C*I,D*F+B*I]}function b(p){if(p[0]==="H")return p[1];return p[p.length-2]}function c(p){if(p[0]==="V")return p[1];return p[p.length-1]}var d={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},g={},h={},j=Array.prototype.join,m,k=l.fabric||(l.fabric={}),i=k.util.array.min,n=k.util.array.max,o=k.util.object.extend,t=Object.prototype.toString;if(k.Path)k.warn("fabric.Path is already defined");
else{k.Path=k.util.createClass(k.Object,{type:"path",initialize:function(p,q){q=q||{};this.setOptions(q);if(!p)throw Error("`path` argument is required");var w=t.call(p)==="[object Array]";if(this.path=w?p:p.match&&p.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)){if(!w)this.path=this._parsePath();this._initializePath(q);q.sourcePath&&this.setSourcePath(q.sourcePath)}},_initializePath:function(p){var q="width"in p,w="height"in p,u="left"in p,r="top"in p;if(!q||!w){o(this,this._parseDimensions());if(q)this.width=
p.width;if(w)this.height=p.height}else{if(!r)this.top=this.height/2;if(!u)this.left=this.width/2}this.pathOffset=this._calculatePathOffset(r||u)},_calculatePathOffset:function(p){return{x:p?0:this.left-this.width/2,y:p?0:this.top-this.height/2}},_render:function(p){for(var q,w=null,u=0,r=0,s=0,v=0,x,z,C,D,B=-(this.width/2+this.pathOffset.x),A=-(this.height/2+this.pathOffset.y),y=0,E=this.path.length;y<E;++y){q=this.path[y];switch(q[0]){case "l":u+=q[1];r+=q[2];p.lineTo(u+B,r+A);break;case "L":u=q[1];
r=q[2];p.lineTo(u+B,r+A);break;case "h":u+=q[1];p.lineTo(u+B,r+A);break;case "H":u=q[1];p.lineTo(u+B,r+A);break;case "v":r+=q[1];p.lineTo(u+B,r+A);break;case "V":r=q[1];p.lineTo(u+B,r+A);break;case "m":u+=q[1];r+=q[2];p[w&&(w[0]==="m"||w[0]==="M")?"lineTo":"moveTo"](u+B,r+A);break;case "M":u=q[1];r=q[2];p[w&&(w[0]==="m"||w[0]==="M")?"lineTo":"moveTo"](u+B,r+A);break;case "c":x=u+q[5];z=r+q[6];s=u+q[3];v=r+q[4];p.bezierCurveTo(u+q[1]+B,r+q[2]+A,s+B,v+A,x+B,z+A);u=x;r=z;break;case "C":u=q[5];r=q[6];
s=q[3];v=q[4];p.bezierCurveTo(q[1]+B,q[2]+A,s+B,v+A,u+B,r+A);break;case "s":x=u+q[3];z=r+q[4];s=s?2*u-s:u;v=v?2*r-v:r;p.bezierCurveTo(s+B,v+A,u+q[1]+B,r+q[2]+A,x+B,z+A);s=u+q[1];v=r+q[2];u=x;r=z;break;case "S":x=q[3];z=q[4];s=2*u-s;v=2*r-v;p.bezierCurveTo(s+B,v+A,q[1]+B,q[2]+A,x+B,z+A);u=x;r=z;s=q[1];v=q[2];break;case "q":x=u+q[3];z=r+q[4];s=u+q[1];v=r+q[2];p.quadraticCurveTo(s+B,v+A,x+B,z+A);u=x;r=z;break;case "Q":x=q[3];z=q[4];p.quadraticCurveTo(q[1]+B,q[2]+A,x+B,z+A);u=x;r=z;s=q[1];v=q[2];break;
case "t":x=u+q[1];z=r+q[2];if(w[0].match(/[QqTt]/)===null){s=u;v=r}else if(w[0]==="t"){s=2*u-C;v=2*r-D}else if(w[0]==="q"){s=2*u-s;v=2*r-v}C=s;D=v;p.quadraticCurveTo(s+B,v+A,x+B,z+A);u=x;r=z;s=u+q[1];v=r+q[2];break;case "T":x=q[1];z=q[2];s=2*u-s;v=2*r-v;p.quadraticCurveTo(s+B,v+A,x+B,z+A);u=x;r=z;break;case "a":f(p,u+B,r+A,[q[1],q[2],q[3],q[4],q[5],q[6]+u+B,q[7]+r+A]);u+=q[6];r+=q[7];break;case "A":f(p,u+B,r+A,[q[1],q[2],q[3],q[4],q[5],q[6]+B,q[7]+A]);u=q[6];r=q[7];break;case "z":case "Z":p.closePath();
break}w=q}},render:function(p,q){p.save();var w=this.transformMatrix;w&&p.transform(w[0],w[1],w[2],w[3],w[4],w[5]);q||this.transform(p);if(this.overlayFill)p.fillStyle=this.overlayFill;else if(this.fill)p.fillStyle=this.fill.toLive?this.fill.toLive(p):this.fill;if(this.stroke)p.strokeStyle=this.stroke.toLive?this.stroke.toLive(p):this.stroke;this._setShadow(p);this.clipTo&&k.util.clipContext(this,p);p.beginPath();this._render(p);this.fill&&p.fill();this.clipTo&&p.restore();this._removeShadow(p);if(this.stroke){p.strokeStyle=
this.stroke;p.lineWidth=this.strokeWidth;p.lineCap=p.lineJoin="round";p.stroke()}if(!q&&this.active){this.drawBorders(p);this.drawControls(p)}p.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(p){p=o(this.callSuper("toObject",p),{path:this.path});if(this.sourcePath)p.sourcePath=this.sourcePath;if(this.transformMatrix)p.transformMatrix=this.transformMatrix;return p},toDatalessObject:function(p){p=this.toObject(p);
if(this.sourcePath)p.path=this.sourcePath;delete p.sourcePath;return p},toSVG:function(){for(var p=[],q=[],w=0,u=this.path.length;w<u;w++)p.push(this.path[w].join(" "));p=p.join(" ");this.fill&&this.fill.toLive&&q.push(this.fill.toSVG(this,true));this.stroke&&this.stroke.toLive&&q.push(this.stroke.toSVG(this,true));q.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',p,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',
"/>","</g>");return q.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var p=[],q,w,u,r=0,s=this.path.length;r<s;r++){q=this.path[r];w=q.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);q=[q.charAt(0)];for(var v=0,x=w.length;v<x;v++){u=parseFloat(w[v]);isNaN(u)||q.push(u)}w=q[0].toLowerCase();w=d[w];if(q.length-1>w){u=1;for(v=q.length;u<v;u+=w)p.push([q[0]].concat(q.slice(u,u+w)))}else p.push(q)}return p},_parseDimensions:function(){var p=[],q=[],w,u,
r=false,s,v;this.path.forEach(function(B,A){if(B[0]!=="H")w=A===0?b(B):b(this.path[A-1]);if(B[0]!=="V")u=A===0?c(B):c(this.path[A-1]);if(B[0]===B[0].toLowerCase())r=true;s=r?w+b(B):B[0]==="V"?w:b(B);v=r?u+c(B):B[0]==="H"?u:c(B);var y=parseInt(s,10);isNaN(y)||p.push(y);y=parseInt(v,10);isNaN(y)||q.push(y)},this);var x=i(p),z=i(q),C=n(p),D=n(q);C=C-x;D=D-z;x={top:z+D/2,left:x+C/2,bottom:n(q)-D,right:n(p)-C};x.width=C;x.height=D;return x}});k.Path.fromObject=function(p){return new k.Path(p.path,p)};
k.Path.ATTRIBUTE_NAMES="d fill fill-opacity opacity fill-rule stroke stroke-width transform".split(" ");k.Path.fromElement=function(p,q){var w=k.parseAttributes(p,k.Path.ATTRIBUTE_NAMES);return new k.Path(w.d,o(w,q))}}})(typeof exports!=="undefined"?exports:this);
(function(l){var f=l.fabric||(l.fabric={}),a=f.util.object.extend,e=f.util.array.invoke,b=f.Object.prototype.toObject,c=f.util.string.camelize,d=f.util.string.capitalize;if(f.PathGroup)f.warn("fabric.PathGroup is already defined");else{f.PathGroup=f.util.createClass(f.Path,{type:"path-group",fill:"",initialize:function(g,h){h=h||{};this.paths=g||[];for(var j=this.paths.length;j--;)this.paths[j].group=this;this.setOptions(h);this.setCoords();h.sourcePath&&this.setSourcePath(h.sourcePath)},render:function(g){if(this.visible){g.save();
var h=this.transformMatrix;h&&g.transform(h[0],h[1],h[2],h[3],h[4],h[5]);this.transform(g);this._setShadow(g);this.clipTo&&f.util.clipContext(this,g);h=0;for(var j=this.paths.length;h<j;++h)this.paths[h].render(g,true);this.clipTo&&g.restore();this._removeShadow(g);if(this.active){this.drawBorders(g);this.drawControls(g)}g.restore()}},_set:function(g,h){if((g==="fill"||g==="overlayFill")&&h&&this.isSameColor())for(var j=this.paths.length;j--;)this.paths[j]._set(g,h);return this.callSuper("_set",g,
h)},toObject:function(g){return a(b.call(this,g),{paths:e(this.getObjects(),"toObject",g),sourcePath:this.sourcePath})},toDatalessObject:function(g){g=this.toObject(g);if(this.sourcePath)g.paths=this.sourcePath;return g},toSVG:function(){for(var g=this.getObjects(),h=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],j=0,m=g.length;j<m;j++)h.push(g[j].toSVG());h.push("</g>");return h.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+
"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var g=this.getObjects()[0].get("fill");return this.getObjects().every(function(h){return h.get("fill")===g})},complexity:function(){return this.paths.reduce(function(g,h){return g+(h&&h.complexity?h.complexity():0)},0)},toGrayscale:function(){for(var g=this.paths.length;g--;)this.paths[g].toGrayscale();return this},getObjects:function(){return this.paths}});f.PathGroup.fromObject=function(g){for(var h=g.paths,j=0,m=h.length;j<
m;j++)if(!(h[j]instanceof f.Object)){var k=c(d(h[j].type));h[j]=f[k].fromObject(h[j])}return new f.PathGroup(h,g)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var f=l.fabric||(l.fabric={}),a=f.util.object.extend,e=f.util.array.min,b=f.util.array.max,c=f.util.array.invoke,d=f.util.removeFromArray;if(!f.Group){var g={lockMovementX:true,lockMovementY:true,lockRotation:true,lockScalingX:true,lockScalingY:true,lockUniScaling:true};f.Group=f.util.createClass(f.Object,{type:"group",initialize:function(h,j){j=j||{};this.objects=h||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();j&&a(this,j);this._setOpacityIfSame();
this.setCoords(true);this.saveCoords()},_updateObjectsCoords:function(){var h=this.left,j=this.top;this.forEachObject(function(m){var k=m.get("left"),i=m.get("top");m.set("originalLeft",k);m.set("originalTop",i);m.set("left",k-h);m.set("top",i-j);m.setCoords();m.__origHasControls=m.hasControls;m.hasControls=false},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},addWithUpdate:function(h){this._restoreObjectsState();this.objects.push(h);
this._calcBounds();this._updateObjectsCoords();return this},removeWithUpdate:function(h){this._restoreObjectsState();d(this.objects,h);h.setActive(false);this._calcBounds();this._updateObjectsCoords();return this},add:function(h){this.objects.push(h);return this},remove:function(h){d(this.objects,h);return this},size:function(){return this.getObjects().length},delegatedProperties:{fill:true,opacity:true,fontFamily:true,fontWeight:true,fontSize:true,fontStyle:true,lineHeight:true,textDecoration:true,
textShadow:true,textAlign:true,backgroundColor:true},_set:function(h,j){if(h in this.delegatedProperties){var m=this.objects.length;for(this[h]=j;m--;)this.objects[m].set(h,j)}else this[h]=j},contains:function(h){return this.objects.indexOf(h)>-1},toObject:function(h){return a(this.callSuper("toObject",h),{objects:c(this.objects,"toObject",h)})},render:function(h,j){h.save();this.transform(h);var m=Math.max(this.scaleX,this.scaleY);this.clipTo&&f.util.clipContext(this,h);for(var k=this.objects.length;k>
0;k--){var i=this.objects[k-1],n=i.borderScaleFactor,o=i.hasRotatingPoint;i.borderScaleFactor=m;i.hasRotatingPoint=false;i.render(h);i.borderScaleFactor=n;i.hasRotatingPoint=o}this.clipTo&&h.restore();if(!j&&this.active){this.drawBorders(h);this.drawControls(h)}h.restore();this.setCoords()},item:function(h){return this.getObjects()[h]},complexity:function(){return this.getObjects().reduce(function(h,j){h+=typeof j.complexity==="function"?j.complexity():0;return h},0)},_restoreObjectsState:function(){this.objects.forEach(this._restoreObjectState,
this);return this},_restoreObjectState:function(h){var j=this.get("left"),m=this.get("top"),k=this.getAngle()*(Math.PI/180),i=Math.cos(k)*h.get("top")+Math.sin(k)*h.get("left");k=-Math.sin(k)*h.get("top")+Math.cos(k)*h.get("left");h.setAngle(h.getAngle()+this.getAngle());h.set("left",j+k*this.get("scaleX"));h.set("top",m+i*this.get("scaleY"));h.set("scaleX",h.get("scaleX")*this.get("scaleX"));h.set("scaleY",h.get("scaleY")*this.get("scaleY"));h.setCoords();h.hasControls=h.__origHasControls;delete h.__origHasControls;
h.setActive(false);h.setCoords();return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(h){h.setCoords()});return this},activateAllObjects:function(){this.forEachObject(function(h){h.setActive()});return this},forEachObject:f.StaticCanvas.prototype.forEachObject,
_setOpacityIfSame:function(){var h=this.getObjects(),j=h[0]?h[0].get("opacity"):1;if(h.every(function(m){return m.get("opacity")===j}))this.opacity=j},_calcBounds:function(){var h=[],j=[],m,k;k=0;for(var i=this.objects.length;k<i;++k){m=this.objects[k];m.setCoords();for(var n in m.oCoords){h.push(m.oCoords[n].x);j.push(m.oCoords[n].y)}}m=e(h);k=b(h);h=e(j);j=b(j);k=k-m||0;j=j-h||0;this.width=k;this.height=j;this.left=m+k/2||0;this.top=h+j/2||0},containsPoint:function(h){var j=this.get("width")/2,
m=this.get("height")/2,k=this.get("left"),i=this.get("top");return k-j<h.x&&k+j>h.x&&i-m<h.y&&i+m>h.y},toGrayscale:function(){for(var h=this.objects.length;h--;)this.objects[h].toGrayscale();return this},toSVG:function(){for(var h=[],j=this.objects.length;j--;)h.push(this.objects[j].toSVG());return'<g transform="'+this.getSvgTransform()+'">'+h.join("")+"</g>"},get:function(h){if(h in g)if(this[h])return this[h];else{for(var j=0,m=this.objects.length;j<m;j++)if(this.objects[j][h])return true;return false}else{if(h in
this.delegatedProperties)return this.objects[0]&&this.objects[0].get(h);return this[h]}}});f.Group.fromObject=function(h,j){f.util.enlivenObjects(h.objects,function(m){delete h.objects;j&&j(new f.Group(m,h))})};f.Group.async=true}})(typeof exports!=="undefined"?exports:this);
(function(l){var f=fabric.util.object.extend;if(!l.fabric)l.fabric={};if(l.fabric.Image)fabric.warn("fabric.Image is already defined.");else{fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",initialize:function(a,e){e||(e={});this.callSuper("initialize",e);this._initElement(a);this._originalImage=this.getElement();this._initConfig(e);this.filters=[];if(e.filters){this.filters=e.filters;this.applyFilters()}},getElement:function(){return this._element},setElement:function(a){this._element=
a;this._initConfig();return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},render:function(a,e){a.save();var b=this.transformMatrix;this.group&&a.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2);b&&a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);e||this.transform(a);this._setShadow(a);this.clipTo&&fabric.util.clipContext(this,a);this._render(a);this.clipTo&&a.restore();this._removeShadow(a);if(this.active&&!e){this.drawBorders(a);
this.drawControls(a)}a.restore()},toObject:function(a){return f(this.callSuper("toObject",a),{src:this._originalImage.src||this._originalImage._src,filters:this.filters.concat()})},toSVG:function(){return'<g transform="'+this.getSvgTransform()+'"><image xlink:href="'+this.getSvgSrc()+'" style="'+this.getSvgStyles()+'" transform="translate('+-this.width/2+" "+-this.height/2+')" width="'+this.width+'" height="'+this.height+'"></image></g>'},getSrc:function(){return this.getElement().src||this.getElement()._src},
toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,e){this.constructor.fromObject(this.toObject(e),a)},applyFilters:function(a){if(this.filters.length===0){this.setElement(this._originalImage);a&&a()}else{var e=typeof Buffer!=="undefined"&&typeof window==="undefined",b=this._originalImage,c=fabric.util.createCanvasElement(),d=e?new (require("canvas").Image):fabric.document.createElement("img"),g=this;c.width=b.width;c.height=b.height;c.getContext("2d").drawImage(b,
0,0,b.width,b.height);this.filters.forEach(function(h){h&&h.applyTo(c)});d.onload=function(){g._element=d;a&&a();d.onload=c=b=null};d.width=b.width;d.height=b.height;if(e){e=c.toDataURL("image/png").substring(22);d.src=new Buffer(e,"base64");g._element=d;a&&a()}else d.src=c.toDataURL("image/png");return this}},_render:function(a){a.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",
a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a)},_initFilters:function(a){if(a.filters&&a.filters.length)this.filters=a.filters.map(function(e){return e&&fabric.Image.filters[e.type].fromObject(e)})},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement().width||0;this.height="height"in a?a.height:this.getElement().height||
0},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(a,e){var b=fabric.document.createElement("img"),c=a.src;if(a.width)b.width=a.width;if(a.height)b.height=a.height;b.onload=function(){fabric.Image.prototype._initFilters.call(a,a);var d=new fabric.Image(b,a);e&&e(d);b=b.onload=b.onerror=null};b.onerror=function(){fabric.log("Error loading "+b.src);e&&e(null,true);b=b.onload=b.onerror=
null};b.src=c};fabric.Image.fromURL=function(a,e,b){var c=fabric.document.createElement("img");c.onload=function(){e&&e(new fabric.Image(c,b));c=c.onload=null};c.src=a};fabric.Image.ATTRIBUTE_NAMES="x y width height fill fill-opacity opacity stroke stroke-width transform xlink:href".split(" ");fabric.Image.fromElement=function(a,e,b){a=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(a["xlink:href"],e,f(b?fabric.util.object.clone(b):{},a))};fabric.Image.async=true}})(typeof exports!==
"undefined"?exports:this);
fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var l=this.getAngle()%360;if(l>0)return Math.round((l-1)/90)*90;return Math.round(l/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(l){l=l||{};var f=function(){},a=l.onComplete||f,e=l.onChange||f,b=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(c){b.setAngle(c);
e()},onComplete:function(){b.setCoords();a()},onStart:function(){b.setActive(false)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(l){l.straighten();this.renderAll();return this},fxStraightenObject:function(l){l.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters={};
fabric.Image.filters.Grayscale=fabric.util.createClass({type:"Grayscale",applyTo:function(l){var f=l.getContext("2d");l=f.getImageData(0,0,l.width,l.height);var a=l.data,e=l.width,b=l.height,c,d,g,h;for(g=0;g<e;g++)for(h=0;h<b;h++){c=g*4*b+h*4;d=(a[c]+a[c+1]+a[c+2])/3;a[c]=d;a[c+1]=d;a[c+2]=d}f.putImageData(l,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale};
fabric.Image.filters.RemoveWhite=fabric.util.createClass({type:"RemoveWhite",initialize:function(l){l||(l={});this.threshold=l.threshold||30;this.distance=l.distance||20},applyTo:function(l){var f=l.getContext("2d");l=f.getImageData(0,0,l.width,l.height);for(var a=l.data,e=this.distance,b=255-this.threshold,c=Math.abs,d,g,h,j=0,m=a.length;j<m;j+=4){d=a[j];g=a[j+1];h=a[j+2];if(d>b&&g>b&&h>b&&c(d-g)<e&&c(d-h)<e&&c(g-h)<e)a[j+3]=1}f.putImageData(l,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold,
distance:this.distance}}});fabric.Image.filters.RemoveWhite.fromObject=function(l){return new fabric.Image.filters.RemoveWhite(l)};fabric.Image.filters.Invert=fabric.util.createClass({type:"Invert",applyTo:function(l){var f=l.getContext("2d");l=f.getImageData(0,0,l.width,l.height);var a=l.data,e=a.length,b;for(b=0;b<e;b+=4){a[b]=255-a[b];a[b+1]=255-a[b+1];a[b+2]=255-a[b+2]}f.putImageData(l,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert};
fabric.Image.filters.Sepia=fabric.util.createClass({type:"Sepia",applyTo:function(l){var f=l.getContext("2d");l=f.getImageData(0,0,l.width,l.height);var a=l.data,e=a.length,b,c;for(b=0;b<e;b+=4){c=0.3*a[b]+0.59*a[b+1]+0.11*a[b+2];a[b]=c+100;a[b+1]=c+50;a[b+2]=c+255}f.putImageData(l,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Sepia.fromObject=function(){return new fabric.Image.filters.Sepia};
fabric.Image.filters.Sepia2=fabric.util.createClass({type:"Sepia2",applyTo:function(l){var f=l.getContext("2d");l=f.getImageData(0,0,l.width,l.height);var a=l.data,e=a.length,b,c,d,g;for(b=0;b<e;b+=4){c=a[b];d=a[b+1];g=a[b+2];a[b]=(c*0.393+d*0.769+g*0.189)/1.351;a[b+1]=(c*0.349+d*0.686+g*0.168)/1.203;a[b+2]=(c*0.272+d*0.534+g*0.131)/2.14}f.putImageData(l,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Sepia2.fromObject=function(){return new fabric.Image.filters.Sepia2};
fabric.Image.filters.Brightness=fabric.util.createClass({type:"Brightness",initialize:function(l){l||(l={});this.brightness=l.brightness||100},applyTo:function(l){var f=l.getContext("2d");l=f.getImageData(0,0,l.width,l.height);for(var a=l.data,e=this.brightness,b=0,c=a.length;b<c;b+=4){a[b]+=e;a[b+1]+=e;a[b+2]+=e}f.putImageData(l,0,0)},toJSON:function(){return{type:this.type,brightness:this.brightness}}});fabric.Image.filters.Brightness.fromObject=function(l){return new fabric.Image.filters.Brightness(l)};
fabric.Image.filters.Noise=fabric.util.createClass({type:"Noise",initialize:function(l){l||(l={});this.noise=l.noise||100},applyTo:function(l){var f=l.getContext("2d");l=f.getImageData(0,0,l.width,l.height);for(var a=l.data,e=this.noise,b,c=0,d=a.length;c<d;c+=4){b=(0.5-Math.random())*e;a[c]+=b;a[c+1]+=b;a[c+2]+=b}f.putImageData(l,0,0)},toJSON:function(){return{type:this.type,noise:this.noise}}});fabric.Image.filters.Noise.fromObject=function(l){return new fabric.Image.filters.Noise(l)};
fabric.Image.filters.GradientTransparency=fabric.util.createClass({type:"GradientTransparency",initialize:function(l){l||(l={});this.threshold=l.threshold||100},applyTo:function(l){var f=l.getContext("2d");l=f.getImageData(0,0,l.width,l.height);for(var a=l.data,e=this.threshold,b=a.length,c=0,d=a.length;c<d;c+=4)a[c+3]=e+255*(b-c)/b;f.putImageData(l,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold}}});fabric.Image.filters.GradientTransparency.fromObject=function(l){return new fabric.Image.filters.GradientTransparency(l)};
fabric.Image.filters.Tint=fabric.util.createClass({type:"Tint",initialize:function(l){l||(l={});this.color=l.color||0},applyTo:function(l){var f=l.getContext("2d");l=f.getImageData(0,0,l.width,l.height);var a=l.data,e=a.length,b,c;b=parseInt(this.color,10).toString(16);var d=parseInt("0x"+b.substr(0,2),16),g=parseInt("0x"+b.substr(2,2),16),h=parseInt("0x"+b.substr(4,2),16);for(b=0;b<e;b+=4){c=a[b+3];if(c>0){a[b]=d;a[b+1]=g;a[b+2]=h}}f.putImageData(l,0,0)},toJSON:function(){return{type:this.type,color:this.color}}});
fabric.Image.filters.Tint.fromObject=function(l){return new fabric.Image.filters.Tint(l)};
fabric.Image.filters.Convolute=fabric.util.createClass({type:"Convolute",initialize:function(l){l||(l={});this.opaque=l.opaque;this.matrix=l.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=fabric.util.createCanvasElement().getContext("2d")},_createImageData:function(l,f){return this.tmpCtx.createImageData(l,f)},applyTo:function(l){var f=this.matrix,a=l.getContext("2d"),e=a.getImageData(0,0,l.width,l.height);l=Math.round(Math.sqrt(f.length));var b=Math.floor(l/2),c=e.data,d=e.width;e=e.height;for(var g=this._createImageData(d,
e),h=g.data,j=this.opaque?1:0,m=0;m<e;m++)for(var k=0;k<d;k++){for(var i=m,n=k,o=(m*d+k)*4,t=0,p=0,q=0,w=0,u=0;u<l;u++)for(var r=0;r<l;r++){var s=i+u-b,v=n+r-b;if(s>=0&&s<e&&v>=0&&v<d){s=(s*d+v)*4;v=f[u*l+r];t+=c[s]*v;p+=c[s+1]*v;q+=c[s+2]*v;w+=c[s+3]*v}}h[o]=t;h[o+1]=p;h[o+2]=q;h[o+3]=w+j*(255-w)}a.putImageData(g,0,0)},toJSON:function(){return{type:this.type,matrix:this.matrix}}});fabric.Image.filters.Convolute.fromObject=function(l){return new fabric.Image.filters.Convolute(l)};
fabric.Image.filters.Pixelate=fabric.util.createClass({type:"Pixelate",initialize:function(l){l||(l={});this.blocksize=l.blocksize||4},applyTo:function(l){var f=l.getContext("2d");l=f.getImageData(0,0,l.width,l.height);var a=l.data,e=l.width,b=l.height,c,d,g,h,j,m,k;for(d=0;d<e;d+=this.blocksize)for(g=0;g<b;g+=this.blocksize){c=d*4*b+g*4;h=a[c];j=a[c+1];m=a[c+2];k=a[c+3];for(var i=d,n=d+this.blocksize;i<n;i++)for(var o=g,t=g+this.blocksize;o<t;o++){c=i*4*b+o*4;a[c]=h;a[c+1]=j;a[c+2]=m;a[c+3]=k}}f.putImageData(l,
0,0)},toJSON:function(){return{type:this.type,blocksize:this.blocksize}}});fabric.Image.filters.Pixelate.fromObject=function(l){return new fabric.Image.filters.Pixelate(l)};
(function(l){var f=l.fabric||(l.fabric={}),a=f.util.object.extend,e=f.util.object.clone,b=f.util.toFixed;if(f.Text)f.warn("fabric.Text is already defined");else{var c={fontSize:true,fontWeight:true,fontFamily:true,textDecoration:true,fontStyle:true,lineHeight:true,strokeStyle:true,strokeWidth:true,text:true};l=f.Object.prototype.stateProperties.concat();l.push("fontFamily","fontWeight","fontSize","path","text","textDecoration","textShadow","textAlign","fontStyle","lineHeight","strokeStyle","strokeWidth",
"backgroundColor","textBackgroundColor","useNative");f.Text=f.util.createClass(f.Object,{fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textShadow:"",textAlign:"left",fontStyle:"",lineHeight:1.3,strokeStyle:"",strokeWidth:1,backgroundColor:"",textBackgroundColor:"",path:null,type:"text",useNative:true,stateProperties:l,initialize:function(d,g){g=g||{};this.text=d;this.setOptions(g);this._initDimensions();this.setCoords()},_initDimensions:function(){this._render(f.util.createCanvasElement().getContext("2d"))},
toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(d){typeof Cufon==="undefined"||this.useNative===true?this._renderViaNative(d):this._renderViaCufon(d)},_renderViaCufon:function(d){var g=Cufon.textOptions||(Cufon.textOptions={});g.left=this.left;g.top=this.top;g.context=d;g.color=this.fill;var h=this._initDummyElementForCufon();this.transform(d);Cufon.replaceElement(h,{engine:"canvas",separate:"none",
fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor});this.width=g.width;this.height=g.height;this._totalLineHeight=g.totalLineHeight;this._fontAscent=g.fontAscent;this._boundaries=g.boundaries;this._shadowOffsets=g.shadowOffsets;
this._shadows=g.shadows||[];this.setCoords()},_renderViaNative:function(d){this.transform(d);this._setTextStyles(d);var g=this.text.split(/\r?\n/);this.width=this._getTextWidth(d,g);this.height=this._getTextHeight(d,g);this._renderTextBackground(d,g);if(this.textAlign!=="left"&&this.textAlign!=="justify"){d.save();d.translate(this.textAlign==="center"?this.width/2:this.width,0)}this._setTextShadow(d);this.clipTo&&f.util.clipContext(this,d);this._renderTextFill(d,g);this._renderTextStroke(d,g);this.clipTo&&
d.restore();this.textShadow&&d.restore();this.textAlign!=="left"&&this.textAlign!=="justify"&&d.restore();this._renderTextDecoration(d,g);this._setBoundaries(d,g);this._totalLineHeight=0;this.setCoords()},_setBoundaries:function(d,g){this._boundaries=[];for(var h=0,j=g.length;h<j;h++){var m=this._getLineWidth(d,g[h]),k=this._getLineLeftOffset(m);this._boundaries.push({height:this.fontSize*this.lineHeight,width:m,left:k})}},_setTextStyles:function(d){d.fillStyle=this.fill.toLive?this.fill.toLive(d):
this.fill;d.strokeStyle=this.strokeStyle;d.lineWidth=this.strokeWidth;d.textBaseline="alphabetic";d.textAlign=this.textAlign;d.font=this._getFontDeclaration()},_getTextHeight:function(d,g){return this.fontSize*g.length*this.lineHeight},_getTextWidth:function(d,g){for(var h=d.measureText(g[0]).width,j=1,m=g.length;j<m;j++){var k=d.measureText(g[j]).width;if(k>h)h=k}return h},_setTextShadow:function(d){if(this.textShadow){var g=/\s+(-?\d+)(?:px)?\s+(-?\d+)(?:px)?\s+(\d+)(?:px)?\s*/,h=this.textShadow,
j=g.exec(this.textShadow);g=h.replace(g,"");d.save();d.shadowColor=g;d.shadowOffsetX=parseInt(j[1],10);d.shadowOffsetY=parseInt(j[2],10);d.shadowBlur=parseInt(j[3],10);this._shadows=[{blur:d.shadowBlur,color:d.shadowColor,offX:d.shadowOffsetX,offY:d.shadowOffsetY}];this._shadowOffsets=[[parseInt(d.shadowOffsetX,10),parseInt(d.shadowOffsetY,10)]]}},_drawTextLine:function(d,g,h,j,m){if(this.textAlign!=="justify")g[d](h,j,m);else{var k=g.measureText(h).width,i=this.width;if(i>k){k=h.split(/\s+/);h=g.measureText(h.replace(/\s+/g,
"")).width;i=(i-h)/(k.length-1);for(var n=h=0,o=k.length;n<o;n++){g[d](k[n],j+h,m);h+=g.measureText(k[n]).width+i}}else g[d](h,j,m)}},_renderTextFill:function(d,g){this._boundaries=[];for(var h=0,j=g.length;h<j;h++)this._drawTextLine("fillText",d,g[h],-this.width/2,-this.height/2+h*this.fontSize*this.lineHeight+this.fontSize)},_renderTextStroke:function(d,g){if(this.strokeStyle){d.beginPath();for(var h=0,j=g.length;h<j;h++)this._drawTextLine("strokeText",d,g[h],-this.width/2,-this.height/2+h*this.fontSize*
this.lineHeight+this.fontSize);d.closePath()}},_renderTextBackground:function(d,g){this._renderTextBoxBackground(d);this._renderTextLinesBackground(d,g)},_renderTextBoxBackground:function(d){if(this.backgroundColor){d.save();d.fillStyle=this.backgroundColor;d.fillRect(-this.width/2,-this.height/2,this.width,this.height);d.restore()}},_renderTextLinesBackground:function(d,g){if(this.textBackgroundColor){d.save();d.fillStyle=this.textBackgroundColor;for(var h=0,j=g.length;h<j;h++)if(g[h]!==""){var m=
this._getLineWidth(d,g[h]),k=this._getLineLeftOffset(m);d.fillRect(-this.width/2+k,-this.height/2+h*this.fontSize*this.lineHeight,m,this.fontSize*this.lineHeight)}d.restore()}},_getLineLeftOffset:function(d){if(this.textAlign==="center")return(this.width-d)/2;if(this.textAlign==="right")return this.width-d;return 0},_getLineWidth:function(d,g){return this.textAlign==="justify"?this.width:d.measureText(g).width},_renderTextDecoration:function(d,g){function h(k){for(var i=0,n=g.length;i<n;i++){var o=
m._getLineWidth(d,g[i]),t=m._getLineLeftOffset(o);d.fillRect(-m.width/2+t,k+i*m.fontSize*m.lineHeight-j,o,1)}}var j=this._getTextHeight(d,g)/2,m=this;this.textDecoration.indexOf("underline")>-1&&h(this.fontSize);this.textDecoration.indexOf("line-through")>-1&&h(this.fontSize/2);this.textDecoration.indexOf("overline")>-1&&h(0)},_getFontDeclaration:function(){return[f.isLikelyNode?this.fontWeight:this.fontStyle,f.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",f.isLikelyNode?'"'+this.fontFamily+
'"':this.fontFamily].join(" ")},_initDummyElementForCufon:function(){var d=f.document.createElement("pre");f.document.createElement("div").appendChild(d);if(typeof G_vmlCanvasManager==="undefined")d.innerHTML=this.text;else d.innerText=this.text.replace(/\r?\n/gi,"\r");d.style.fontSize=this.fontSize+"px";d.style.letterSpacing="normal";return d},render:function(d,g){d.save();this._render(d);if(!g&&this.active){this.drawBorders(d);this.drawControls(d)}d.restore()},toObject:function(d){return a(this.callSuper("toObject",
d),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,path:this.path,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative})},toSVG:function(){var d=this.text.split(/\r?\n/),g=this.useNative?this.fontSize*this.lineHeight:
-this._fontAscent-this._fontAscent/5*this.lineHeight,h=-(this.width/2),j=this.useNative?this.fontSize-1:this.height/2-d.length*this.fontSize-this._totalLineHeight,m=this._getSVGTextAndBg(g,h,d);d=this._getSVGShadows(g,d);j+=this._fontAscent?this._fontAscent/5*this.lineHeight:0;return['<g transform="',this.getSvgTransform(),'">',m.textBgRects.join(""),"<text ",this.fontFamily?"font-family=\"'"+this.fontFamily+"'\" ":"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+
this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" transform="translate(',b(h,2)," ",b(j,2),')">',d.join(""),m.textSpans.join(""),"</text></g>"].join("")},_getSVGShadows:function(d,g){var h=[],j,m,k,i,n=1;if(!this._shadows||!this._boundaries)return h;j=0;for(k=this._shadows.length;j<k;j++){m=0;for(i=g.length;m<i;m++)if(g[m]!==""){h.push('<tspan x="',b((this._boundaries&&
this._boundaries[m]?this._boundaries[m].left:0)+n+this._shadowOffsets[j][0],2),m===0||this.useNative?'" y':'" dy','="',b(this.useNative?d*m-this.height/2+this._shadowOffsets[j][1]:d+(m===0?this._shadowOffsets[j][1]:0),2),'" ',this._getFillAttributes(this._shadows[j].color),">",f.util.string.escapeXml(g[m]),"</tspan>");n=1}else n++}return h},_getSVGTextAndBg:function(d,g,h){var j=[],m=[],k,i,n,o=1;this.backgroundColor&&this._boundaries&&m.push("<rect ",this._getFillAttributes(this.backgroundColor),
' x="',b(-this.width/2,2),'" y="',b(-this.height/2,2),'" width="',b(this.width,2),'" height="',b(this.height,2),'"></rect>');k=0;for(n=h.length;k<n;k++){if(h[k]!==""){i=this._boundaries&&this._boundaries[k]?b(this._boundaries[k].left,2):0;j.push('<tspan x="',i,'" ',k===0||this.useNative?"y":"dy",'="',b(this.useNative?d*k-this.height/2:d*o,2),'" ',this._getFillAttributes(this.fill),">",f.util.string.escapeXml(h[k]),"</tspan>");o=1}else o++;this.textBackgroundColor&&this._boundaries&&m.push("<rect ",
this._getFillAttributes(this.textBackgroundColor),' x="',b(g+this._boundaries[k].left,2),'" y="',b(d*k-this.height/2,2),'" width="',b(this._boundaries[k].width,2),'" height="',b(this._boundaries[k].height,2),'"></rect>')}return{textSpans:j,textBgRects:m}},_getFillAttributes:function(d){var g=d?new f.Color(d):"";if(!g||!g.getSource()||g.getAlpha()===1)return'fill="'+d+'"';return'opacity="'+g.getAlpha()+'" fill="'+g.setAlpha(1).toRgb()+'"'},setColor:function(d){this.set("fill",d);return this},getText:function(){return this.text},
_set:function(d,g){if(d==="fontFamily"&&this.path)this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+g+"$3");this.callSuper("_set",d,g);if(d in c){this._initDimensions();this.setCoords()}}});f.Text.ATTRIBUTE_NAMES="x y fill fill-opacity opacity stroke stroke-width transform font-family font-style font-weight font-size text-decoration".split(" ");f.Text.fromObject=function(d){return new f.Text(d.text,e(d))};f.Text.fromElement=function(d,g){if(!d)return null;var h=f.parseAttributes(d,f.Text.ATTRIBUTE_NAMES);
g=f.util.object.extend(g?f.util.object.clone(g):{},h);h=new f.Text(d.textContent,g);h.set({left:h.getLeft()+h.getWidth()/2,top:h.getTop()-h.getHeight()/2});return h};f.util.createAccessors(f.Text)}})(typeof exports!=="undefined"?exports:this);
(function(){function l(j,m,k){var i=e.parse(j);b.request({hostname:i.hostname,port:i.port,path:i.pathname,method:"GET"},function(n){var o="";m&&n.setEncoding(m);n.on("end",function(){k(o)});n.on("data",function(t){if(n.statusCode===200)o+=t})}).on("error",function(n){n.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+i.hostname+":"+i.port):fabric.log(n.message)})}function f(j,m){var k=require("fs").createReadStream(j),i="";k.on("data",function(n){i+=n});k.on("end",function(){m(i)})}
if(!(typeof document!=="undefined"&&typeof window!=="undefined")){var a=(new require("xmldom")).DOMParser,e=require("url"),b=require("http"),c=require("canvas"),d=require("canvas").Image;fabric.util.loadImage=function(j,m,k){var i=function(o){n.src=new Buffer(o,"binary");n._src=j;m&&m.call(k,n)},n=new d;if(j&&j.indexOf("data")===0){n.src=n._src=j;m&&m.call(k,n)}else if(j&&j.indexOf("http")!==0)f(j,i);else j&&l(j,"binary",i)};fabric.loadSVGFromURL=function(j,m){j=j.replace(/^\n\s*/,"").replace(/\?.*$/,
"").trim();l(j,"",function(k){fabric.loadSVGFromString(k,m)})};fabric.loadSVGFromString=function(j,m){var k=(new a).parseFromString(j);fabric.parseSVGDocument(k.documentElement,function(i,n){m(i,n)})};fabric.util.getScript=function(j,m){l(j,"",function(k){eval(k);m&&m()})};fabric.Image.fromObject=function(j,m){fabric.util.loadImage(j.src,function(k){k=new fabric.Image(k);k._initConfig(j);k._initFilters(j);m(k)})};fabric.createCanvasForNode=function(j,m){var k=fabric.document.createElement("canvas"),
i=new c(j||600,m||600);k.style={};k.width=i.width;k.height=i.height;k=new (fabric.Canvas||fabric.StaticCanvas)(k);k.contextContainer=i.getContext("2d");k.nodeCanvas=i;k.Font=c.Font;return k};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(j){return this.nodeCanvas.createJPEGStream(j)};var g=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(j){g.call(this,
j);this.nodeCanvas.width=j;return this};if(fabric.Canvas)fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth;var h=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(j){h.call(this,j);this.nodeCanvas.height=j;return this};if(fabric.Canvas)fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight}})();
